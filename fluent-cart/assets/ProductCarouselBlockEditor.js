import{j as e,b as p}from"./chunks/BlockEditorTranslator.js";import{h as z}from"./chunks/Icons.js";import{a as F}from"./chunks/index4.js";import{E as j}from"./chunks/EditorPanel.js";import{E as u}from"./chunks/EditorPanelRow.js";import"./chunks/CustomSelect.js";import{S as G}from"./chunks/SelectProductModal.js";import"./chunks/SingleProductContext.js";import{P as U}from"./chunks/ProductContext.js";import{a as V}from"./chunks/add-query-args.js";import"./chunks/index5.js";import"./chunks/ProductListItem.js";const{InspectorControls:$}=wp.blockEditor,{CheckboxControl:C}=wp.components,{RangeControl:O}=wp.components,{PanelBody:de,SelectControl:S,ToggleControl:B}=wp.components,Q=({attributes:s,setAttributes:l,selectedProduct:n,setSelectedProduct:f,isInsideProductInfo:r})=>{const{carousel_settings:i}=s,{useEffect:v,useState:A}=wp.element;return v(()=>{},[s,n]),e.jsx($,{children:e.jsx("div",{className:"fct-inspector-control-wrap fct-inspector-control-wrap--product-card",children:e.jsx("div",{className:"fct-inspector-control-group",children:e.jsxs("div",{className:"fct-inspector-control-body",children:[e.jsx(j,{title:p("Product"),children:!r&&e.jsxs(u,{className:"flex-col",children:[e.jsx(G,{onModalClosed:o=>{const h=Array.isArray(o)?o.filter(m=>m==null?void 0:m.ID):[],a=h.map(m=>m.ID);l({product_ids:a}),f(h)},selectedProduct:n,setSelectedProduct:f,isMultiple:!0}),Array.isArray(s.product_ids)&&s.product_ids.length>0&&n&&n.length>0&&e.jsxs("div",{className:"fct-selected-products",children:[e.jsx("span",{className:"fct-selected-products__label",children:p("Selected products")}),e.jsx("div",{className:"fct-selected-products__list",children:n.map(o=>e.jsx("span",{className:"fct-product-chip",children:o.post_title},o.ID))})]})]})}),e.jsx(j,{title:p("Layout"),children:e.jsxs(u,{children:[e.jsx("span",{className:"fct-inspector-control-label",children:p("Slides per view")}),e.jsx(O,{value:i.slidesToShow,onChange:o=>l({carousel_settings:{...i,slidesToShow:o}}),min:1,max:6})]})}),e.jsxs(j,{title:p("Behavior"),children:[e.jsx(u,{children:e.jsx(C,{label:p("Autoplay"),checked:i.autoplay==="yes",onChange:o=>l({carousel_settings:{...i,autoplay:o?"yes":"no"}})})}),e.jsx(u,{children:e.jsx(B,{label:"Show arrows",checked:s.carousel_settings.arrows==="yes",onChange:o=>l({carousel_settings:{...s.carousel_settings,arrows:o?"yes":"no"}})})}),s.carousel_settings.arrows==="yes"&&e.jsx(u,{children:e.jsx(S,{label:"Arrow Size",value:s.carousel_settings.arrowsSize,options:[{label:"Small",value:"sm"},{label:"Medium",value:"md"},{label:"Large",value:"lg"}],onChange:o=>l({carousel_settings:{...s.carousel_settings,arrowsSize:o}})})}),e.jsx(u,{children:e.jsx(B,{label:"Show Pagination",checked:s.carousel_settings.dots==="yes",onChange:o=>l({carousel_settings:{...s.carousel_settings,dots:o?"yes":"no"}})})}),s.carousel_settings.dots==="yes"&&e.jsx(u,{children:e.jsx(S,{label:"Pagination Type",value:s.carousel_settings.paginationType,options:[{label:"Dots",value:"dots"},{label:"Fraction",value:"fraction"},{label:"Progress Bar",value:"progress"}],onChange:o=>l({carousel_settings:{...s.carousel_settings,paginationType:o}})})}),e.jsx(u,{children:e.jsx(C,{label:p("Infinite loop"),checked:i.infinite==="yes",onChange:o=>l({carousel_settings:{...i,infinite:o?"yes":"no"}})})})]})]})})})})},W=""+new URL("assets/ProductGallery.png",import.meta.url).href,{InnerBlocks:I,useBlockProps:E,useInnerBlocksProps:ue,__experimentalUseBlockPreview:pe,BlockContextProvider:me}=wp.blockEditor,{registerBlockType:X}=wp.blocks,{useEffect:x,useState:g}=wp.element,{useSelect:b}=wp.data,{store:q}=wp.blockEditor,_=window.fluent_cart_product_carousel_block_editor_data,T=window.fluentCartRestVars.rest,H=[["fluent-cart/product-carousel-loop",{className:"fluent-cart-product-carousel-loop",layout:{type:"constrained"},metadata:{name:"Product Carousel Loop"}},[["fluent-cart/shopapp-product-image"],["fluent-cart/shopapp-product-title"],["fluent-cart/shopapp-product-excerpt"],["fluent-cart/shopapp-product-price"],["fluent-cart/shopapp-product-buttons"]]],["fluent-cart/product-carousel-controls"],["fluent-cart/product-carousel-pagination"]];X(_.slug+"/"+_.name,{apiVersion:3,title:_.title,description:_.description,example:{attributes:{},innerBlocks:[{name:"core/image",attributes:{url:W,alt:"Product Carousel Preview",style:{width:"100%",height:"auto"}}}]},icon:{src:z},category:"fluent-cart",supports:{html:!1,reusable:!1,innerBlocks:!0},attributes:{product_ids:{type:"array",default:[]},inside_product_info:{type:"string",default:"-"},carousel_settings:{type:"object",default:{slidesToShow:3,autoplay:"yes",arrows:"yes",dots:"yes",infinite:"no",arrowsSize:"md",paginationType:"dots"}}},provides_context:{"fluent-cart/carousel_settings":"carousel_settings","fluent-cart/product_ids":"product_ids"},edit:({attributes:s,setAttributes:l,clientId:n})=>{const f=E({className:"fluent-cart-product-carousel-block"}),[r,i]=g([]),[v,A]=g([]),[o,h]=g(!1),a=Math.max(1,Number(s.carousel_settings.slidesToShow||4)),m=s.carousel_settings.infinite==="yes",w=b(c=>{const{getBlockParents:d,getBlockName:y}=c(q);return d(n).some(t=>y(t)==="fluent-cart/product-info")},[n]);x(()=>{const c=w?"yes":"no";s.inside_product_info!==c&&l({inside_product_info:c})},[w]);const D=()=>{if(!(Array.isArray(s.product_ids)&&s.product_ids.length>0))return;h(!0);const d=T.url+"/products/fetchProductsByIds",y={productIds:s.product_ids,with:["detail","variants"]};F({path:V(d,y),headers:{"X-WP-Nonce":T.nonce}}).then(t=>{var N;const R=Array.isArray((N=t==null?void 0:t.products)==null?void 0:N.data)?t.products.data:Array.isArray(t==null?void 0:t.products)?t.products:Array.isArray(t)?t:[];i(R),console.log("api response",r)}).finally(()=>{h(!1)})};x(()=>{D()},[s.product_ids]),x(()=>{},[r]);const L=(()=>{if(!r.length)return Array.from({length:a}).map((y,t)=>({ID:`placeholder-${t}`,isPlaceholder:!0}));if(!m||r.length>=a)return r.slice(0,a);const c=[...r];let d=0;for(;c.length<a;)c.push(r[d%r.length]),d++;return c.slice(0,a)})();Math.ceil((r.length||a)/a);const k=b(c=>c("core/block-editor").getBlock(n),[n]),[P,M]=g(1);x(()=>{if(P>1){new Date().toISOString();return}M(P+1)},[k]),k.innerBlocks;const[J,K]=g();return e.jsxs("div",{...f,children:[e.jsx(Q,{attributes:s,setAttributes:l,selectedProduct:r,setSelectedProduct:i}),e.jsx("div",{className:"fct-product-gallery-wrapper is-editor-preview",children:e.jsx("div",{className:"fct-product-gallery-carousel editor-carousel-preview",style:{display:"grid",gap:"16px"},children:o||!r.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fluent-cart-empty",style:{gridColumn:`span ${a}`},children:p("Loading products...")}),e.jsx("div",{className:"dummy-grid",children:Array.from({length:a}).map((c,d)=>e.jsxs("div",{className:"dummy-card",children:[e.jsx("div",{className:"dummy-image"}),e.jsx("div",{className:"dummy-title"}),e.jsx("div",{className:"dummy-excerpt"}),e.jsx("div",{className:"dummy-price"}),e.jsx("div",{className:"dummy-stock"}),e.jsxs("div",{className:"dummy-buy",children:[e.jsx("div",{className:"dummy-btn"}),e.jsx("div",{className:"dummy-btn"})]})]},d))})]}):e.jsx(U,{value:{products:L},children:e.jsx(I,{template:H})})})})]})},save:()=>{const s=E.save({className:"fluent-cart-product-carousel-block"});return e.jsx("div",{...s,children:e.jsx(I.Content,{})})}});
