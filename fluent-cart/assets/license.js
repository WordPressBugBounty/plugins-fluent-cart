var Ee=Object.defineProperty;var Pe=(s,t,l)=>t in s?Ee(s,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[t]=l;var Le=(s,t,l)=>Pe(s,typeof t!="symbol"?t+"":t,l);import{a as u,c as h,o,d as e,e as w,w as n,u as m,b as $,f as a,t as c,F as T,h as H,n as oe,g as x,i as O,m as ee,p as re,k as me,j as de,q as X,D as Ce,l as Ve,K as q,aj as Ae,r as Te}from"./chunks/vue.esm-bundler.js";import{C as R,c as B,d as N,T as Ue,_ as Me,a as Ie,f as Oe}from"./chunks/RouteCell.js";import{L as ne,_ as Be}from"./chunks/NotFound.js";import{_ as Ne,m as Se,a as Fe,d as Re,T as Y,i as xe}from"./chunks/dateShortCuts.js";import{_ as pe,P as He}from"./chunks/Empty.js";import{_ as j}from"./chunks/DynamicIcon.js";import{t as p,A as ce}from"./chunks/Translator.js";import{A as ae}from"./chunks/Arr.js";import{I as ue,B as W,S as De}from"./chunks/Badge.js";import{a as ze,cq as je,b as qe}from"./chunks/index.js";import{_ as le,P as Ye,L as Ke,O as ie,e as We,d as Ge}from"./chunks/OrderCustomerInformation.js";import{_ as G}from"./chunks/_plugin-vue_export-helper.js";import{d as Z}from"./chunks/dayjs.min.js";import{M as Xe}from"./chunks/Model.js";import{R as $e}from"./chunks/Rest.js";import{b as Q,i as Ze}from"./chunks/common.js";import{a as _e,C as Je}from"./chunks/CopyToClipboard.js";import{S as Qe}from"./chunks/Str.js";import"./chunks/Url.js";import"./chunks/timezone.js";import"./chunks/Notify.js";import"./chunks/Utils.js";import"./chunks/Asset.js";import"./chunks/index3.js";import"./chunks/productService.js";const et={class:"fct-license-settings fct-layout-width"},tt={key:1,class:"fct-license-settings-body"},nt={class:"fct-licensed-product-table hide-on-mobile"},at={class:"fct-media-with-content"},st={class:"media"},lt=["src","alt"],it={class:"title"},ot=["innerHTML"],rt=["innerHTML"],ct={class:"fct-product-pricing-table-item"},dt={class:"fct-licensed-product-table-mobile"},ut={class:"fct-licensed-product-table-mobile-col"},_t={class:"root-title"},mt={class:"fct-media-with-content"},pt={class:"media"},ht=["src","alt"],ft={class:"title"},gt=["innerHTML"],vt=["innerHTML"],bt={class:"fct-licensed-product-table-mobile-col"},yt={class:"root-title"},wt={class:"fct-product-pricing-table-item"},kt={key:0},Lt={class:"custom-wp-editor-wrapper relative"},Ct={class:"absolute mb-0 font-bold"},St={key:2,class:"fct-bundle-license-info",style:{padding:"40px 20px"}},Dt={class:"flex items-center justify-center mb-4"},xt={style:{"max-width":"600px",margin:"0 auto",color:"#606266","line-height":"1.6","text-align":"left"}},$t={class:"text-sm font-medium mb-3 text-system-dark dark:text-gray-50"},Et={style:{"font-size":"14px"}},Pt={key:0,class:"setting-save-action"},Vt={name:"LicenseSettings",props:["product_id"],data(){return{settings:null,saving:!1,loading:!1,product:{},globalUpdateFile:{},selectedFile:null,fetchSettings:!1,isBundleProduct:!1}},methods:{translate:p,fetchProduct(){this.loading=!0,this.$get("products/"+this.product_id+"/pricing",{}).then(s=>{this.product=s.product}).catch(s=>{this.handleError(s)}).finally(()=>{this.loading=!1})},getSettings(){this.fetchSettings=!0,this.$get(`licensing/products/${this.product_id}/settings`).then(s=>{var t,l;this.settings=s.settings,this.isBundleProduct=s.is_bundle_product||!1,this.selectedFile=(t=s.settings.global_update_file)!=null&&t.id?parseInt((l=s.settings.global_update_file)==null?void 0:l.id):""}).catch(s=>{this.handleError(s)}).finally(()=>{this.fetchSettings=!1})},updateSettings(){if(this.isBundleProduct){this.handleError({message:this.translate("License settings cannot be saved for bundle products. Licenses are generated according to bundle items' license settings.")});return}this.saving=!0,this.$post(`licensing/products/${this.product_id}/settings`,{settings:this.settings}).then(s=>{this.handleSuccess(s.message)}).catch(s=>{this.handleError(s)}).finally(()=>{this.saving=!1})},imageUrl(s){var t;return s&&((t=s.meta_value)==null?void 0:t.length)>0?s.meta_value[0].url:this.appVars.asset_url+"images/empty-image.svg"},imageAlt(s){var t;return s&&((t=s.meta_value)==null?void 0:t.length)>0?s.meta_value[0].title:"No Image"}},mounted(){this.getSettings(),this.fetchProduct();const s=document.querySelector("#fct_admin_menu_holder .fct-admin-product-header");s&&document.querySelector("#fluent_cart_plugin_app").prepend(s)}},At=Object.assign(Vt,{setup(s){return(t,l)=>{const L=u("el-switch"),r=u("el-skeleton"),i=u("el-table-column"),S=u("el-input"),C=u("el-table"),b=u("el-form-item"),D=u("el-col"),E=u("el-option"),y=u("el-select"),A=u("el-row"),v=u("el-form"),I=u("el-button");return o(),h("div",et,[e(N,null,{default:n(()=>[e(R,{border_bottom:"",title:m(p)("License Settings")},{action:n(()=>[t.settings?(o(),$(L,{key:0,modelValue:t.settings.enabled,"onUpdate:modelValue":l[0]||(l[0]=f=>t.settings.enabled=f),"active-value":"yes","inactive-value":"no","active-text":m(p)("Enable Licensing for this product"),disabled:t.isBundleProduct},null,8,["modelValue","active-text","disabled"])):w("",!0)]),_:1},8,["title"]),e(B,null,{default:n(()=>[t.fetchSettings?(o(),$(r,{key:0,rows:6,animated:!0})):w("",!0),t.settings&&!t.fetchSettings?(o(),h("div",tt,[t.settings.enabled==="yes"?(o(),$(v,{key:0,"label-position":"top",modelValue:t.settings,"onUpdate:modelValue":l[11]||(l[11]=f=>t.settings=f)},{default:n(()=>[e(b,null,{default:n(()=>[a("div",nt,[e(C,{ref:"elTable","row-key":f=>f.rowId,data:t.settings.variations},{default:n(()=>[e(i,{label:m(p)("Variant"),width:300},{default:n(f=>[a("div",at,[a("div",st,[a("img",{src:t.imageUrl(f.row.media),alt:t.imageAlt(f.row.media)},null,8,lt)]),a("div",null,[a("div",it,c(f.row.title),1),f.row.subscription_info?(o(),h("div",{key:0,class:"text",innerHTML:f.row.subscription_info},null,8,ot)):w("",!0),f.row.setup_fee_info?(o(),h("div",{key:1,class:"text",innerHTML:f.row.setup_fee_info},null,8,rt)):w("",!0)])])]),_:1},8,["label"]),e(i,{width:140},{header:n(()=>[e(ne,{title:m(p)("Activation Limit"),content:m(p)("Activation limit controls how many sites/devices can use this license. License validity matches your subscription interval. For example, an annual subscription will generate a license valid for one year.")},null,8,["title","content"])]),default:n(f=>[a("div",ct,[e(S,{type:"number",min:1,placeholder:m(p)("Use 0 or empty for no limit"),modelValue:f.row.activation_limit,"onUpdate:modelValue":U=>f.row.activation_limit=U},null,8,["placeholder","modelValue","onUpdate:modelValue"])])]),_:1})]),_:1},8,["row-key","data"])]),a("div",dt,[(o(!0),h(T,null,H(t.settings.variations,f=>(o(),h("div",{class:"fct-licensed-product-table-mobile-row",key:f.rowId},[a("div",ut,[a("div",_t,c(m(p)("Variant")),1),a("div",mt,[a("div",pt,[a("img",{src:t.imageUrl(f.media),alt:t.imageAlt(f.media)},null,8,ht)]),a("div",null,[a("div",ft,c(f.title),1),f.subscription_info?(o(),h("div",{key:0,class:"text",innerHTML:f.subscription_info},null,8,gt)):w("",!0),f.setup_fee_info?(o(),h("div",{key:1,class:"text",innerHTML:f.setup_fee_info},null,8,vt)):w("",!0)])])]),a("div",bt,[a("div",yt,[e(ne,{title:m(p)("Activation Limit"),content:m(p)("Activation limit controls how many sites/devices can use this license. License validity matches your subscription interval. For example, an annual subscription will generate a license valid for one year.")},null,8,["title","content"])]),a("div",wt,[e(S,{type:"number",min:1,placeholder:m(p)("Use 0 or empty for no limit"),modelValue:f.activation_limit,"onUpdate:modelValue":U=>f.activation_limit=U},null,8,["placeholder","modelValue","onUpdate:modelValue"])])])]))),128))])]),_:1}),e(A,{gutter:20},{default:n(()=>[e(D,{lg:8},{default:n(()=>[e(b,null,{label:n(()=>[e(ne,{title:m(p)("Version Number"),content:m(p)("Enter the current version number of your product.")},null,8,["title","content"])]),default:n(()=>[e(S,{placeholder:m(p)("Your Product Version"),modelValue:t.settings.version,"onUpdate:modelValue":l[1]||(l[1]=f=>t.settings.version=f)},null,8,["placeholder","modelValue"])]),_:1})]),_:1}),e(D,{lg:8},{default:n(()=>[e(b,null,{label:n(()=>[e(ne,{title:m(p)("License Key Prefix (Optional)"),content:m(p)("If you add any prefix here then it will will be used as the prefix of the generated license key")},null,8,["title","content"])]),default:n(()=>[e(S,{placeholder:m(p)("Your License Key Prefix"),modelValue:t.settings.prefix,"onUpdate:modelValue":l[2]||(l[2]=f=>t.settings.prefix=f)},null,8,["placeholder","modelValue"])]),_:1})]),_:1}),t.fetchSettings?w("",!0):(o(),$(D,{key:0,lg:8},{default:n(()=>[e(b,null,{label:n(()=>[e(ne,{title:m(p)("Update File"),content:m(p)("Update File (Choose the source file to get automatic updates)")},null,8,["title","content"])]),default:n(()=>{var f,U;return[((U=(f=t.product)==null?void 0:f.downloadable_files)==null?void 0:U.length)===0?(o(),h("span",kt,c(m(p)("No downloadable files found")),1)):(o(),$(y,{key:1,modelValue:t.settings.global_update_file,"onUpdate:modelValue":l[3]||(l[3]=_=>t.settings.global_update_file=_),placeholder:m(p)("Update File")},{default:n(()=>[(o(!0),h(T,null,H(t.product.downloadable_files,_=>(o(),$(E,{key:_.id,label:_.title,value:_.id.toString()},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]))]}),_:1})]),_:1}))]),_:1}),e(b,null,{default:n(()=>[a("div",Lt,[a("label",Ct,c(m(p)("Changelog Description")),1),e(Ne,{modelValue:t.settings.changelog,onUpdate:l[4]||(l[4]=f=>{t.settings.changelog=f})},null,8,["modelValue"])])]),_:1}),a("div",{class:oe("is-wp-product-wrap "+(t.settings.wp.is_wp==="yes"?"pb-0":""))},[a("div",{class:oe(t.settings.wp.is_wp==="yes"?"pb-4":"")},[e(L,{modelValue:t.settings.wp.is_wp,"onUpdate:modelValue":l[5]||(l[5]=f=>t.settings.wp.is_wp=f),"active-value":"yes","inactive-value":"no","active-text":m(p)("Is WP Plugin?")},null,8,["modelValue","active-text"])],2),t.settings.wp.is_wp==="yes"?(o(),h(T,{key:0},[e(b,{label:m(p)("Changelog Page URL")},{default:n(()=>[e(S,{placeholder:m(p)("Your Product Changelog Page URL"),modelValue:t.settings.wp.readme_url,"onUpdate:modelValue":l[6]||(l[6]=f=>t.settings.wp.readme_url=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),e(A,{gutter:20},{default:n(()=>[e(D,{md:12},{default:n(()=>[e(b,{label:m(p)("Banner URL")},{default:n(()=>[e(S,{placeholder:m(p)("Plugin Banner URL"),modelValue:t.settings.wp.banner_url,"onUpdate:modelValue":l[7]||(l[7]=f=>t.settings.wp.banner_url=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),e(D,{md:12},{default:n(()=>[e(b,{label:m(p)("Icon URL")},{default:n(()=>[e(S,{placeholder:m(p)("Plugin Icon URL"),modelValue:t.settings.wp.icon_url,"onUpdate:modelValue":l[8]||(l[8]=f=>t.settings.wp.icon_url=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),e(D,{md:12,xs:24},{default:n(()=>[e(b,{label:m(p)("Required PHP Version (optional)")},{default:n(()=>[e(S,{placeholder:m(p)("Required PHP Version"),modelValue:t.settings.wp.required_php,"onUpdate:modelValue":l[9]||(l[9]=f=>t.settings.wp.required_php=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),e(D,{md:12,xs:24},{default:n(()=>[e(b,{label:m(p)("Required WP Version (optional)")},{default:n(()=>[e(S,{placeholder:m(p)("Required WP Version"),modelValue:t.settings.wp.required_wp,"onUpdate:modelValue":l[10]||(l[10]=f=>t.settings.wp.required_wp=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})],64)):w("",!0)],2)]),_:1},8,["modelValue"])):w("",!0),t.settings.enabled!=="yes"&&!t.isBundleProduct?(o(),$(pe,{key:1,icon:"Empty/WebPage",text:m(p)("License for this product has not been enabled")},null,8,["text"])):w("",!0),t.isBundleProduct?(o(),h("div",St,[a("div",Dt,[e(j,{name:"Empty/WebPage",class:"w-[100px]"})]),a("div",xt,[a("p",$t,c(m(p)("License Settings Not Available for Bundle Products")),1),a("p",Et,c(m(p)("Licenses are managed by bundle items themselves. Only pricing follows the bundle product (e.g., yearly bundle pricing results in yearly licenses for child bundle items).")),1)])])):w("",!0)])):w("",!0)]),_:1})]),_:1}),t.settings&&!t.isBundleProduct?(o(),h("div",Pt,[e(I,{onClick:l[12]||(l[12]=f=>t.updateSettings()),loading:t.saving,disabled:t.saving,type:"primary"},{default:n(()=>[x(c(m(p)(" Update Settings")),1)]),_:1},8,["loading","disabled"])])):w("",!0)])}}});class Tt extends Ue{setupInitialData(){super.setupInitialData(),this.data.sorting.sortBy="order_id"}getTabs(){return{all:p("All"),active:p("Active"),inactive:p("Inactive"),expired:p("Expired"),disabled:p("Disabled")}}getToggleableColumns(){return[{label:p("Order ID"),value:"order_id"},{label:p("Product"),value:"product"},{label:p("Customer"),value:"customer"},{label:p("Date"),value:"date"}]}getSortableColumns(){return[{label:"Order ID",value:"order_id"},{label:"Activation Count",value:"activation_count"},{label:"Expiration Date",value:"expiration_date"},{label:"Date",value:"created_at"},{label:"Status",value:"status"}]}getSearchHint(){return p("by license key, order id, customer name/email or connected sites.")}getFetchUrl(){return"licensing/licenses"}parseResponse(t){return t.licenses}getTableName(){return"licenses"}getAdvanceFilterOptions(){return ae.get(window,"fluentCartAdminApp.filter_options.license_filter_options.advance")}getSearchGuideOptions(){return ae.get(window,"fluentCartAdminApp.filter_options.license_filter_options.guide")}with(){return["customer","product:ID,post_title","productVariant:id,variation_title"]}}function Ut(s){return Tt.init(s)}class Mt extends Xe{constructor(){super(...arguments);Le(this,"data",{summaryData:[],lineChartData:[],pieChartData:[],isBusy:!1})}get controllerKey(){return"LicenseReportController"}beforeInit(){}makeRequest(l,L,r,i){this.data.isBusy=!0,typeof L!="object"&&(L={});const S=$e.get(`reports/${l}`,L);return this.resolvePromiseResponse(S,r,i),S}resolvePromiseResponse(l,L=null,r=null){l.then(i=>{r==null||L==null||(this.data[r]=i[L])}).catch(i=>{console.log(i,"error")}).finally(()=>{this.data.isBusy=!1})}getLicenseLineChart(l={}){return this.makeRequest("license-chart",l,"lineChartData","lineChartData")}getLicensePieChart(l={}){return this.makeRequest("license-pie-chart",l,"pieChartData","pieChartData")}getSummary(l={}){return this.makeRequest("license-summary",l,"summaryData","summaryData")}}const F=Mt.init(),It={class:"fct-license-statistics-wrap"},Ot={class:"fct-btn-group sm"},Bt={class:"chart-action-wrap"},Nt={class:"chart-change-wrap"},Ft={class:"chart-change"},Rt={class:"text"},Ht={class:"chart-change"},zt={class:"text"},jt={__name:"LicenseStatistics",props:{reportFilter:{type:Object}},setup(s){const t=s,l=O(null),L=O("daily"),r=O("line"),i=O([Z().startOf("month"),Z()]),S=[{value:"daily",label:"Daily"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}],C=ee(()=>[{title:"Total License",key:"total_license",color:"#2ecc71"}].map(({title:_,key:d,color:k},g)=>v(_,r.value,g%2,F.data.lineChartData.map(M=>M.license_count),k))),b=ee(()=>F.data.lineChartData.map(_=>{if(L.value==="daily"){const[d,k,g]=_.date.split("-");return`${Se[parseInt(k)-1]} ${g}, ${d}`}else{if(L.value==="monthly")return`${Se[parseInt(_.month)-1]} ${_.year}`;if(L.value==="yearly")return`${_.year}`}}));let D=null;const E=()=>{l.value&&D===null&&(D=xe(l.value),y())},y=()=>{const _={title:{text:t.chartTitle??"",left:"center"},legend:{show:!1},tooltip:{trigger:"axis",backgroundColor:Y.isDark()?"#38485a":"#ffffff",borderColor:Y.isDark()?"#4a5a6b":"#c0c4ca",borderWidth:1,textStyle:{color:Y.isDark()?"#ffffff":"#565865"}},xAxis:{type:"category",data:b.value,axisLabel:{color:Y.isDark()?"#ffffff":"#565865",fontSize:12}},yAxis:[{type:"value",axisLabel:{color:Y.isDark()?"#ffffff":"#565865",fontSize:12},splitLine:{show:!0,lineStyle:{color:Y.isDark()?"#38485a":"#D6DAE1"}}},{type:"value",position:"right",axisLabel:{color:Y.isDark()?"#ffffff":"#565865",fontSize:12},splitLine:{show:!1}}],dataZoom:[],series:C.value};D.setOption(_,{notMerge:!0,replaceMerge:["series"]})},A=()=>{const _={startDate:i.value[0].toISOString(),endDate:i.value[1].toISOString()};F.getLicenseLineChart({params:{..._,groupKey:L.value}})},v=(_,d,k,g,M)=>({name:_,type:d,yAxisIndex:k,data:g,smooth:!0,color:M,lineStyle:{width:3}}),I=()=>{A()},f=()=>{A()},U=_=>{r.value!==_&&(r.value=_,y())};return re([()=>F.chartData,r],()=>{X(y)},{deep:!0}),re(()=>F.data.lineChartData,()=>{X(()=>{y()})},{deep:!0}),me(()=>{window.removeEventListener("onFluentCartThemeChange",y,!1)}),de(()=>{window.addEventListener("onFluentCartThemeChange",y),A(),X(E)}),(_,d)=>{const k=u("el-option"),g=u("el-select"),M=u("el-date-picker");return o(),h("div",It,[e(N,{id:"chartContainer"},{default:n(()=>[e(R,{title:_.$t("License Chart"),title_size:"small",border_bottom:""},{action:n(()=>[a("div",Ot,[e(Fe,{activeType:r.value,types:{line:"LineChart",bar:"BarChart"},onChange:U},null,8,["activeType"]),e(g,{class:"w-[100px] el-select--x-small",modelValue:L.value,"onUpdate:modelValue":d[0]||(d[0]=P=>L.value=P),onChange:f},{default:n(()=>[(o(),h(T,null,H(S,P=>e(k,{key:P.value,label:_.$t(P.label),value:P.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e(M,{class:"w-[220px] el-range-editor--x-small hide-close-icon",modelValue:i.value,"onUpdate:modelValue":d[1]||(d[1]=P=>i.value=P),type:"daterange","range-separator":"-","start-placeholder":_.$t("Start date"),"end-placeholder":_.$t("End date"),"unlink-panels":"",clearable:!1,shortcuts:m(Re),onChange:I},null,8,["modelValue","start-placeholder","end-placeholder","shortcuts"])])]),_:1},8,["title"]),e(B,null,{default:n(()=>[a("div",{class:"fct-license-statistics-chart",ref_key:"chartRef",ref:l},null,512),a("div",Bt,[a("div",Nt,[a("div",Ft,[d[2]||(d[2]=a("svg",{width:"9",height:"11",viewBox:"0 0 9 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M4.6087 10.5L4.6087 1.46395",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"}),a("path",{d:"M1.00004 4.05762L4.55764 0.500019L8.11523 4.05762",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),a("span",Rt,c(_.$t("Data")),1)]),a("div",Ht,[a("span",zt,c(_.$t("Timeline")),1),d[3]||(d[3]=a("svg",{class:"rotate-90",width:"9",height:"11",viewBox:"0 0 9 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M4.6087 10.5L4.6087 1.46395",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"}),a("path",{d:"M1.00004 4.05762L4.55764 0.500019L8.11523 4.05762",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"})],-1))])])])]),_:1})]),_:1})])}}},qt={class:"fct-usage-statistics-chart-wrap"},Yt={class:"fct-usage-statistics-info flex items-center justify-between"},Kt={class:"text-lg font-semibold text-system-dark dark:text-gray-50"},Wt={class:"text-xs font-medium text-system-mid dark:text-gray-300"},Gt={class:"fct-custom-legend",style:{width:"100%"}},Xt={style:{margin:"0 0 15px 0","font-size":"14px","font-weight":"600"}},Zt={class:"legend-items"},Jt=["onClick","onMouseenter","onMouseleave"],Qt={style:{flex:"1","min-width":"0"}},en={style:{display:"flex","justify-content":"space-between","align-items":"center"}},tn=["title"],nn={class:"legend-item-percentage"},an={class:"legend-item-count"},sn={class:"fct-custom-legend-controls"},ln={class:"fct-action-link-btn"},on={class:"fct-chart-container",style:{display:"flex","align-items":"flex-start"}},rn={__name:"UsageStatistics",props:{reportFilter:{type:Object},activatedSites:String|Number},setup(s){const t=s,l=Y.colors;l.blue;const L=O(null),r=O("daily"),i=O("pie"),S=O([Z().startOf("month"),Z()]),C=O({}),b=ee(()=>F.data.pieChartData?F.data.pieChartData.map((k,g)=>({name:k.post_title,value:k.activation_count,percentage:k.percentage,color:D(g),visible:C.value[k.post_title]!==!1})):[]),D=k=>{const g=["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc","#ffb347"];return g[k%g.length]},E=ee(()=>F.data.pieChartData.filter(k=>C.value[k.post_title]!==!1).map((k,g)=>({value:k.activation_count,name:k.post_title,itemStyle:{color:D(F.data.pieChartData.findIndex(M=>M.post_title===k.post_title))}})));let y=null;const A=()=>{L.value&&y===null&&(y=xe(L.value),v())},v=()=>{if(!y)return;const k={title:{text:t.chartTitle??"",left:"center"},legend:{show:!1},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)",borderRadius:8,backgroundColor:Y.isDark()?"#38485a":"#ffffff",textStyle:{color:Y.isDark()?l.gray[25]:l.system.mid},borderColor:Y.isDark()?"#4a5a6b":"#c0c4ca",borderWidth:1},series:[{type:"pie",radius:"55%",center:["50%","50%"],data:E.value,label:{show:!0,color:Y.isDark()?l.gray[25]:l.system.dark},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};y.setOption(k,{notMerge:!0,replaceMerge:["series"]})},I=k=>{C.value[k.name]=!k.visible,X(()=>{v()})},f=(k,g)=>{y&&(g?y.dispatchAction({type:"highlight",name:k.name}):y.dispatchAction({type:"downplay",name:k.name}))},U=()=>{const k={startDate:S.value[0].toISOString(),endDate:S.value[1].toISOString()};F.getLicensePieChart({params:{...k,groupKey:r.value}})},_=()=>{F.data.pieChartData&&F.data.pieChartData.forEach(k=>{k.post_title in C.value||(C.value[k.post_title]=!0)})};re([()=>F.chartData,i],()=>{X(v)},{deep:!0}),re(()=>F.data.pieChartData,()=>{_(),X(()=>{v()})},{deep:!0});const d=k=>{v()};return de(()=>{window.addEventListener("onFluentCartThemeChange",d),U(),X(A)}),me(()=>{window.removeEventListener("onFluentCartThemeChange",d)}),(k,g)=>{const M=u("el-popover");return o(),h("div",qt,[a("div",Yt,[a("div",Kt,[x(c(s.activatedSites)+" ",1),a("div",Wt,c(k.$t("Total Activated Sites")),1)]),e(M,{placement:"bottom-start",width:226,trigger:"click","popper-class":"fct-license-statistics-popover"},{reference:n(()=>[a("div",ln,[e(ue,null,{default:n(()=>[e(j,{name:"More"})]),_:1})])]),default:n(()=>[a("div",Gt,[a("h4",Xt,c(k.$t("License Distribution")),1),a("div",Zt,[(o(!0),h(T,null,H(b.value,P=>(o(),h("div",{key:P.name,class:oe(["legend-item",{"legend-item-hidden":!P.visible}]),onClick:J=>I(P),onMouseenter:J=>f(P,!0),onMouseleave:J=>f(P,!1),style:Ce({opacity:P.visible?1:.5})},[a("div",{class:"legend-color",style:Ce({backgroundColor:P.color})},null,4),a("div",Qt,[a("div",en,[a("span",{class:"legend-item-name",title:P.name},c(P.name),9,tn),a("span",nn,c(P.percentage)+"% ",1)]),a("div",an,c(m(p)("%s licenses",P.value.toLocaleString())),1)])],46,Jt))),128))]),a("div",sn,[a("button",{onClick:g[0]||(g[0]=()=>{Object.keys(C.value).forEach(P=>C.value[P]=!0),X(v)})},c(k.$t("Show All")),1),a("button",{onClick:g[1]||(g[1]=()=>{Object.keys(C.value).forEach(P=>C.value[P]=!1),X(v)})},c(k.$t("Hide All")),1)])])]),_:1})]),a("div",on,[a("div",{class:"fct-usage-statistics-chart",ref_key:"chartRef",ref:L,style:{flex:"1",height:"350px"}},null,512)])])}}},cn=G(rn,[["__scopeId","data-v-2fd9c692"]]),dn={},un={class:"p-4 bg-gray-25 rounded dark:bg-primary-500"},_n={class:"flex items-center gap-2 mb-3"},mn={class:"right flex flex-col flex-1 gap-2"};function pn(s,t){const l=u("el-skeleton-item"),L=u("el-skeleton");return o(),h(T,null,H(4,r=>e(L,{animated:"",key:r},{template:n(()=>[a("div",un,[a("div",_n,[e(l,{variant:"p",class:"rounded w-10 h-10 block"}),a("div",mn,[e(l,{variant:"p",class:"rounded w-4/5 block"}),e(l,{variant:"p",class:"rounded w-1/2 block"})])]),a("div",null,[e(l,{variant:"p",class:"rounded w-2/3 block"})])])]),_:2},1024)),64)}const hn=G(dn,[["render",pn]]),fn={name:"LicensesStatsCard",props:{licenseOverview:{type:Object,required:!0},loading:{type:Boolean}},components:{DynamicIcon:j,LicenseStatLoader:hn},methods:{translate:p}},gn={class:"licenses-stats-card-head"},vn={class:"licenses-icon"},bn={class:"licenses-stats-card-head-content"},yn={class:"title"},wn={class:"value"},kn={class:"text"};function Ln(s,t,l,L,r,i){const S=u("LicenseStatLoader"),C=u("DynamicIcon");return l.loading?(o(),$(S,{key:0})):(o(!0),h(T,{key:1},H(l.licenseOverview,(b,D)=>(o(),h("div",{class:oe(`licenses-stats-card ${D}`),key:D},[a("div",gn,[a("div",vn,[e(C,{name:b.icon},null,8,["name"])]),a("div",bn,[a("div",yn,c(i.translate(b.title)),1),a("div",wn,c(b.value),1)])]),a("div",kn,c(i.translate(b.text)),1)],2))),128))}const Cn=G(fn,[["render",Ln]]),Sn={name:"LicenseStats",props:{licenses:{type:Array,required:!0}},components:{DynamicIcon:j,CardBody:B,CardHeader:R,CardContainer:N,LicenseStatistics:jt,UsageStatistics:cn,LicensesStatsCard:Cn},data(){return{loading:!1,licenseSummary:{}}},methods:{translate:p,fetchSummary(){this.loading=!0,this.$get("reports/license-summary",{params:{start_date:Z().startOf("month").format("YYYY-MM-DD"),end_date:Z().format("YYYY-MM-DD")}}).then(s=>{this.licenseSummary=s.summaryData}).catch(s=>{this.handleError(s)}).finally(()=>{this.loading=!1})}},computed:{totalLicensedProducts(){var s;return((s=this.licenseSummary)==null?void 0:s.totalLicensedProducts)||0},totalActivatedSites(){var s;return((s=this.licenseSummary)==null?void 0:s.totalActivatedSites)||0},totalActiveLicense(){var s;return((s=this.licenseSummary)==null?void 0:s.totalActiveLicense)||this.licenses.filter(t=>t.status==="active").length},totalExpiredLicense(){var s;return((s=this.licenseSummary)==null?void 0:s.totalExpiredLicense)||this.licenses.filter(t=>t.status==="expired").length},totalInactiveLicense(){var s;return((s=this.licenseSummary)==null?void 0:s.totalInactiveLicense)||this.licenses.filter(t=>t.status==="inactive").length},licenseOverview(){return{"license-product":{title:"Licensed Product",value:this.totalLicensedProducts,text:`Active License ${this.totalActiveLicense}`,icon:"LicensedProduct"},"total-active":{title:"Total Active",value:this.totalActiveLicense,text:`New Active License ${this.totalActiveLicense}`,icon:"CheckCircle"},"total-expired":{title:"Total Expired",value:this.totalExpiredLicense,text:`New Expired License ${this.totalExpiredLicense}`,icon:"Warning"},"inactive-license":{title:"Inactive License",value:this.totalInactiveLicense,text:"Individual Sites",icon:"LicensedInactive"}}}},mounted(){this.fetchSummary()}},Dn={class:"fct-license-stats-wrap"},xn={class:"licenses-stats-row"},$n={class:"fct-usage-statistics-wrap"};function En(s,t,l,L,r,i){const S=u("CardHeader"),C=u("LicensesStatsCard"),b=u("CardBody"),D=u("CardContainer"),E=u("LicenseStatistics"),y=u("el-col"),A=u("el-skeleton"),v=u("UsageStatistics"),I=u("el-row");return o(),h("div",Dn,[e(D,null,{default:n(()=>[e(S,{title:i.translate("Overall License Stats"),border_bottom:"",title_size:"small"},null,8,["title"]),e(b,null,{default:n(()=>[a("div",xn,[e(C,{licenseOverview:i.licenseOverview,loading:r.loading},null,8,["licenseOverview","loading"])])]),_:1})]),_:1}),e(I,{gutter:30},{default:n(()=>[e(y,{md:24,lg:16},{default:n(()=>[e(E)]),_:1}),e(y,{md:24,lg:8},{default:n(()=>[e(D,null,{default:n(()=>[e(S,{title:i.translate("Usage Statistics"),border_bottom:"",title_size:"small"},null,8,["title"]),e(b,null,{default:n(()=>[a("div",$n,[r.loading?(o(),$(A,{key:0,animated:"",rows:4})):(o(),$(v,{key:1,activatedSites:i.totalActivatedSites},null,8,["activatedSites"]))])]),_:1})]),_:1})]),_:1})]),_:1})])}const Pn=G(Sn,[["render",En]]),Vn={class:"table-cell"},An={class:"w-full flex flex-col items-start justify-start gap-1"},Tn={class:"table-cell"},Un={class:"w-full flex flex-col items-start justify-start gap-1"},Mn={class:"table-cell"},In={class:"table-cell"},On={class:"table-cell"},Bn={__name:"LicensesLoader",props:{nextPageCount:{type:Number,default:0},licenseTable:{type:Object,default:()=>({})}},setup(s){const t=s,l=r=>t.licenseTable.columns.includes(r),L=Array.from({length:t.nextPageCount},(r,i)=>i+1);return(r,i)=>{const S=u("el-table-column"),C=u("el-skeleton-item"),b=u("el-table"),D=u("el-skeleton");return o(),$(D,{animated:""},{template:n(()=>[e(b,{data:m(L),class:"w-full compact-table responsive"},{empty:n(()=>i[0]||(i[0]=[])),default:n(()=>[w("",!0),e(S,{label:r.$t("License Key"),width:220},{default:n(()=>[a("div",Vn,[a("div",An,[e(C,{varient:"p",class:"w-1/5"}),e(C,{varient:"p",class:"w-3/5"})])])]),_:1},8,["label"]),l("product")!==-1?(o(),$(S,{key:1,width:200,label:r.$t("Product")},{default:n(()=>[a("div",Tn,[a("div",Un,[e(C,{varient:"p",class:"w-1/5"}),e(C,{varient:"p",class:"w-2/5"})])])]),_:1},8,["label"])):w("",!0),l("order_id")!==-1?(o(),$(S,{key:2,width:80,label:r.$t("Order ID")},{default:n(()=>[a("div",Mn,[e(C,{varient:"p",class:"w-3/5"})])]),_:1},8,["label"])):w("",!0),l("customer")!==-1?(o(),$(S,{key:3,width:100,label:r.$t("Customer")},{default:n(()=>[a("div",In,[e(C,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):w("",!0),e(S,{width:"100",label:r.$t("Activations")},{default:n(()=>[a("div",On,[e(C,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})}}},Nn={},Fn={class:"px-4 py-3"},Rn={class:"grid grid-cols-3 gap-5 mt-5"};function Hn(s,t){const l=u("el-skeleton-item"),L=u("el-skeleton");return o(),$(L,{animated:""},{template:n(()=>[a("div",Fn,[(o(),h(T,null,H(2,r=>a("div",{key:r,class:"flex items-center justify-between mb-3"},[e(l,{varient:"p",class:"w-1/2"}),e(l,{varient:"p",class:"w-[100px]"})])),64)),a("div",Rn,[(o(),h(T,null,H(3,r=>a("div",{key:r},[e(l,{varient:"p",class:"w-1/2"}),e(l,{varient:"p",class:"w-[100px]"})])),64))])])]),_:1})}const zn=G(Nn,[["render",Hn]]),jn={name:"LicenseTableMobile",components:{ProductInfo:Ye,UserCan:le,RouteCell:Me,DynamicIcon:j,IconButton:ue,CopyToClipboard:_e,Empty:pe,Badge:W},props:{licenses:{type:Array,required:!0},columns:{type:Array,default(){return["product","order_id","customer","date"]}},emptyText:{type:String,default:p("No Licenses found based on your filter")}},computed:{Clipboard(){return Je},formattedLicense(){return this.licenses.map(s=>{var t;return{...s,product:{...s.product,variation_title:((t=s.product_variant)==null?void 0:t.variation_title)||"n/a"}}})}},methods:{translate:p,formatDate:Q}},qn={class:"fct-table-mobile-wrap fct-licenses-table-mobile"},Yn=["onClick"],Kn={class:"fct-table-status-col"},Wn={key:0,class:"fct-table-date-col"},Gn={key:0},Xn={key:1},Zn={class:"fct-table-mobile-body"},Jn=["onClick"],Qn={class:"fct-license-key-wrap has-bg"},ea={class:"fct-license-key"},ta={class:"fct-license-key-inner pr-2"},na={class:"fct-table-mobile-footer"},aa={class:"fct-table-mobile-footer-row"},sa={key:0,class:"fct-table-id-col"},la={class:"title"},ia={key:1,class:"fct-table-customer-col"},oa={class:"title"},ra={class:"fct-table-activations-col"},ca={class:"title"},da={key:0,class:"py-6 text-center"};function ua(s,t,l,L,r,i){const S=u("Badge"),C=u("ProductInfo"),b=u("router-link"),D=u("DynamicIcon"),E=u("el-tooltip"),y=u("Empty"),A=u("UserCan");return o(),$(A,{permission:"licenses/view"},{default:n(()=>[a("div",qn,[(o(!0),h(T,null,H(i.formattedLicense,(v,I)=>(o(),h("div",{key:v.id,class:"fct-table-mobile-row"},[a("div",{class:"fct-table-mobile-header",onClick:f=>s.$router.push({name:"view_license",params:{license_id:v==null?void 0:v.id}})},[a("div",Kn,[(o(),$(S,{status:v.status,key:v.id},null,8,["status"]))]),l.columns.indexOf("date")!==-1?(o(),h("div",Wn,[a("span",null,c(i.formatDate(v.created_at)),1),t[0]||(t[0]=a("span",{class:"px-1"},"-",-1)),v.expiration_date?(o(),h("span",Gn,c(i.formatDate(v.expiration_date)),1)):(o(),h("span",Xn,c(i.translate("Lifetime")),1))])):w("",!0)],8,Yn),a("div",Zn,[l.columns.indexOf("product")!==-1?(o(),h("div",{key:0,class:"fct-table-product-col",onClick:f=>s.$router.push({name:"view_license",params:{license_id:v==null?void 0:v.id}})},[e(C,{product:v.product,hideProductId:!0,hideViewIcon:!0,hideImage:!0},null,8,["product"])],8,Jn)):w("",!0),a("div",Qn,[a("div",ea,[a("div",ta,[e(b,{class:"link",to:{name:"view_license",params:{license_id:v==null?void 0:v.id}}},{default:n(()=>[x(c(v.license_key),1)]),_:2},1032,["to"])]),e(E,{content:v.license_key,placement:"top","popper-class":"fct-tooltip"},{default:n(()=>[e(D,{class:"cursor-pointer p-1 w-6 h-6",name:"Copy",onClick:()=>{i.Clipboard.copy(v.license_key,{successMessage:i.translate("License Key copied to clipboard"),errorMessage:i.translate("Failed to copy License Key")})}},null,8,["onClick"])]),_:2},1032,["content"])])])]),a("div",na,[a("div",aa,[l.columns.indexOf("order_id")!==-1?(o(),h("div",sa,[a("div",la,c(i.translate("Order ID")),1),e(b,{class:"value",to:{name:"view_order",params:{order_id:v.order_id}}},{default:n(()=>[x(" #"+c(v.order_id),1)]),_:2},1032,["to"])])):w("",!0),l.columns.indexOf("customer")!==-1?(o(),h("div",ia,[a("div",oa,c(i.translate("Customer")),1),e(b,{class:"value",to:{name:"view_customer",params:{customer_id:v.customer_id}}},{default:n(()=>{var f;return[x(c(((f=v==null?void 0:v.customer)==null?void 0:f.full_name)||i.translate("No Name")),1)]}),_:2},1032,["to"])])):w("",!0),a("div",ra,[a("div",ca,c(i.translate("Activations")),1),e(b,{class:"value",to:{name:"view_license",params:{license_id:v==null?void 0:v.id}}},{default:n(()=>[x(c(v.activation_count)+" "+c("/")+" "+c(v.limit===0?"Unlimited":v.limit),1)]),_:2},1032,["to"])])])])]))),128)),i.formattedLicense.length===0?(o(),h("div",da,[e(y,{icon:"Empty/ListView","has-dark":"",text:l.emptyText},null,8,["text"])])):w("",!0)])]),_:1})}const _a=G(jn,[["render",ua]]),ma={class:"fct-all-license-page fct-layout-width"},pa={class:"fct-all-license-wrap"},ha={key:1},fa={__name:"Licenses",setup(s){const t=Ut(),l=O(!1),L=O(!1),r=()=>{L.value=window.innerWidth<768},i=C=>{C==="show_license_stats"&&(De.set("show_license_stats",!l.value),l.value=!l.value)},S=()=>{const C=De.get("show_license_stats");C&&(l.value=C)};return de(()=>{S(),r(),window.addEventListener("resize",r)}),me(()=>{window.removeEventListener("resize",r)}),(C,b)=>{const D=u("el-icon"),E=u("el-button"),y=u("el-dropdown-item"),A=u("el-dropdown-menu"),v=u("el-dropdown");return o(),h("div",ma,[e(He,{title:m(p)("Licenses")},{action:n(()=>[e(le,{permission:"reports/view"},{default:n(()=>[e(v,{trigger:"click","popper-class":"fct-dropdown",onCommand:i,placement:"bottom-end"},{dropdown:n(()=>[e(A,null,{default:n(()=>[e(y,{command:"show_license_stats"},{default:n(()=>[l.value?(o(),h(T,{key:1},[e(j,{name:"EyeOff"}),x(" "+c(m(p)("Hide License Stats")),1)],64)):(o(),h(T,{key:0},[e(j,{name:"Eye"}),x(" "+c(m(p)("Show License Stats")),1)],64))]),_:1})]),_:1})]),default:n(()=>[e(E,null,{default:n(()=>[x(c(m(p)("More actions"))+" ",1),e(D,null,{default:n(()=>[e(m(ze))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),e(le,{permission:"reports/view"},{default:n(()=>[l.value?(o(),$(Pn,{key:0,licenses:m(t).getTableData()},null,8,["licenses"])):w("",!0)]),_:1}),e(le,{permission:"licenses/view"},{default:n(()=>[a("div",pa,[e(Ie,{table:m(t),classicTabStyle:!0,"has-mobile-slot":!0},{mobile:n(()=>[m(t).isLoading()?(o(),$(zn,{key:0})):w("",!0),m(t).isLoading()?w("",!0):(o(),$(_a,{key:1,licenses:m(t).getTableData(),columns:m(t).data.columns},null,8,["licenses","columns"]))]),default:n(()=>[m(t).isLoading()?(o(),$(Bn,{key:0,licenseTable:m(t),"next-page-count":m(t).nextPageCount},null,8,["licenseTable","next-page-count"])):(o(),h("div",ha,[e(Ke,{licenses:m(t).getTableData(),columns:m(t).data.columns},null,8,["licenses","columns"])]))]),_:1},8,["table"])])]),_:1})])}}},ga={class:"el-form--label-top fct-plan-changer-content-wrap"},va={key:0},ba=["innerHTML"],ya={key:1},wa=["innerHTML"],ka={key:1,class:"fct-btn-group"},La={__name:"PlanChanger",props:{variations:{},product_id:"",variation_id:"",license:null,order:null,upgrade_path_base:""},setup(s){const t=s,l=O(!1),L=()=>{l.value=!0},r=Ve().ctx,i=O(""),S=O([]);let C=O(null);const b=ee(()=>{var _,d;return ce.get("shop.currency_sign")?ce.get("shop.currency_sign"):(d=(_=window.fluentcart_customer_profile_vars)==null?void 0:_.shop)!=null&&d.currency_sign?window.fluentcart_customer_profile_vars.shop.currency_sign:""}),D=ee(()=>{var _;return(_=t.order)==null?void 0:_.order_items.find(d=>d.payment_type==="subscription"||d.payment_type==="adjustment"||d.payment_type==="onetime")}),E=function(_){let d="";const k=_==null?void 0:_.payment_type,g=_==null?void 0:_.other_info;if((g==null?void 0:g.payment_type)==="subscription"&&k!=="adjustment"){(g==null?void 0:g.manage_setup_fee)==="yes"&&(d+=g.signup_fee_name+" : "+b.value+parseFloat(g.signup_fee/100)+", ");const M=Number(g==null?void 0:g.times)?(g==null?void 0:g.times)+" times":", Until Cancel";return d+=(_==null?void 0:_.formatted_total)+" Subscriptions "+g.repeat_interval+" "+M,d}else if((g==null?void 0:g.payment_type)==="subscription"&&k==="adjustment"){(g==null?void 0:g.manage_setup_fee)==="yes"&&(d+=g.signup_fee_name+" :"+parseFloat(g.signup_fee/100)+", ");const M=Number(g==null?void 0:g.times)?(g==null?void 0:g.times)+" times":", Until Cancel";return d+=(_==null?void 0:_.formatted_total)+" Subscriptions "+g.repeat_interval+" "+M,d}else if((g==null?void 0:g.payment_type)==="onetime")return d+=(_==null?void 0:_.formatted_total)+" One Time Payment";return _==null?void 0:_.other_info.billing_summary};let y=O("");const A=_=>{C=t.variations.find(d=>d.id.toString()===_),y.value=E(C)},v=_=>{var k,g;return((k=_==null?void 0:_.other_info)==null?void 0:k.payment_type)==="subscription"?(_==null?void 0:_.variation_title)+" - "+Qe.capitalize((g=_==null?void 0:_.other_info)==null?void 0:g.repeat_interval):(_==null?void 0:_.variation_title)+" - One Time Payment"},I=()=>{r.$get(`products/${t.product_id}/upgrade-paths`,{variation_id:t.variation_id}).then(_=>{_.data.forEach((d,k)=>{d.object_id===t.variation_id&&d.value.to_variants.forEach((g,M)=>{S.value.push({id:g,variation_title:v(t.variations.find(P=>P.id.toString()===g)),payment_type:d.payment_type,is_prorate:d.value.is_prorate,discount_amount:d.value.discount_amount})})})})},f=_=>{let d=_.discount_amount;return d>0?_.variation_title+" - "+(_.is_prorate.toString()==="1"?"( Prorated )":"(Full Charge Applies)")+" ( "+d+b.value+" discount )":_.variation_title+" - "+(_.is_prorate.toString()==="1"?"( Prorated )":"(Full Charge Applies)")};de(()=>{I()});const U=()=>{if(i.value){const _=new URL(t.upgrade_path_base);return _.searchParams.append("order_hash",t.order.uuid),_.searchParams.append("mode","upgrade_plan"),_.searchParams.append("variation_id",i.value),_.href}return!1};return(_,d)=>{const k=u("el-button"),g=u("el-option"),M=u("el-select"),P=u("el-form-item"),J=u("el-dialog");return S.value.length>0&&D.value?(o(),h(T,{key:0},[e(k,{class:"el-button--x-small",onClick:L,type:"primary"},{default:n(()=>[x(c(_.$t("Change Plan")),1)]),_:1}),e(J,{modelValue:l.value,"onUpdate:modelValue":d[1]||(d[1]=K=>l.value=K),title:_.$t("Change Plan"),"append-to-body":!0},{default:n(()=>[a("div",ga,[S.value.length>0?(o(),$(P,{key:0,label:_.$t("Change Plan to")},{default:n(()=>[e(M,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=K=>i.value=K),onChange:A,clearable:""},{default:n(()=>[(o(!0),h(T,null,H(S.value,K=>(o(),$(g,{key:K.id,label:f(K),value:K.id.toString()},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):w("",!0),e(P,{label:_.$t("New Plan")},{default:n(()=>[m(y)?(o(),h("span",va,[a("span",{innerHTML:m(y),class:"fct-plan-changer-text"},null,8,ba)])):(o(),h("span",ya,"---"))]),_:1},8,["label"]),e(P,{label:_.$t("Current Plan")},{default:n(()=>[a("span",{innerHTML:E(D.value),class:"fct-plan-changer-text"},null,8,wa)]),_:1},8,["label"]),U()?(o(),h("div",ka,[e(k,{type:"primary",tag:"a",href:U(),target:"_blank",rel:"noopener noreferrer",size:"small"},{default:n(()=>[x(c(_.$t(" Upgrade to New Plan")),1)]),_:1},8,["href"]),e(_e,{showMode:"basic_copy_btn",text:U()},null,8,["text"])])):w("",!0)])]),_:1},8,["modelValue","title"])],64)):w("",!0)}}},Ca={name:"UpgradePlan",components:{CopyToClipboard:_e,DynamicIcon:j},props:{variation_id:{type:[String,Number],required:!0},is_admin:{type:Boolean,required:!1,default:!1},product_id:{type:[String,Number],required:!0},order:{type:Object,required:!0},has_upgrades:{type:Boolean,required:!0},props_variations:{type:[Array,Object],required:!0},endpoint_path:{type:String,default:"products"},appendToBody:{type:Boolean,default:!0}},data(){return{variations:this.props_variations,upgradePlanModal:!1,selectedUpgradePath:"",upgradePaths:[]}},computed:{currencySign(){var s,t;return ce.get("shop.currency_sign")?ce.get("shop.currency_sign"):(t=(s=window.fluentcart_customer_profile_vars)==null?void 0:s.shop)!=null&&t.currency_sign?window.fluentcart_customer_profile_vars.shop.currency_sign:""}},methods:{translate:p,showUpgradePlanModal(){$e.get(`${this.endpoint_path}/variation/${this.variation_id}/upgrade-paths`,{params:{variation_id:this.variation_id,order_hash:this.order.uuid}}).then(s=>{this.upgradePaths=s.upgradePaths,this.upgradePlanModal=!0})},closeUpgradePlanModal(){this.upgradePlanModal=!1}}},Sa={class:"fct-upgrade-plan"},Da={key:0,class:"fct-upgrade-variation-table"},xa={class:"upgrade-title"},$a={class:"plan-price"},Ea={class:"plan-price"},Pa={class:"upgrade-cost"},Va={class:"upgrade-title"},Aa=["innerHTML"],Ta={key:0,class:"upgrade-text"},Ua={class:"upgrade-action"},Ma={key:1};function Ia(s,t,l,L,r,i){const S=u("el-button"),C=u("el-table-column"),b=u("el-table"),D=u("el-dialog");return o(),h("div",Sa,[l.has_upgrades?(o(),$(S,{key:0,size:"small",onClick:i.showUpgradePlanModal},{default:n(()=>[x(c(s.$t("Upgrade")),1)]),_:1},8,["onClick"])):w("",!0),e(D,{modelValue:r.upgradePlanModal,"onUpdate:modelValue":t[0]||(t[0]=E=>r.upgradePlanModal=E),"append-to-body":l.appendToBody,title:s.$t("Upgrade"),class:"fct-upgrade-plan-dialog fluent-cart-customer-profile-app"},{default:n(()=>[r.upgradePaths.length>0?(o(),h("div",Da,[e(b,{data:r.upgradePaths,style:{width:"100%"}},{default:n(()=>[e(C,{label:s.$t("Package"),width:290},{default:n(E=>[a("div",xa,c(E.row.title),1)]),_:1},8,["label"]),e(C,{label:s.$t("Price"),width:100},{default:n(E=>[a("div",$a,[a("div",Ea,c(s.formatNumber(E.row.price,l.order.currency)),1)])]),_:1},8,["label"]),e(C,{label:s.$t("Amount to pay")},{default:n(E=>[a("div",Pa,[a("div",Va,[a("span",{innerHTML:E.row.payment_summary},null,8,Aa),E.row.prorate_credit?(o(),h("div",Ta)):w("",!0)])])]),_:1},8,["label"]),e(C,{label:s.$t("Action"),width:110},{default:n(E=>[a("div",Ua,[e(S,{class:"el-button--x-small",tag:"a",href:E.row.upgrade_url,target:"_blank"},{default:n(()=>[x(c(s.$t("Upgrade")),1)]),_:2},1032,["href"])])]),_:1},8,["label"])]),_:1},8,["data"])])):(o(),h("div",Ma,c(s.$t("No upgrade plan found")),1))]),_:1},8,["modelValue","append-to-body","title"])])}const Oa=G(Ca,[["render",Ia]]),Ba={name:"LicenseInformation",components:{Badge:W,CopyToClipboard:_e,DynamicIcon:j,IconButton:ue,PlanChanger:La,UpgradePlan:Oa},props:{license:"license",customerId:"customerId",license_id:"license_id",activations:"activations",product:null,order:null,upgrade_path_base:""},data(){return{isDateSelected:!1,isCalendarOpen:!1,selectedDate:null,loading:!1,isConfirmationIconEnable:!1,limit:this.license.limit,variations:[],variation_id:this.license.variation_id+"",licenseLifetime:!1,isExpirationDateEnable:!1,isActivationLimitEnable:!1}},watch:{product:{handler(){var s;(s=this.product)!=null&&s.variants&&(this.variations=this.product.variants)},deep:!0,immediate:!0}},methods:{translate:p,formatDate:Q,translateNumber:p,handleToggleExpirationDate(){this.isExpirationDateEnable=!this.isExpirationDateEnable},handleToggleActivationLimit(){this.isActivationLimitEnable=!this.isActivationLimitEnable},handleLifetimeLicense(){this.$confirm(this.$t("Are you sure you want to mark license as lifetime?"),this.$t("Confirm!"),{cancelButtonText:this.$t("No,Thanks"),confirmButtonText:this.$t("Confirm"),type:"warning"}).then(()=>{this.markAsLifetime()}).catch(()=>{this.licenseLifetime=!1})},handleActivationLimit(){this.$confirm(this.$t("Are you sure you want to mark limit as unlimited?"),this.$t("Confirm!"),{cancelButtonText:this.$t("No,Thanks"),confirmButtonText:this.$t("Confirm"),type:"warning"}).then(()=>{this.markAsUnlimited()}).catch(()=>{})},handleDateChange(){this.newExpirationDate=Z(this.selectedDate).format("YYYY-MM-DD HH:mm:ss"),this.extendValidity()},handleLimitChange(){this.isConfirmationIconEnable=!0},markAsLifetime(){this.licenseLifetime=!0,this.newExpirationDate="lifetime",this.extendValidity()},markAsUnlimited(){this.activationLimitUnlimited=!0,this.limit="unlimited",this.updateLimit()},regenerateLicenseKey(){this.$post("licensing/licenses/"+this.license_id+"/regenerate-key").then(s=>{this.$emit("fetchLicense"),this.handleSuccess(s.message)}).catch(s=>{this.handleError(s)}).finally(()=>{this.loading=!1})},extendValidity(){this.$post("licensing/licenses/"+this.license_id+"/extend-validity",{expiration_date:this.newExpirationDate}).then(s=>{this.newExpirationDate=null,this.$emit("fetchLicense"),this.handleSuccess(s.message),this.selectedDate=null,this.licenseLifetime=!0}).catch(s=>{this.handleError(s),this.licenseLifetime=!1}).finally(()=>{this.loading=!1})},updateLimit(){this.$post("licensing/licenses/"+this.license_id+"/update_limit",{limit:this.limit}).then(s=>{this.$emit("fetchLicense"),this.handleSuccess(s.message),this.isConfirmationIconEnable=!1}).catch(s=>{this.handleError(s),this.isConfirmationIconEnable=!1}).finally(()=>{this.loading=!1})},resetLimit(){this.limit=this.license.limit,this.isConfirmationIconEnable=!1}},mounted(){var t;const s=(t=this.$refs.calendar)==null?void 0:t.$el.querySelector("input");s&&s.addEventListener("keydown",l=>{l.key==="Enter"&&this.handleDateChange()})}},Na={class:"fct-license-info-content"},Fa={class:"flex items-center gap-2"},Ra={class:"fct-input-with-action-wrap"},Ha={class:"fct-input-with-action"},za={class:"fct-license-product"},ja={class:"text-xs"},qa={class:"fct-license-inline-action-wrap"},Ya={key:1,class:"text"},Ka={key:2,class:"separator"},Wa={class:"inline-action-button"},Ga={class:"text"},Xa={class:"fct-license-inline-action-wrap"},Za={key:0,class:"inline-action-input-group mr-2"},Ja={key:0,class:"fct-license-activation-limit-actions"},Qa={key:1,class:"text"},es={key:2,class:"separator"},ts={class:"inline-action-button"},ns={class:"text"},as={class:"fct-license-info-form-show-on-mobile"},ss={class:"fct-license-info-mobile-header"},ls={class:"fct-license-info-mobile-body"},is={class:"fct-license-product"},os={class:"text-xs text-system-mid dark:text-gray-300"},rs={class:"fct-input-with-action-wrap"},cs={class:"fct-input-with-action"},ds={class:"fct-input-with-action-icon"},us={class:"fct-license-info-mobile-footer"},_s={class:"fct-license-info-mobile-footer-item"},ms={class:"title"},ps={class:"fct-license-inline-action-wrap"},hs={key:1,class:"text"},fs={key:2,class:"separator"},gs={class:"inline-action-button"},vs={class:"text"},bs={class:"fct-license-info-mobile-footer-item"},ys={class:"title"},ws={class:"fct-license-inline-action-wrap"},ks={key:0,class:"inline-action-input-group mr-2"},Ls={key:0,class:"fct-license-activation-limit-actions"},Cs={key:1,class:"text"},Ss={key:2,class:"separator"},Ds={class:"inline-action-button"},xs={class:"text"};function $s(s,t,l,L,r,i){var M,P,J,K,he,fe,ge,ve,be;const S=u("CopyToClipboard"),C=u("el-input"),b=u("DynamicIcon"),D=u("el-button"),E=u("el-popconfirm"),y=u("el-form-item"),A=u("el-col"),v=u("router-link"),I=u("UpgradePlan"),f=u("el-date-picker"),U=u("el-input-number"),_=u("IconButton"),d=u("el-row"),k=u("el-form"),g=u("Badge");return o(),h("div",Na,[e(k,{class:"fct-license-info-form-hide-on-mobile",model:l.license,"label-position":"top"},{default:n(()=>[e(d,null,{default:n(()=>[e(A,{lg:24},{default:n(()=>[e(y,{label:""},{label:n(()=>[a("div",Fa,[x(c(i.translate("License Key"))+" ",1),e(S,{text:l.license.license_key,showMode:"basic_copy_btn",tooltipText:i.translate("Copy License")},null,8,["text","tooltipText"])])]),default:n(()=>[a("div",Ra,[e(C,{modelValue:l.license.license_key,"onUpdate:modelValue":t[0]||(t[0]=V=>l.license.license_key=V),disabled:""},null,8,["modelValue"]),a("div",Ha,[e(E,{width:"250","confirm-button-text":i.translate("Confirm"),"cancel-button-text":i.translate("No, Thanks"),title:i.translate("Are you sure to regenerate?"),onConfirm:i.regenerateLicenseKey},{reference:n(()=>[e(D,{class:"el-button--x-small",plain:""},{default:n(()=>[e(b,{name:"Reload"}),x(" "+c(i.translate("Regenerate")),1)]),_:1})]),_:1},8,["confirm-button-text","cancel-button-text","title","onConfirm"])])])]),_:1})]),_:1}),e(A,{lg:24},{default:n(()=>[l.product!=null?(o(),$(y,{key:0,label:i.translate("Product Name")},{default:n(()=>{var V;return[a("div",za,[e(v,{class:"link",to:{name:"product_edit",params:{product_id:l.product.ID}}},{default:n(()=>{var z;return[x(c(l.product.post_title)+" ",1),a("span",ja," â€“ "+c((z=r.variations.find(se=>se.id==l.license.variation_id))==null?void 0:z.variation_title),1)]}),_:1},8,["to"]),((V=r.variations)==null?void 0:V.length)>0?(o(),$(I,{key:0,variation_id:r.variation_id,product_id:l.product.ID,order:l.order,props_variations:r.variations,endpoint_path:"products",has_upgrades:l.license.has_upgrades&&!["expired","disabled"].includes(l.license.status),is_admin:!0},null,8,["variation_id","product_id","order","props_variations","has_upgrades"])):w("",!0)])]}),_:1},8,["label"])):w("",!0)]),_:1}),e(A,{lg:12},{default:n(()=>[e(y,{label:i.translate("Purchase Date")},{default:n(()=>{var V;return[a("span",null,c(i.formatDate((V=l.license)==null?void 0:V.created_at)),1)]}),_:1},8,["label"])]),_:1}),e(A,{lg:12},{default:n(()=>[e(y,{label:i.translate("Expirations date")},{default:n(()=>{var V,z,se,ye,we,ke;return[a("div",qa,[r.isExpirationDateEnable?(o(),$(f,{key:0,modelValue:r.selectedDate,"onUpdate:modelValue":t[1]||(t[1]=te=>r.selectedDate=te),placeholder:i.formatDate((V=l.license)==null?void 0:V.expiration_date)?i.formatDate((z=l.license)==null?void 0:z.expiration_date):i.translate("Lifetime"),"default-value":(se=l.license)==null?void 0:se.expiration_date,type:"date",ref:"calendar",onChange:i.handleDateChange,class:"el-input--x-small mr-2"},null,8,["modelValue","placeholder","default-value","onChange"])):(o(),h("span",Ya,c((ye=l.license)!=null&&ye.expiration_date?i.formatDate((we=l.license)==null?void 0:we.expiration_date):"Lifetime"),1)),r.isExpirationDateEnable?w("",!0):(o(),h("span",Ka)),a("div",Wa,[a("a",{href:"#",onClick:t[2]||(t[2]=q((...te)=>i.handleToggleExpirationDate&&i.handleToggleExpirationDate(...te),["prevent"]))},c(r.isExpirationDateEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isExpirationDateEnable&&((ke=l.license)!=null&&ke.expiration_date)?(o(),h(T,{key:0},[a("span",Ga,c(i.translate("or")),1),a("a",{href:"#",onClick:t[3]||(t[3]=q((...te)=>i.handleLifetimeLicense&&i.handleLifetimeLicense(...te),["prevent"]))},c(i.translate("Mark as lifetime")),1)],64)):w("",!0)])])]}),_:1},8,["label"])]),_:1}),e(A,{lg:12},{default:n(()=>[e(y,{label:i.translate("Activation Limit")},{default:n(()=>{var V;return[a("div",Xa,[r.isActivationLimitEnable?(o(),h("div",Za,[e(U,{modelValue:r.limit,"onUpdate:modelValue":t[4]||(t[4]=z=>r.limit=z),min:0,"controls-position":"right",onChange:i.handleLimitChange,onKeyup:i.handleLimitChange},{"decrease-icon":n(()=>[e(b,{class:"w-3",name:"ChevronDown"})]),"increase-icon":n(()=>[e(b,{class:"w-3",name:"ChevronUp"})]),_:1},8,["modelValue","onChange","onKeyup"]),r.isConfirmationIconEnable?(o(),h("div",Ja,[e(_,{tag:"button",onClick:q(i.updateLimit,["prevent"])},{default:n(()=>[e(b,{name:"Check"})]),_:1},8,["onClick"]),e(_,{tag:"button",onClick:q(i.resetLimit,["prevent"])},{default:n(()=>[e(b,{name:"Cross"})]),_:1},8,["onClick"])])):w("",!0)])):w("",!0),r.isActivationLimitEnable?w("",!0):(o(),h("span",Qa,c(i.translateNumber((V=l.activations)==null?void 0:V.length))+" / "+c(r.limit!=0?r.limit:i.translate("Unlimited")),1)),r.isActivationLimitEnable?w("",!0):(o(),h("span",es)),a("div",ts,[a("a",{href:"#",onClick:t[5]||(t[5]=q((...z)=>i.handleToggleActivationLimit&&i.handleToggleActivationLimit(...z),["prevent"]))},c(r.isActivationLimitEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isActivationLimitEnable&&r.limit!=0?(o(),h(T,{key:0},[a("span",ns,c(i.translate("or")),1),a("a",{href:"#",onClick:t[6]||(t[6]=q((...z)=>i.handleActivationLimit&&i.handleActivationLimit(...z),["prevent"]))},c(i.translate("Mark as unlimited")),1)],64)):w("",!0)])])]}),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"]),a("div",as,[a("div",ss,[e(g,{status:l.license.status,size:"small"},null,8,["status"]),a("span",null,c(i.translate("Purchase Date"))+": "+c(i.formatDate((M=l.license)==null?void 0:M.created_at)),1)]),a("div",ls,[a("div",is,[e(v,{class:"link",to:{name:"product_edit",params:{product_id:l.product.ID}}},{default:n(()=>{var V;return[x(c(l.product.post_title)+" ",1),a("span",os," â€“ "+c((V=r.variations.find(z=>z.id==l.license.variation_id))==null?void 0:V.variation_title),1)]}),_:1},8,["to"]),((P=r.variations)==null?void 0:P.length)>0?(o(),$(I,{key:0,variation_id:r.variation_id,product_id:l.product.ID,order:l.order,props_variations:r.variations,endpoint_path:"products",has_upgrades:l.license.has_upgrades&&!["expired","disabled"].includes(l.license.status),is_admin:!0},null,8,["variation_id","product_id","order","props_variations","has_upgrades"])):w("",!0)]),a("div",rs,[e(C,{modelValue:l.license.license_key,"onUpdate:modelValue":t[7]||(t[7]=V=>l.license.license_key=V),readonly:""},null,8,["modelValue"]),a("div",cs,[e(E,{width:"250","confirm-button-text":i.translate("Confirm"),"cancel-button-text":i.translate("No, Thanks"),title:i.translate("Are you sure to regenerate?"),onConfirm:i.regenerateLicenseKey},{reference:n(()=>[a("div",ds,[e(b,{name:"Reload"})])]),_:1},8,["confirm-button-text","cancel-button-text","title","onConfirm"])])])]),a("div",us,[a("div",_s,[a("div",ms,c(i.translate("Expirations date")),1),a("div",ps,[r.isExpirationDateEnable?(o(),$(f,{key:0,modelValue:r.selectedDate,"onUpdate:modelValue":t[8]||(t[8]=V=>r.selectedDate=V),placeholder:i.formatDate((J=l.license)==null?void 0:J.expiration_date)?i.formatDate((K=l.license)==null?void 0:K.expiration_date):i.translate("Lifetime"),"default-value":(he=l.license)==null?void 0:he.expiration_date,type:"date",ref:"calendar",onChange:i.handleDateChange,class:"el-input--x-small mr-2"},null,8,["modelValue","placeholder","default-value","onChange"])):(o(),h("span",hs,c((fe=l.license)!=null&&fe.expiration_date?i.formatDate((ge=l.license)==null?void 0:ge.expiration_date):"Lifetime"),1)),r.isExpirationDateEnable?w("",!0):(o(),h("span",fs)),a("div",gs,[a("a",{href:"#",onClick:t[9]||(t[9]=q((...V)=>i.handleToggleExpirationDate&&i.handleToggleExpirationDate(...V),["prevent"]))},c(r.isExpirationDateEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isExpirationDateEnable&&((ve=l.license)!=null&&ve.expiration_date)?(o(),h(T,{key:0},[a("span",vs,c(i.translate("or")),1),a("a",{href:"#",onClick:t[10]||(t[10]=q((...V)=>i.handleLifetimeLicense&&i.handleLifetimeLicense(...V),["prevent"]))},c(i.translate("Mark as lifetime")),1)],64)):w("",!0)])])]),a("div",bs,[a("div",ys,c(i.translate("Activation Limit")),1),a("div",ws,[r.isActivationLimitEnable?(o(),h("div",ks,[e(U,{modelValue:r.limit,"onUpdate:modelValue":t[11]||(t[11]=V=>r.limit=V),min:0,"controls-position":"right",onChange:i.handleLimitChange,onKeyup:i.handleLimitChange},{"decrease-icon":n(()=>[e(b,{class:"w-3",name:"ChevronDown"})]),"increase-icon":n(()=>[e(b,{class:"w-3",name:"ChevronUp"})]),_:1},8,["modelValue","onChange","onKeyup"]),r.isConfirmationIconEnable?(o(),h("div",Ls,[e(_,{tag:"button",onClick:q(i.updateLimit,["prevent"])},{default:n(()=>[e(b,{name:"Check"})]),_:1},8,["onClick"]),e(_,{tag:"button",onClick:q(i.resetLimit,["prevent"])},{default:n(()=>[e(b,{name:"Cross"})]),_:1},8,["onClick"])])):w("",!0)])):w("",!0),r.isActivationLimitEnable?w("",!0):(o(),h("span",Cs,c((be=l.activations)==null?void 0:be.length)+" / "+c(r.limit!=0?r.limit:i.translate("Unlimited")),1)),r.isActivationLimitEnable?w("",!0):(o(),h("span",Ss)),a("div",Ds,[a("a",{href:"#",onClick:t[12]||(t[12]=q((...V)=>i.handleToggleActivationLimit&&i.handleToggleActivationLimit(...V),["prevent"]))},c(r.isActivationLimitEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isActivationLimitEnable&&r.limit!=0?(o(),h(T,{key:0},[a("span",xs,c(i.translate("or")),1),a("a",{href:"#",onClick:t[13]||(t[13]=q((...V)=>i.handleActivationLimit&&i.handleActivationLimit(...V),["prevent"]))},c(i.translate("Mark as unlimited")),1)],64)):w("",!0)])])])])])])}const Es=G(Ba,[["render",$s]]),Ps={name:"ActivatedSiteInformation",props:["activatedSites","modelValue","activationLimit","activationCount"],computed:{Link(){return je}},components:{IconButton:ue,DynamicIcon:j,Badge:W,Empty:pe},methods:{formatDate:Q,updateModelValue(s){this.$emit("update:modelValue",s)},activateSite(){this.$emit("siteActivated")},deactivateSite(s){this.$emit("siteDeactivated",s)}}},Vs={class:"fct-activated-site-url-container grid gap-5"},As={key:0,class:"-mx-6 -mb-6 fct-license-site-url-table-wrap"};function Ts(s,t,l,L,r,i){const S=u("el-table-column"),C=u("Badge"),b=u("DynamicIcon"),D=u("IconButton"),E=u("el-popconfirm"),y=u("el-table"),A=u("Empty");return o(),h("div",Vs,[l.activatedSites.length>0?(o(),h("div",As,[e(y,{data:l.activatedSites,class:"w-full"},{default:n(()=>[e(S,{label:s.$t("Site URL"),width:"360"},{default:n(v=>[a("span",null,c(v.row.site_url),1)]),_:1},8,["label"]),e(S,{label:s.$t("Status"),width:"100"},{default:n(v=>[e(C,{status:v.row.status,size:"small"},null,8,["status"])]),_:1},8,["label"]),e(S,{label:s.$t("Activated at"),width:"140"},{default:n(v=>[a("span",null,c(i.formatDate(v.row.created_at)),1)]),_:1},8,["label"]),e(S,{width:"100"},{default:n(v=>[a("span",null,[e(E,{width:"200","confirm-button-text":s.$t("Confirm"),"cancel-button-text":s.$t("No, Thanks"),title:s.$t("Are you sure?"),onConfirm:I=>i.deactivateSite(v.row.id)},{reference:n(()=>[e(D,{tag:"a",size:"x-small",class:"ml-auto",hover:"danger"},{default:n(()=>[e(b,{name:"TrashIcon"})]),_:1})]),_:2},1032,["confirm-button-text","cancel-button-text","title","onConfirm"])])]),_:1})]),_:1},8,["data"])])):(o(),$(A,{key:1,icon:"Empty/ListView","has-dark":!0,text:s.$t("No activated sites found")},null,8,["text"]))])}const Us=G(Ps,[["render",Ts]]),Ms={class:"fct-single-customer-loader-wrap fct-layout-width"},Is={class:"single-page-header fct-page-loader-header flex items-start justify-between"},Os={class:"single-page-body"},Bs={class:"fct-single-order"},Ns={class:"fct-single-order-main"},Fs={class:"grid gap-5 grid-cols-[repeat(auto-fit,minmax(200px,1fr))]"},Rs={class:"fct-single-order-aside"},Hs={class:"fct-admin-sidebar"},zs={__name:"SingleLicenseLoader",setup(s){return(t,l)=>{const L=u("el-skeleton-item"),r=u("el-skeleton");return o(),h("div",Ms,[a("div",Is,[e(r,{animated:"",class:"flex items-start gap-2"},{template:n(()=>[(o(),h(T,null,H(3,i=>e(L,{key:i,class:"max-w-[100px]"})),64))]),_:1})]),a("div",Os,[a("div",Bs,[a("div",Ns,[e(N,{class:"overflow-hidden"},{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:t.$t("Manage License Details")},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:!0,class:"mb-5"},{template:n(()=>[e(L,{variant:"p",class:"w-full"}),e(L,{variant:"p",style:{width:"50%"}})]),_:1}),a("div",Fs,[(o(),h(T,null,H(6,i=>e(r,{key:i,animated:!0},{template:n(()=>[a("div",null,[e(L,{variant:"p",class:"w-full"}),e(L,{variant:"p",style:{width:"50%"}})])]),_:2},1024)),64))])]),_:1})]),_:1}),e(N,{class:"overflow-hidden"},{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:t.$t("Related Orders")},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:!0,class:"mb-5",rows:2})]),_:1})]),_:1}),e(N,{class:"overflow-hidden"},{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:t.$t("Activated Sites")},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:!0,class:"mb-5",rows:3})]),_:1})]),_:1})]),a("div",Rs,[a("div",Hs,[e(N,null,{default:n(()=>[e(R,{title:t.$t("Customer Information"),border_bottom:"",title_size:"small"},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:"",rows:6})]),_:1})]),_:1}),e(N,null,{default:n(()=>[e(R,{title:t.$t("Actions"),border_bottom:"",title_size:"small"},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:""},{template:n(()=>[e(L,{variant:"p",class:"w-1/2"})]),_:1})]),_:1})]),_:1}),e(N,null,{default:n(()=>[e(R,{title:t.$t("Labels"),border_bottom:"",title_size:"small"},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:"",rows:1})]),_:1})]),_:1})])])])])])}}},js={key:2,class:"fct-view-license-wrap fct-layout-width"},qs={class:"single-page-header"},Ys={class:"flex items-center gap-3 flex-wrap whitespace-pre-wrap",style:{"overflow-wrap":"anywhere"}},Ks={class:"license-breadcrumb-only-mobile"},Ws={class:"single-page-body"},Gs={class:"fct-view-license-content-wrap"},Xs={class:"more-btn"},Zs={class:"fct-related-license-content"},Js={class:"fct-license-related-orders-show-on-mobile fct-table-mobile-wrap"},Qs={class:"fct-table-mobile-header"},el={class:"fct-table-date-col"},tl={class:"fct-table-price-col"},nl={class:"fct-table-mobile-footer"},al={class:"fct-table-mobile-footer-row"},sl={class:"title"},ll={class:"fct-table-status-col flex items-center gap-1"},il={class:"title"},ol={class:"value capitalize"},rl={class:"fct-related-license-content"},cl={class:"value-column-with-space",style:{"max-height":"500px","overflow-y":"auto"}},dl=["innerHTML"],ul={class:"fct-admin-sidebar"},_l={class:"fct-admin-sidebar-item"},ml={class:"fct-lists"},pl={class:"!mb-0"},hl={name:"ViewLicense",components:{OrderUpDownIndicator:ie},props:["license_id"],data(){return{changes_made:0,isDateSelected:!1,isCalendarOpen:!1,activeTab:"license",activeMenu:"details",license:null,order:null,selectedDate:null,orders:[],prevOrders:[],activations:[],loading:!0,saving:!1,limit:null,site_url:null,upgrade_path_base:"",showConfirmationIcons:!1,customerId:null,activatedSites:[],logs:[],selectedLabels:[],renewalNoticeValue:"",renewalNoticeOptions:[{value:"option1",label:"Need to connect backend"},{value:"option2",label:"Need to connect backend"}],product:{},notFound:{show:!1,message:"",buttonText:"",route:""}}},watch:{license:{handler(){this.changes_made++},deep:!0,immediate:!0},product:{handler(){var s;(s=this.product)!=null&&s.variants&&(this.variations=this.product.variants)},deep:!0,immediate:!0},license_id:{handler(s,t){this.fetchLicense()}}},methods:{handleLicenseCommand(s){s==="delete_license"&&this.$confirm("Are you sure you want to delete this license?","Confirm Delete!",{confirmButtonText:"Yes, Delete!",cancelButtonText:"Cancel",confirmButtonClass:"el-button--primary",cancelButtonClass:"el-button--info is-plain",type:"warning"}).then(()=>{this.deleteLicense()}).catch(()=>{})},deleteLicense(){this.$del(`licensing/licenses/${this.license_id}/delete`).then(s=>{this.handleSuccess(s.message),this.$router.push({name:"licenses"})}).catch(s=>{this.handleError(s)})},updateUrl(s,t){this.activatedSites[s]=t},activateSite(){Ze(this.site_url)?this.$post("licensing/licenses/"+this.license_id+"/activate_site",{url:this.site_url}).then(t=>{if(this.fetchLicense(),this.site_url=null,t.success)this.handleSuccess("Site activated successfully!");else{let l=t.error??"An error occurred while activating the site";this.handleError(l)}}).catch(t=>{this.handleError(t)}).finally(()=>{this.loading=!1}):this.handleError("Enter a valid site URL")},deactivateSite(s){this.$post("licensing/licenses/"+this.license_id+"/deactivate_site",{activation_id:s}).then(t=>{this.fetchLicense(),this.handleSuccess(t.message)}).catch(t=>{this.handleError(t)}).finally(()=>{this.loading=!1})},fetchLicense(){this.loading=!0,this.notFound.show=!1,this.$get("licensing/licenses/"+this.license_id).then(s=>{var t,l;this.license=s.license,this.order=s.order,this.order.customer=(t=this.license)==null?void 0:t.customer,this.upgrade_path_base=s.upgrade_path_base,this.orders=s.orders,this.activations=s.activations,this.limit=this.license.limit,this.customerId=(l=this.license.customer)==null?void 0:l.id,this.product=s.product,this.selectedLabels=s.selected_labels,this.prevOrders=s.prev_orders,this.activatedSites=this.activations.map(L=>{var r,i;return{id:L.id,site_url:(r=L.site)==null?void 0:r.site_url,created_at:(i=L.site)==null?void 0:i.created_at,status:L.status}}).sort((L,r)=>r.id-L.id)}).catch(s=>{s&&((s==null?void 0:s.code)==="fluent_cart_entity_not_found"?(this.notFound.show=!0,this.notFound.buttonText=ae.get(s,"data.buttonText"),this.notFound.message=ae.get(s,"data.message"),this.notFound.route=ae.get(s,"data.route")):this.handleError(s))}).finally(()=>{this.loading=!1})},fetchLicenseMeta(){this.$get("licensing/licenses/meta/"+this.license_id).then(s=>{this.logs=s}).catch(s=>{this.handleError(s)}).finally(()=>{this.loading=!1})},updateLicenseStatus(s){this.$post("licensing/licenses/"+this.license_id+"/update_status",{status:s}).then(t=>{this.license&&(this.license.status=s),this.$emit("fetchLicense"),this.handleSuccess(t.message),this.fetchLicense()}).catch(t=>{this.handleError(t)}).finally(()=>{this.loading=!1})},getCustomerTotalOrders(s){return s>0?s+" "+(s==1?p("order"):p("orders")):p("No orders")},handleMenuClick(s){this.activeMenu=s},discard(){return window.location.reload()}},mounted(){this.fetchLicense()}},fl=Object.assign(hl,{setup(s){return(t,l)=>{var _;const L=u("el-breadcrumb-item"),r=u("el-breadcrumb"),i=u("router-link"),S=u("el-dropdown-item"),C=u("el-dropdown-menu"),b=u("el-dropdown"),D=u("el-table-column"),E=u("el-table"),y=u("el-timeline-item"),A=u("el-timeline"),v=u("el-col"),I=u("el-button"),f=u("el-popconfirm"),U=u("el-row");return o(),h("div",null,[t.loading?(o(),$(zs,{key:0})):w("",!0),t.notFound.show?(o(),$(Be,{key:1,"button-text":t.notFound.buttonText,message:t.notFound.message,route:t.notFound.route},null,8,["button-text","message","route"])):w("",!0),t.notFound.show===!1?(o(),h("div",js,[t.loading?w("",!0):(o(),h(T,{key:0},[t.license?(o(),h(T,{key:0},[a("div",qs,[e(r,{class:"hide-license-breadcrumb-on-mobile","separator-icon":m(qe)},{default:n(()=>[e(L,{to:{name:"licenses"}},{default:n(()=>[x(c(m(p)("Licenses")),1)]),_:1}),e(L,null,{default:n(()=>{var d;return[a("div",Ys,[x(c((d=t.license)==null?void 0:d.license_key)+" ",1),e(W,{status:t.license.status,size:"small"},null,8,["status"])])]}),_:1})]),_:1},8,["separator-icon"]),a("ul",Ks,[a("li",null,[e(i,{to:{name:"licenses"}},{default:n(()=>[e(j,{name:"ArrowLeft",class:"cursor-pointer"})]),_:1})]),a("li",null,c((_=t.license)==null?void 0:_.license_key),1)])]),a("div",Ws,[e(U,{gutter:30},{default:n(()=>[e(v,{lg:17},{default:n(()=>[a("div",Gs,[e(N,null,{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:m(p)("License Details")},{action:n(()=>[e(b,{trigger:"click",class:"fct-more-option-wrap","popper-class":"fct-dropdown",onCommand:t.handleLicenseCommand,placement:"bottom-end"},{dropdown:n(()=>[e(C,null,{default:n(()=>[e(S,{command:"delete_license",class:"item-destructive"},{default:n(()=>[e(j,{name:"Delete"}),x(" "+c(m(p)("Delete License")),1)]),_:1})]),_:1})]),default:n(()=>[a("span",Xs,[e(j,{name:"More"})])]),_:1},8,["onCommand"])]),_:1},8,["title"]),e(B,null,{default:n(()=>[e(Es,{license:t.license,customerId:t.customerId,license_id:s.license_id,activations:t.activations,product:t.product,order:t.order,upgrade_path_base:t.upgrade_path_base,onFetchLicense:t.fetchLicense},null,8,["license","customerId","license_id","activations","product","order","upgrade_path_base","onFetchLicense"])]),_:1})]),_:1}),e(N,{class:"overflow-hidden"},{default:n(()=>[e(R,{title:m(p)("Related Orders"),title_size:"small"},null,8,["title"]),e(B,{class:"px-0 pb-0"},{default:n(()=>[a("div",Zs,[e(E,{data:t.orders,class:"w-full fct-license-related-orders-hide-on-mobile"},{default:n(()=>[e(D,{width:120,label:m(p)("ID")},{default:n(d=>[e(i,{class:"link",to:{name:"view_order",params:{order_id:d.row.id}}},{default:n(()=>[x(" #"+c(m(p)(d.row.id)),1)]),_:2},1032,["to"])]),_:1},8,["label"]),e(D,{width:120,label:m(p)("Amount")},{default:n(d=>[a("span",null,c(t.formatNumber(d.row.total_paid)),1)]),_:1},8,["label"]),e(D,{width:150,label:m(p)("Date"),prop:"created_at"},{default:n(d=>[a("span",null,c(m(Q)(d.row.created_at)),1)]),_:1},8,["label"]),e(D,{label:m(p)("Payment Method")},{default:n(d=>[x(c(d.row.payment_method),1)]),_:1},8,["label"]),e(D,{label:m(p)("Status")},{default:n(d=>[e(W,{type:d.row.payment_status},{default:n(()=>[x(c(d.row.payment_status),1)]),_:2},1032,["type"]),e(W,{style:{"margin-left":"5px","margin-right":"5px"},type:d.row.type},{default:n(()=>[x(c(d.row.type),1)]),_:2},1032,["type"]),e(ie,{order:d.row},null,8,["order"])]),_:1},8,["label"])]),_:1},8,["data"]),a("div",Js,[(o(!0),h(T,null,H(t.orders,(d,k)=>(o(),h("div",{key:k,class:"fct-table-mobile-row"},[a("div",Qs,[a("div",el,[x(c(m(Q)(d.created_at))+" ",1),l[4]||(l[4]=a("div",{class:"bullet"},"â€¢",-1)),e(i,{class:"link",to:{name:"view_order",params:{order_id:d.id}}},{default:n(()=>[x(" #"+c(d.id),1)]),_:2},1032,["to"])]),a("div",tl,c(t.formatNumber(d.total_paid)),1)]),a("div",nl,[a("div",al,[a("div",null,[a("div",sl,c(m(p)("Status")),1),a("div",ll,[e(W,{type:d.payment_status},{default:n(()=>[x(c(d.payment_status),1)]),_:2},1032,["type"]),e(W,{type:d.type},{default:n(()=>[x(c(d.type),1)]),_:2},1032,["type"]),e(ie,{order:d},null,8,["order"])])]),a("div",null,[a("div",il,c(m(p)("Payment Method")),1),a("div",ol,c(d.payment_method),1)])])])]))),128))])])]),_:1})]),_:1}),t.prevOrders&&t.prevOrders.length?(o(),$(N,{key:0,class:"overflow-hidden"},{default:n(()=>[e(R,{title:m(p)("Previous Orders"),title_size:"small"},null,8,["title"]),e(B,{class:"px-0 pb-0"},{default:n(()=>[a("div",rl,[e(E,{data:t.prevOrders,class:"w-full"},{default:n(()=>[e(D,{width:120,label:m(p)("ID")},{default:n(d=>[e(i,{class:"link",to:{name:"view_order",params:{order_id:d.row.id}}},{default:n(()=>[x(" #"+c(m(p)(d.row.id)),1)]),_:2},1032,["to"])]),_:1},8,["label"]),e(D,{width:120,label:m(p)("Amount")},{default:n(d=>[a("span",null,c(t.formatNumber(d.row.total_paid)),1)]),_:1},8,["label"]),e(D,{width:150,label:m(p)("Date"),prop:"created_at"},{default:n(d=>[a("span",null,c(m(Q)(d.row.created_at)),1)]),_:1},8,["label"]),e(D,{label:m(p)("Status")},{default:n(d=>[e(W,{type:d.row.payment_status},{default:n(()=>[x(c(d.row.payment_status),1)]),_:2},1032,["type"]),e(W,{style:{"margin-left":"5px","margin-right":"5px"},type:d.row.type},{default:n(()=>[x(c(d.row.type),1)]),_:2},1032,["type"]),e(ie,{order:d.row},null,8,["order"])]),_:1},8,["label"])]),_:1},8,["data"])])]),_:1})]),_:1})):w("",!0),e(N,{class:"overflow-hidden"},{default:n(()=>[e(R,{title:m(p)("Activated Sites"),title_size:"small",border_bottom:""},null,8,["title"]),e(B,null,{default:n(()=>[e(Us,{modelValue:t.site_url,"onUpdate:modelValue":l[0]||(l[0]=d=>t.site_url=d),onSiteActivated:t.activateSite,onSiteDeactivated:t.deactivateSite,activatedSites:t.activatedSites,activationLimit:t.limit,activationCount:t.activations.length},null,8,["modelValue","onSiteActivated","onSiteDeactivated","activatedSites","activationLimit","activationCount"])]),_:1})]),_:1}),t.logs.length>0?(o(),$(N,{key:1},{default:n(()=>[e(B,null,{default:n(()=>[a("div",cl,[e(A,{style:{"padding-left":"2px"}},{default:n(()=>[(o(!0),h(T,null,H(t.logs,d=>{var k;return o(),$(y,{key:d,timestamp:m(Z)((k=t.license)==null?void 0:k.updated_at).format("MMMM DD, YYYY"),placement:"top",color:"blue"},{default:n(()=>[a("div",{innerHTML:d.meta_value},null,8,dl)]),_:2},1032,["timestamp"])}),128))]),_:1})])]),_:1})]),_:1})):w("",!0)])]),_:1}),e(v,{lg:7},{default:n(()=>[a("div",ul,[e(We,{order:t.order,shouldEnableEditing:!0,onOnAddressSelected:l[1]||(l[1]=d=>{d.type==="shipping"?t.order.shipping_address_id=d.id:t.order.billing_address_id=d.id})},null,8,["order"]),e(N,null,{default:n(()=>[e(R,{title:m(p)("Actions"),title_size:"small",border_bottom:""},null,8,["title"]),e(B,null,{default:n(()=>[a("div",_l,[a("ul",ml,[a("li",pl,[t.license.status!=="disabled"?(o(),$(f,{key:0,width:"210","confirm-button-text":m(p)("Confirm"),"cancel-button-text":m(p)("No, Thanks"),title:m(p)("Are you sure?"),onConfirm:l[2]||(l[2]=d=>t.updateLicenseStatus("disabled"))},{reference:n(()=>[e(I,{text:"",class:"!text-red-500 !mt-0"},{default:n(()=>[x(c(m(p)("Disable")),1)]),_:1})]),_:1},8,["confirm-button-text","cancel-button-text","title"])):w("",!0),t.license.status==="disabled"?(o(),$(f,{key:1,width:"210","confirm-button-text":m(p)("Confirm"),"cancel-button-text":m(p)("No, Thanks"),title:m(p)("Are you sure?"),onConfirm:l[3]||(l[3]=d=>t.updateLicenseStatus("active"))},{reference:n(()=>[e(I,{text:"",class:"!text-primary-500 !mt-0"},{default:n(()=>[x(c(m(p)("Enable")),1)]),_:1})]),_:1},8,["confirm-button-text","cancel-button-text","title"])):w("",!0)])])])]),_:1})]),_:1}),t.loading?w("",!0):(o(),$(Ge,{key:0,"bind-to-id":t.license.id,"bind-to-type":"FluentCartPro\\App\\Modules\\Licensing\\Models\\License",selectedLabels:t.selectedLabels,shouldEnableEditing:!0,"onUpdate:updateLabel":()=>{}},null,8,["bind-to-id","selectedLabels"]))])]),_:1})]),_:1})])],64)):w("",!0)],64))])):w("",!0)])}}}),gl={class:"heading-wrap"},vl={class:"title"},bl={key:0,class:"heading-action"},yl={__name:"Heading",props:{title:String},setup(s){const t=Ae();return(l,L)=>(o(),h("div",gl,[a("h2",vl,c(s.title),1),m(t).actions?(o(),h("div",bl,[Te(l.$slots,"actions")])):w("",!0)]))}},wl={name:"AllLicenses",components:{Pagination:Oe,Heading:yl},data(){return{licenses:[],paginate:{per_page:10,current_page:1,total:0,last_page:1},loading:!1,is_loaded:!1,search:""}},methods:{fetch(){this.loading=!0,this.$get("licensing/licenses/customer/1",{page:this.paginate.current_page,per_page:this.paginate.per_page,search:this.search}).then(s=>{this.licenses=s.licenses.data,this.paginate.total=s.licenses.total,this.paginate.last_page=s.licenses.last_page}).catch(s=>{this.handleError(s)}).finally(()=>{this.loading=!1,this.is_loaded=!0})},getProductName(s){return s?(s==null?void 0:s.product.post_title)+" - "+s.variation_label:"n/a"},onCurrentPageChanged({page:s,currentPageCount:t}){this.paginate.current_page=s,this.fetch()},onPerPageChanged(s){this.paginate.per_page=s,this.fetch()}},mounted(){this.fetch()}},kl={class:"all_licenses"},Ll={class:"bg-white dark:bg-dark-700"},Cl={key:0},Sl={key:1},Dl={class:"py-2.5 px-7.5 dark:bg-gray-800"},xl={class:"flex justify-between"},$l={class:"flex items-center gap-2"};function El(s,t,l,L,r,i){const S=u("Heading"),C=u("router-link"),b=u("el-table-column"),D=u("el-table"),E=u("pagination");return o(),h("div",kl,[e(S,{title:"All Licenses"}),a("div",Ll,[e(D,{stripe:"",data:r.licenses},{default:n(()=>[e(b,{label:"ID",width:100},{default:n(y=>[e(C,{to:{name:"view_license",params:{license_id:y.row.id}}},{default:n(()=>[x(" #"+c(y.row.id),1)]),_:2},1032,["to"])]),_:1}),e(b,{width:290,label:"License Key"},{default:n(y=>[e(C,{to:{name:"view_license",params:{license_id:y.row.id}}},{default:n(()=>[x(c(y.row.license_key),1)]),_:2},1032,["to"])]),_:1}),e(b,{width:100,label:"Status"},{default:n(y=>[a("span",null,c(y.row.status),1)]),_:1}),e(b,{"min-width":300,label:"Product"},{default:n(y=>[x(c(i.getProductName(y.row.product_details)),1)]),_:1}),e(b,{"min-width":120,label:"Customer"},{default:n(y=>[e(C,{to:{name:"view_customer",params:{customer_id:y.row.customer_id}}},{default:n(()=>{var A;return[x(c(((A=y.row)==null?void 0:A.customer.full_name)||"No Customer Found"),1)]}),_:2},1032,["to"])]),_:1}),e(b,{width:120,label:"Activations"},{default:n(y=>[x(c(y.row.activation_count)+" / "+c(y.row.limit||"Unlimited"),1)]),_:1}),e(b,{width:160,label:"Expires"},{default:n(y=>[y.row.expiration_date?(o(),h("span",Cl,c(y.row.expiration_date),1)):(o(),h("span",Sl,"Lifetime"))]),_:1}),e(b,{width:160,label:"Purchased"},{default:n(y=>[e(C,{to:{name:"view_order",params:{order_id:y.row.order_id}}},{default:n(()=>[x(c(y.row.created_at),1)]),_:2},1032,["to"])]),_:1})]),_:1},8,["data"]),a("div",Dl,[a("div",xl,[a("div",$l,[e(E,{"pager-only":!0,hide_on_single:!1,pagination:r.paginate,onFetch:i.fetch,onCurrentPageChanged:i.onCurrentPageChanged,onOnPerPageChanged:i.onPerPageChanged},null,8,["pagination","onFetch","onCurrentPageChanged","onOnPerPageChanged"])]),e(E,{hide_on_single:!1,pagination:r.paginate,onFetch:i.fetch,onCurrentPageChanged:i.onCurrentPageChanged,onOnPerPageChanged:i.onPerPageChanged},null,8,["pagination","onFetch","onCurrentPageChanged","onOnPerPageChanged"])])])])])}const Pl=G(wl,[["render",El]]);window.fluent_cart_admin.hooks.addFilter("fluent_cart_routes","fluent_all_licenses",function(s){return s.product_route.children.push({name:"license_settings",path:"license_settings",props:!0,component:At,meta:{active_menu:"products",title:"License Settings",permission:"store/sensitive"}}),s.license_route={name:"licenses",path:"/licenses",component:fa,meta:{active_menu:"licenses",title:"Licenses",permission:"store/sensitive"}},s.view_license={name:"view_license",path:"/licenses/:license_id/view",component:fl,props:!0,meta:{active_menu:"licenses",title:"View License",permission:"store/sensitive"}},s.view_customer_licenses={name:"view_customer_licenses",path:"/licenses/customer/:customer_id",component:Pl,props:!0,meta:{active_menu:"licenses",title:"View License",permission:"store/sensitive"}},s});
