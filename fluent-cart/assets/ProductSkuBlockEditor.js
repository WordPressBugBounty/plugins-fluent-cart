import{j as t,b as c}from"./chunks/BlockEditorTranslator.js?ver=1.3.13";import{a as C}from"./chunks/index4.js?ver=1.3.13";import{S as I}from"./chunks/SelectVariationModal.js?ver=1.3.13";import{E as w}from"./chunks/EditorPanel.js?ver=1.3.13";import{E as y}from"./chunks/EditorPanelRow.js?ver=1.3.13";import{E as B}from"./chunks/ErrorBoundary.js?ver=1.3.13";import{u as K}from"./chunks/SingleProductContext.js?ver=1.3.13";import{u as T}from"./chunks/Icons.js?ver=1.3.13";import{a as U}from"./chunks/add-query-args.js?ver=1.3.13";import"./chunks/ProductListItem.js?ver=1.3.13";import"./chunks/index5.js?ver=1.3.13";const{InspectorControls:F}=wp.blockEditor,{TextControl:O,ToggleControl:M}=wp.components,L=({attributes:r,setAttributes:p,selectedProduct:u,setSelectedProduct:S,selectedVariations:n,setSelectedVariations:f,sku:l,isInsideProductInfo:v=!1})=>t.jsx(F,{children:t.jsx("div",{className:"fct-inspector-control-wrap fct-inspector-control-wrap--product-sku",children:t.jsx("div",{className:"fct-inspector-control-group",children:t.jsxs("div",{className:"fct-inspector-control-body",children:[t.jsx(w,{title:c("SKU Settings"),children:t.jsxs(y,{className:"flex-col",children:[t.jsx(M,{label:c("Show Label"),checked:r.show_label,onChange:e=>p({show_label:e})}),r.show_label&&t.jsx(O,{label:c("Label Text"),value:r.label,onChange:e=>p({label:e})}),l&&t.jsxs("div",{className:"fct-product-sku-info",children:[t.jsxs("strong",{children:[c("Current SKU"),":"]})," ",l]})]})}),!v&&t.jsx(w,{title:c("Variation"),children:t.jsxs(y,{className:"flex-col",children:[t.jsx(I,{preSelectedVariations:n,onModalClosed:e=>{if(!e||Object.keys(e).length===0){p({variant_id:"",product_id:""}),f({}),S({});return}const o=Object.values(e)[0],g=String((o==null?void 0:o.id)??""),s=String((o==null?void 0:o.post_id)??"");p({variant_id:g,product_id:s}),f({...e})},selectedVariations:n,setSelectedVariations:f,isMultiple:!1}),Object.keys(n).length>0&&t.jsxs("div",{className:"fct-selected-products",children:[t.jsx("span",{className:"fct-selected-products__label",children:c("Selected Variation")}),t.jsx("div",{className:"fct-selected-products__list",children:t.jsxs("div",{className:"fct-product-chip-group",children:[(u==null?void 0:u.post_title)&&t.jsx("span",{className:"fct-product-chip fct-product-chip--parent",children:u.post_title}),Object.values(n).map(e=>t.jsx("span",{className:"fct-variation-chip",children:e.variation_title||e.title},e.id))]})}),l&&t.jsxs("div",{className:"fct-selected-products__preview",children:[t.jsxs("strong",{children:[c("SKU"),":"]})," ",l]})]})]})})]})})})}),{useBlockProps:R}=wp.blockEditor,{registerBlockType:q}=wp.blocks,{useEffect:k,useState:b,useMemo:z}=wp.element,{useSelect:W}=wp.data,{store:H}=wp.blockEditor,j=window.fluent_cart_product_sku_data,N=window.fluentCartRestVars.rest;q(j.slug+"/"+j.name,{apiVersion:3,title:j.title,description:j.description,icon:{src:T},category:"fluent-cart",example:{attributes:{show_label:!0,label:"SKU:"}},attributes:{product_id:{type:["string","number"],default:""},variant_id:{type:["string","number"],default:""},show_label:{type:"boolean",default:!0},label:{type:"string",default:c("SKU:")},query_type:{type:"string",default:"default"},inside_product_info:{type:"string",default:"-"}},edit:({attributes:r,setAttributes:p,clientId:u})=>{const S=R({className:"fct-product-sku"}),[n,f]=b({}),[l,v]=b({}),e=K(),o=W(s=>{const{getBlockParents:d,getBlockName:_}=s(H);return d(u).some(i=>{const a=_(i);return["fluent-cart/product-info","fluent-cart/products","fluent-cart/shopapp-product-container","fluent-cart/shopapp-product-loop","fluent-cart/product-carousel"].includes(a)})},[u]);k(()=>{p({inside_product_info:o?"yes":"no",...o?{}:{query_type:"custom"}})},[o]),k(()=>{o||r.product_id&&C({path:U(N.url+"/products/"+r.product_id,{with:["detail","variants"]}),headers:{"X-WP-Nonce":N.nonce}}).then(s=>{var _;const d=s.product||{};if(f(d),r.variant_id&&((_=d.variants)!=null&&_.length)){const m=String(r.variant_id),i=d.variants.find(a=>String(a.id)===m);i&&v({[m]:i})}})},[r.product_id]),k(()=>{e!=null&&e.product&&f(e.product)},[e==null?void 0:e.product]);const g=z(()=>{var d,_,m;if(!o&&r.variant_id){const i=String(r.variant_id),a=Object.values(l).find(x=>String(x.id)===i);if(a!=null&&a.sku)return a.sku;const h=n!=null&&n.variants?n:null;if((d=h==null?void 0:h.variants)!=null&&d.length){const x=h.variants.find(E=>String(E.id)===i);if(x!=null&&x.sku)return x.sku}}const s=n!=null&&n.variants?n:e==null?void 0:e.product;if((_=s==null?void 0:s.variants)!=null&&_.length){const i=(m=s==null?void 0:s.detail)==null?void 0:m.default_variation_id,a=i&&s.variants.find(h=>h.id===i)||s.variants[0];return(a==null?void 0:a.sku)||""}return""},[n,l,e==null?void 0:e.product,r.variant_id,o]);return t.jsx("div",{...S,children:t.jsxs(B,{children:[t.jsx(L,{attributes:r,setAttributes:p,selectedProduct:n,setSelectedProduct:f,selectedVariations:l,setSelectedVariations:v,sku:g,isInsideProductInfo:o}),t.jsxs("div",{className:"fct-product-sku__preview",children:[r.show_label&&t.jsxs("span",{className:"fct-product-sku__label",children:[r.label||c("SKU:")," "]}),t.jsx("span",{className:"fct-product-sku__value",children:g||c("N/A")})]})]})})},save:()=>null,supports:{html:!1,align:["left","center","right"],typography:{fontSize:!0,lineHeight:!0,__experimentalFontFamily:!0,__experimentalFontWeight:!0,__experimentalFontStyle:!0,__experimentalTextTransform:!0,__experimentalLetterSpacing:!0,__experimentalDefaultControls:{fontSize:!0}},color:{text:!0,background:!0},spacing:{margin:!0,padding:!0},__experimentalBorder:{color:!0,radius:!0,style:!0,width:!0},shadow:!0}});
