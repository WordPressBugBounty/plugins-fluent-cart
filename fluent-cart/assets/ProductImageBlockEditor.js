import{j as t,b as l}from"./chunks/BlockEditorTranslator.js";import{a as w}from"./chunks/index4.js";import{E as k}from"./chunks/EditorPanel.js";import{E as u}from"./chunks/EditorPanelRow.js";import{C as b}from"./chunks/CustomSelect.js";import{S as v}from"./chunks/SelectProductModal.js";import{u as N}from"./chunks/SingleProductContext.js";import{h as E}from"./chunks/Icons.js";import{a as S}from"./chunks/add-query-args.js";import"./chunks/index5.js";import"./chunks/ProductListItem.js";const{InspectorControls:C}=wp.blockEditor,I=({attributes:o,setAttributes:c,selectedProduct:r,setSelectedProduct:p,isInsideProductInfo:e})=>t.jsx(t.Fragment,{children:e?"":t.jsx(C,{children:t.jsx("div",{className:"fct-inspector-control-wrap fct-inspector-control-wrap--product-card",children:t.jsx("div",{className:"fct-inspector-control-group",children:t.jsx("div",{className:"fct-inspector-control-body",children:t.jsxs(k,{title:l("Product"),children:[t.jsxs(u,{children:[t.jsx("span",{className:"fct-inspector-control-label",children:l("Query type")}),t.jsx("div",{className:"actions",children:t.jsx(b,{customKeys:{key:"value",label:"label"},defaultValue:o.query_type,options:[{label:l("Default"),value:"default"},{label:l("Custom"),value:"custom"}],onChange:function(s){c({query_type:s})}})})]}),o.query_type==="custom"&&t.jsxs(u,{className:"flex-col",children:[t.jsx(v,{onModalClosed:s=>{c({product_id:s.ID||""}),p(s)},selectedProduct:r,setSelectedProduct:p,isMultiple:!1}),(r==null?void 0:r.detail)&&t.jsxs("div",{className:"fct-product-title",children:[t.jsx("strong",{children:l("Product Title")}),":",t.jsx("span",{className:"product-title",dangerouslySetInnerHTML:{__html:r.post_title}})]}),!(r!=null&&r.detail)&&t.jsxs("div",{className:"fct-product-product-title",children:[t.jsx("strong",{children:l("Product Title")}),":"]})]})]})})})})})}),{useBlockProps:q}=wp.blockEditor,{registerBlockType:B}=wp.blocks,{useEffect:M,useState:T}=wp.element,{useSelect:R}=wp.data,{store:V}=wp.blockEditor,i=window.fluent_cart_product_image_data;i.placeholder_image;const m=window.fluentCartRestVars.rest;B(i.slug+"/"+i.name,{apiVersion:3,title:i.title,description:i.description,icon:{src:E},category:"fluent-cart",attributes:{product_id:{type:["string","number"],default:""},query_type:{type:"string",default:"default"},inside_product_info:{type:"string",default:"-"}},edit:({attributes:o,setAttributes:c,clientId:r})=>{const p=q(),[e,s]=T({}),f=m.url+"/products/"+o.product_id,a=N(),d=R(n=>{const{getBlockParents:g,getBlockName:x}=n(V);return g(r).some(y=>{const j=x(y);return["fluent-cart/product-info","fluent-cart/products","fluent-cart/shopapp-product-container","fluent-cart/shopapp-product-loop","fluent-cart/product-carousel"].includes(j)})},[r]);c({inside_product_info:d?"yes":"no"});const h=()=>{w({path:S(f,{with:["detail","variants"]}),headers:{"X-WP-Nonce":m.nonce}}).then(n=>{s(n.product||{})}).finally(()=>{})};M(()=>{a!=null&&a.product&&s(a.product),!d&&o.product_id&&h()},[o.product_id,a==null?void 0:a.product]);const _=()=>{const n=window.fluent_cart_block_editor_asset.placeholder_image;return e&&e.detail&&e.detail.featured_media&&e.detail.featured_media!==null&&typeof e.detail.featured_media=="object"&&e.detail.featured_media.url?e.detail.featured_media.url:n};return t.jsxs("div",{...p,children:[t.jsx(I,{attributes:o,setAttributes:c,selectedProduct:e,setSelectedProduct:s,isInsideProductInfo:d}),t.jsx("div",{className:"group-[.list]:flex-shrink-0",children:t.jsx("img",{src:_(),className:"w-full aspect-square object-cover rounded-md group-[.list]:w-[214px]",alt:e.product?e.product.post_title:"Product"})})]})},save:function(o){return null},supports:{html:!1,align:["left","center","right"],typography:{fontSize:!0,lineHeight:!0},spacing:{margin:!0},color:{text:!0,link:!0}}});
