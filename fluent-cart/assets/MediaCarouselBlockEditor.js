import{j as e,b as d}from"./chunks/BlockEditorTranslator.js";import{h as L}from"./chunks/Icons.js";import{a as W}from"./chunks/index4.js";import{E as X}from"./chunks/EditorPanel.js";import{E as h}from"./chunks/EditorPanelRow.js";import{C as Z}from"./chunks/CustomSelect.js";import"./chunks/SelectProductModal.js";import{S as D}from"./chunks/SelectVariationModal.js";import{u as H}from"./chunks/SingleProductContext.js";import{a as J}from"./chunks/add-query-args.js";import"./chunks/index5.js";import"./chunks/ProductListItem.js";const{InspectorControls:Y}=wp.blockEditor,{CheckboxControl:S}=wp.components,{RangeControl:V}=wp.components,A=({attributes:n,setAttributes:i,selectedVariations:p,setSelectedVariations:y,isInsideProductInfo:f})=>{const{carouselSettings:r}=n,{useEffect:j,useState:N}=wp.element;return j(()=>{},[n]),e.jsx(Y,{children:e.jsx("div",{className:"fct-inspector-control-wrap fct-inspector-control-wrap--product-card",children:e.jsx("div",{className:"fct-inspector-control-group",children:e.jsx("div",{className:"fct-inspector-control-body",children:e.jsxs(X,{title:d("Media Settings"),children:[!f&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[e.jsx("span",{className:"fct-inspector-control-label",children:d("Query type")}),e.jsx("div",{className:"actions",children:e.jsx(Z,{customKeys:{key:"value",label:"label"},defaultValue:n.query_type,options:[{label:d("Default"),value:"default"},{label:d("Custom"),value:"custom"}],onChange:function(t){i({query_type:t})}})})]}),n.query_type==="custom"&&e.jsxs(h,{className:"flex-col",children:[e.jsx(D,{setAttributes:i,preSelectedVariations:p,onModalClosed:t=>{if(!t||Object.keys(t).length===0){i({variation_ids:[]}),y({});return}let g={...t};i({variation_ids:Object.keys(g)});const c=Object.values(g)[0];i({product_id:(c==null?void 0:c.post_id)??""}),y(g)},selectedVariations:p,setSelectedVariations:y,isMultiple:!1}),p&&Object.values(p)[0]&&e.jsxs("div",{className:"fct-selected-variation-info w-full",children:[e.jsx("strong",{children:d("Selected product:")}),e.jsx("p",{children:Object.values(p)[0].variation_title})]})]})]}),e.jsxs(h,{children:[e.jsx("span",{className:"fct-inspector-control-label",children:d("Slides to show")}),e.jsx(V,{value:r.slidesToShow,onChange:t=>i({carouselSettings:{...r,slidesToShow:t}}),min:1,max:6})]}),e.jsx(h,{children:e.jsx(S,{label:d("Autoplay"),checked:r.autoplay==="yes",onChange:t=>i({carouselSettings:{...r,autoplay:t?"yes":"no"}})})}),e.jsx(h,{children:e.jsx(S,{label:d("Navigation arrows"),checked:r.arrows==="yes",onChange:t=>i({carouselSettings:{...r,arrows:t?"yes":"no"}})})}),e.jsx(h,{children:e.jsx(S,{label:d("Pagination dots"),checked:r.dots==="yes",onChange:t=>i({carouselSettings:{...r,dots:t?"yes":"no"}})})}),e.jsx(h,{children:e.jsx(S,{label:d("Infinite loop"),checked:r.infinite==="yes",onChange:t=>i({carouselSettings:{...r,infinite:t?"yes":"no"}})})})]})})})})})},ee=""+new URL("assets/ProductGallery.png",import.meta.url).href,{useBlockProps:se}=wp.blockEditor,{registerBlockType:te}=wp.blocks,{useEffect:k,useState:O}=wp.element,w=window.fluent_cart_media_carousel_data,M=w.placeholder_image,B=window.fluentCartRestVars.rest,{useSelect:oe}=wp.data,{store:le}=wp.blockEditor;te(w.slug+"/"+w.name,{apiVersion:3,title:w.title,description:w.description,example:{attributes:{},innerBlocks:[{name:"core/image",attributes:{url:ee,alt:"Product Media Carousel Preview",style:{width:"100%",height:"auto"}}}]},icon:{src:L},category:"fluent-cart",attributes:{product_id:{type:["string","number"],default:""},variation_ids:{type:"array",default:[]},query_type:{type:"string",default:"default"},inside_product_info:{type:"string",default:"-"},enableImageZoom:{type:"string",default:"yes"},carouselSettings:{type:"object",default:{slidesToShow:3,autoplay:"yes",arrows:"yes",dots:"yes",infinite:"no"}}},edit:({attributes:n,setAttributes:i,clientId:p})=>{var b,C,I,E;const y=se(),[f,r]=O({}),[j,N]=O([]),t=B.url+"/products/"+n.product_id,g=oe(s=>{const{getBlockParents:o,getBlockName:u}=s(le);return o(p).some(l=>u(l)==="fluent-cart/product-info")},[p]);i({inside_product_info:g?"yes":"no"});const c=H(),F=(s,o=[])=>{var l;const u=o.map(a=>String(a)),m={};if((l=s==null?void 0:s.variants)!=null&&l.length)return s.variants.forEach(a=>{var _,v;if(u.includes(String(a.id))){const Q=(_=s==null?void 0:s.detail)!=null&&_.featured_media?[{url:s.detail.featured_media.url,title:s.detail.featured_media.title}]:[],U=(((v=a==null?void 0:a.media)==null?void 0:v.meta_value)||[]).map(P=>({url:P.url,title:P.title})),K=[...Q,...U];m[a.id]={...a,images:K}}}),m},R=()=>{W({path:J(t,{with:["detail","variants"]}),headers:{"X-WP-Nonce":B.nonce}}).then(s=>{const o=F(s.product,n.variation_ids);r(o)}).finally(()=>{})},x=Number(((b=n.carouselSettings)==null?void 0:b.slidesToShow)||1),q=(s,o,u)=>{const m=Math.max(1,Number(o)||1);if(!s||s.length===0)return Array.from({length:m}).map((_,v)=>({id:`placeholder-${v}`,src:M,alt:""}));if(!u||s.length>=o)return s.slice(0,o);const l=[];let a=0;for(;l.length<o;)l.push(s[a%s.length]),a++;return l},T=((C=n.carouselSettings)==null?void 0:C.infinite)==="yes",G=q(j,x,T),$=j.length>0?j.length:x,z=Math.ceil($/x);return k(()=>{n.variation_ids&&R()},[n.variation_ids]),k(()=>{const o=(u=>{const m=[];return!u||Object.keys(u).length===0?[]:(Object.values(u).forEach(l=>{var a;(a=l==null?void 0:l.images)!=null&&a.length&&m.push(...l.images)}),m.filter(l=>l==null?void 0:l.url))})(f);N(o)},[f]),k(()=>{c!=null&&c.product&&r(c.product)},[c==null?void 0:c.product]),e.jsxs("div",{...y,children:[e.jsx(A,{attributes:n,setAttributes:i,selectedVariations:f,setSelectedVariations:r,isInsideProductInfo:g}),Object.keys(f||{}).length>0?e.jsx("div",{className:"fct-product-gallery-wrapper is-editor-preview",children:e.jsxs("div",{className:"fct-product-gallery-carousel editor-carousel-preview",style:{"--fct-slides-per-view":x},children:[e.jsx("div",{className:`editor-carousel-track ${x>1?"is-grid":"is-single"}`,children:G.map((s,o)=>e.jsx("div",{className:"editor-carousel-slide",children:e.jsx("img",{src:s.url??M,alt:s.title??""})},o))}),((I=n.carouselSettings)==null?void 0:I.arrows)==="yes"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"editor-carousel-nav prev","aria-hidden":"true",children:"‹"}),e.jsx("button",{className:"editor-carousel-nav next","aria-hidden":"true",children:"›"})]}),((E=n.carouselSettings)==null?void 0:E.dots)==="yes"&&e.jsx("div",{className:"editor-carousel-pagination",children:Array.from({length:z}).map((s,o)=>e.jsx("span",{className:`editor-carousel-dot ${o===0?"is-active":""}`},o))})]})}):e.jsx("div",{className:"fluent-cart-empty",children:e.jsx("div",{className:"fluent-cart-empty-message",children:d("No product media")})})]})},save:function(n){return null}});
