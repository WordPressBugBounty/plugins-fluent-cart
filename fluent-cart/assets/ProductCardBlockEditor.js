import{j as r,b as s}from"./chunks/BlockEditorTranslator.js";import{g as E}from"./chunks/Icons.js";import{a as F}from"./chunks/index4.js";import{E as V}from"./chunks/EditorPanel.js";import{E as m}from"./chunks/EditorPanelRow.js";import{C as x}from"./chunks/CustomSelect.js";import{S as $}from"./chunks/SelectProductModal.js";import{E as R}from"./chunks/ErrorBoundary.js";import{a as q}from"./chunks/add-query-args.js";import"./chunks/index5.js";import"./chunks/ProductListItem.js";const{InspectorControls:B}=wp.blockEditor,{RangeControl:P}=wp.components,D=({attributes:a,setAttributes:c,selectedProduct:p,setSelectedProduct:e})=>r.jsx(B,{children:r.jsx("div",{className:"fct-inspector-control-wrap fct-inspector-control-wrap--product-card",children:r.jsx("div",{className:"fct-inspector-control-group",children:r.jsx("div",{className:"fct-inspector-control-body",children:r.jsxs(V,{title:s("Product"),children:[r.jsxs(m,{children:[r.jsx("span",{className:"fct-inspector-control-label",children:s("Query type")}),r.jsx("div",{className:"actions",children:r.jsx(x,{customKeys:{key:"value",label:"label"},defaultValue:a.query_type,options:[{label:s("Default"),value:"default"},{label:s("Custom"),value:"custom"}],onChange:function(t){c({query_type:t})}})})]}),a.query_type==="custom"&&r.jsxs(m,{className:"flex-col",children:[r.jsx($,{selectedProduct:p,setSelectedProduct:e,onModalClosed:t=>{t&&(c({product_id:t.ID||""}),e(t))}}),p&&r.jsxs("div",{className:"fct-selected-variation-info w-full",children:[r.jsx("strong",{children:s("Selected product:")}),r.jsx("p",{children:p.post_title})]})]}),r.jsxs(m,{children:[r.jsx("span",{className:"fct-inspector-control-label",children:s("Price Format")}),r.jsx("div",{className:"actions",children:r.jsx(x,{customKeys:{key:"value",label:"label"},defaultValue:a.price_format,options:[{label:s("Starts From"),value:"starts_from"},{label:s("Range"),value:"range"}],onChange:function(t){c({price_format:t})}})})]}),r.jsxs(m,{className:"flex-col",children:[r.jsx("span",{className:"fct-inspector-control-label",children:s("Card Sizing")}),r.jsxs("div",{className:"actions",children:[r.jsx(x,{defaultValue:typeof a.card_width=="string"?"full":"custom",options:[{label:s("Full Width"),value:"full"},{label:s("Custom Width"),value:"custom"}],onChange:t=>{c(t==="full"?{card_width:"100%"}:{card_width:216})}}),a.card_width!=="100%"&&r.jsx(P,{value:a.card_width,onChange:t=>c({card_width:t}),min:216,max:1e3,step:10})]})]})]})})})})}),I=""+new URL("assets/ProductCard.png",import.meta.url).href,{useBlockProps:W}=wp.blockEditor,{registerBlockType:K}=wp.blocks,{useEffect:M,useState:Q}=wp.element,l=window.fluent_cart_product_card_data,w=window.fluentCartRestVars.rest,f=l.currency_sign,N=l.currency_position;K(l.slug+"/"+l.name,{apiVersion:3,title:l.title,description:l.description,example:{attributes:{},innerBlocks:[{name:"core/image",attributes:{url:I,alt:"Product Card Preview",style:{width:"100%",height:"auto"}}}]},icon:{src:E},category:"fluent-cart",attributes:{product_id:{type:["string","number"],default:""},price_format:{type:"string",default:"starts_from"},card_width:{type:["string","number"],default:216},query_type:{type:"string",default:"default"}},edit:({attributes:a,setAttributes:c})=>{const p=W(),[e,t]=Q({}),C=w.url+"/products/"+a.product_id,b=()=>{a.product_id&&F({path:q(C,{with:["variants"]}),headers:{"X-WP-Nonce":w.nonce}}).then(o=>{t(o.product||{})}).finally(()=>{})},S=()=>{var o;return((o=e==null?void 0:e.detail)==null?void 0:o.variation_type)==="simple_variations"};return M(()=>{b()},[a.product_id]),r.jsx("div",{...p,children:r.jsx(R,{children:r.jsxs("div",{className:"flex flex-col gap-4",children:[r.jsx(D,{attributes:a,setAttributes:c,selectedProduct:e,setSelectedProduct:t}),r.jsxs("div",{className:"fct-product-card",style:{width:a.card_width==="100%"?"100%":`${a.card_width}px`},children:[r.jsx("div",{className:"fct-product-card-head",children:r.jsx("img",{className:"fct-product-card-image",src:(e==null?void 0:e.thumbnail)??l.placeholder_image,alt:e==null?void 0:e.post_title})}),r.jsxs("div",{className:"fct-product-card-body",children:[r.jsx("h5",{className:"fct-product-card-title",children:(e==null?void 0:e.post_title)??s("Select a Product")}),r.jsx("div",{className:"fct-product-card-price-wrap",children:(()=>{var j,_,g,y;const o=a.price_format,k=((j=e==null?void 0:e.detail)==null?void 0:j.variation_type)==="simple";let n=(_=e==null?void 0:e.detail)==null?void 0:_.min_price,u=(g=e==null?void 0:e.detail)==null?void 0:g.max_price,h=0;if(k){const i=(y=e==null?void 0:e.variants)==null?void 0:y[0];i&&(n=i.item_price,i.compare_price>n&&(h=i.compare_price))}const d=i=>{if(!i&&i!==0)return N==="after"?`0.00${f}`:`${f}0.00`;const v=(i/100).toFixed(2);return N==="after"?`${v}${f}`:`${f}${v}`};return h?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"fc_compare_price",children:r.jsx("del",{children:d(h)})}),r.jsx("span",{className:"fct-item-price",children:d(n)})]}):u&&u>n?o==="range"?r.jsx(r.Fragment,{children:r.jsxs("span",{className:"fct-item-price",children:[d(n)," - ",d(u)]})}):r.jsx(r.Fragment,{children:r.jsxs("span",{className:"fct-item-price",children:["From ",d(n)]})}):r.jsx(r.Fragment,{children:r.jsx("span",{className:"fct-item-price",children:d(n)})})})()})]}),r.jsx("div",{className:"fct-product-card-footer",children:r.jsx("button",{className:"fluent-cart-shop-app-view-product-button",children:r.jsx("span",{children:s(S()?"View Options":"Add To Cart")})})})]})]})})})},save:function(a){return null}});
