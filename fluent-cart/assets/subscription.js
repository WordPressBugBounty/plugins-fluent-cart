import{a as d,c as f,o as c,d as e,b,w as n,u as h,e as _,f as s,F as E,h as W,l as te,i as se,j as ie,k as ne,Z as O,g as T,t as p}from"./chunks/vue.esm-bundler.js?ver=1.3.12";import{T as oe,a as le,C as y,c as w,d as C}from"./chunks/RouteCell.js?ver=1.3.12";import{P as ae,_ as re}from"./chunks/Empty.js?ver=1.3.12";import{t as u}from"./chunks/Translator.js?ver=1.3.12";import{A as F}from"./chunks/Arr.js?ver=1.3.12";import{d as ce,S as de,_ as Q,e as ue,b as pe,c as _e,a as be}from"./chunks/CancelSubscription.js?ver=1.3.12";import{_ as U}from"./chunks/_plugin-vue_export-helper.js?ver=1.3.12";import{d as L,r as me,E as R,b as fe}from"./chunks/index.js?ver=1.3.12";import{a as X}from"./chunks/CopyToClipboard.js?ver=1.3.12";import{e as he,L as ge,d as ve,f as ye}from"./chunks/OrderCustomerInformation.js?ver=1.3.12";import{S as Y}from"./chunks/Str.js?ver=1.3.12";import{_ as ee}from"./chunks/DynamicIcon.js?ver=1.3.12";import{_ as we}from"./chunks/NotFound.js?ver=1.3.12";import{B as Ce}from"./chunks/Badge.js?ver=1.3.12";import{g as Se}from"./chunks/common.js?ver=1.3.12";import{n as K}from"./chunks/Notify.js?ver=1.3.12";import"./chunks/Model.js?ver=1.3.12";import"./chunks/Rest.js?ver=1.3.12";import"./chunks/Url.js?ver=1.3.12";import"./chunks/dayjs.min.js?ver=1.3.12";import"./chunks/timezone.js?ver=1.3.12";import"./chunks/Utils.js?ver=1.3.12";import"./chunks/productService.js?ver=1.3.12";import"./chunks/BundleProducts.js?ver=1.3.12";import"./chunks/Asset.js?ver=1.3.12";const $e={class:"fct-subscriptions-route-wrap"},ke=Object.assign({name:"SubscriptionsRoute"},{__name:"SubscriptionsRoute",setup(t){return(i,l)=>{const r=d("router-view");return c(),f("div",$e,[e(r)])}}});class Te extends oe{getTabs(){return{all:u("All"),active:u("Active"),trialing:u("Trialing"),pending:u("Pending"),intended:u("Intended"),expired:u("Expired"),canceled:u("Canceled")}}getToggleableColumns(){return[{label:u("Order ID"),value:"order_id"},{label:u("Next Billing Date"),value:"next_billing_date"},{label:u("Collection Method"),value:"collection_method"},{label:u("Bills Count"),value:"bills_count"},{label:u("Customer"),value:"customer"},{label:u("Payment Method"),value:"payment_method"}]}getSortableColumns(){return[{label:u("Subscription ID"),value:"id"},{label:u("Next Billing Date"),value:"next_billing_date"},{label:u("Bills Count"),value:"bill_count"},{label:u("Created At"),value:"created_at"},{label:u("Status"),value:"status"}]}getSearchHint(){return u("by id, order id, status, payment method, customer name, or product.")}getFetchUrl(){return"subscriptions"}parseResponse(i){return i.data}getTableName(){return"subscriptions"}getAdvanceFilterOptions(){return F.get(window,"fluentCartAdminApp.filter_options.subscription_filter_options.advance")}getSearchGuideOptions(){return F.get(window,"fluentCartAdminApp.filter_options.subscription_filter_options.guide")}with(){return["customer"]}}function Be(t){return Te.init(t)}const xe={class:"table-cell"},Le={class:"table-cell"},Oe={class:"table-cell"},Fe={class:"table-cell"},Pe={class:"table-cell"},Me={class:"table-cell"},De={class:"table-cell"},Ie={class:"table-cell"},Re={class:"table-cell"},Ee={class:"table-cell"},Ae={class:"table-cell"},Ve={class:"table-cell"},Ne={__name:"SubscriptionsLoader",props:{nextPageCount:{type:Number,default:0},subscriptionTable:{type:Object,default:()=>({})}},setup(t){const i=t,l=Array.from({length:i.nextPageCount},(r,o)=>o+1);return(r,o)=>{const a=d("el-table-column"),m=d("el-skeleton-item"),S=d("el-table"),v=d("el-skeleton");return c(),b(v,{animated:""},{template:n(()=>[e(S,{data:h(l),class:"w-full compact-table responsive"},{empty:n(()=>o[0]||(o[0]=[])),default:n(()=>[_("",!0),e(a,{label:r.$t("ID"),width:"100"},{default:n(()=>[s("div",xe,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"]),e(a,{label:r.$t("Customer"),width:"280"},{default:n(()=>[s("div",Le,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"]),e(a,{label:r.$t("Product"),width:"360","show-overflow-tooltip":""},{default:n(()=>[s("div",Oe,[e(m,{varient:"p",class:"w-3/5"})])]),_:1},8,["label"]),e(a,{label:r.$t("Status"),width:"120"},{default:n(()=>[s("div",Fe,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"]),e(a,{label:r.$t("Billing"),width:"230"},{default:n(()=>[s("div",Pe,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"]),e(a,{label:r.$t("Created At"),width:"130"},{default:n(()=>[s("div",Me,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"]),t.subscriptionTable.data.columns.indexOf("valid_till")!==-1?(c(),b(a,{key:1,label:r.$t("Valid Till"),width:"120"},{default:n(()=>[s("div",De,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):_("",!0),t.subscriptionTable.data.columns.indexOf("next_billing_date")!==-1?(c(),b(a,{key:2,label:r.$t("Next Billing Date"),width:"160"},{default:n(()=>[s("div",Ie,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):_("",!0),t.subscriptionTable.data.columns.indexOf("collection_method")!==-1?(c(),b(a,{key:3,label:r.$t("Collection Method"),width:"160"},{default:n(()=>[s("div",Re,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):_("",!0),t.subscriptionTable.data.columns.indexOf("bills_count")!==-1?(c(),b(a,{key:4,label:r.$t("Bills Count"),width:"100"},{default:n(()=>[s("div",Ee,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):_("",!0),t.subscriptionTable.data.columns.indexOf("payment_method")!==-1?(c(),b(a,{key:5,label:r.$t("Payment Method"),width:"150"},{default:n(()=>[s("div",Ae,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):_("",!0),t.subscriptionTable.data.columns.indexOf("order_id")!==-1?(c(),b(a,{key:6,label:r.$t("Order ID"),width:"100"},{default:n(()=>[s("div",Ve,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):_("",!0)]),_:1},8,["data"])]),_:1})}}},je={},ze={class:"px-4 py-3"},He={class:"grid grid-cols-3 gap-5 mt-5"};function We(t,i){const l=d("el-skeleton-item"),r=d("el-skeleton");return c(),b(r,{animated:""},{template:n(()=>[s("div",ze,[(c(),f(E,null,W(2,o=>s("div",{key:o,class:"flex items-center justify-between mb-3"},[e(l,{varient:"p",class:"w-1/2"}),e(l,{varient:"p",class:"w-[100px]"})])),64)),s("div",He,[(c(),f(E,null,W(3,o=>s("div",{key:o},[e(l,{varient:"p",class:"w-1/2"}),e(l,{varient:"p",class:"w-[100px]"})])),64))])])]),_:1})}const Ue=U(je,[["render",We]]),qe={class:"fct-all-subscriptions-page fct-layout-width"},Ge={class:"fct-all-subscriptions-wrap"},Ze={key:1},Je={__name:"AllSubscriptions",setup(t){const i=Be({instance:te()}),l=se(!1),r=()=>{l.value=window.innerWidth<768};return ie(()=>{r(),window.addEventListener("resize",r)}),ne(()=>{window.removeEventListener("resize",r)}),(o,a)=>(c(),f("div",qe,[e(ae,{title:o.$t("Subscriptions")},null,8,["title"]),s("div",Ge,[e(le,{table:h(i),classicTabStyle:!0,"has-mobile-slot":!0},{mobile:n(()=>[h(i).isLoading()?(c(),b(Ue,{key:0})):_("",!0),h(i).isLoading()?_("",!0):(c(),b(de,{key:1,subscriptions:h(i).getTableData(),columns:h(i).data.columns},null,8,["subscriptions","columns"]))]),default:n(()=>[h(i).isLoading()?(c(),b(Ne,{key:0,subscriptionTable:h(i),"next-page-count":h(i).nextPageCount},null,8,["subscriptionTable","next-page-count"])):(c(),f("div",Ze,[e(ce,{subscriptions:h(i).getTableData(),columns:h(i).data.columns},null,8,["subscriptions","columns"])]))]),_:1},8,["table"])])]))}},Ke={name:"SubscriptionDetails",props:["subscription","orderId"],emits:["reload","fetchOrder"],data(){return{loadingState:{fetch:!1,pause:!1,resume:!1,cancel:!1},cancelSubscriptionModal:!1}},components:{CancelSubscription:ue,ConvertedTime:Q,CopyToClipboard:X,CardContainer:C,CardBody:w,CardHeader:y,DynamicIcon:ee,Refresh:me,Delete:L},computed:{Str(){return Y},permissions(){var l,r;const t=(((l=this.subscription)==null?void 0:l.status)||"").toLowerCase();let i=(r=this.subscription)==null?void 0:r.vendor_subscription_id;return{canFetch:!0,canPause:i&&!["canceled","paused","trialing","pending","intended","active(collection paused)"].includes(t),canResume:i&&["paused","active(collection paused)"].includes(t),canCancel:i&&!["canceled"].includes(t)}},paymentMethod(){var t;return((t=this.subscription)==null?void 0:t.current_payment_method)||""},showNextBillingDate(){var i;const t=(((i=this.subscription)==null?void 0:i.status)||"").toLowerCase();return t==="active"||t==="trialing"}},methods:{handleSubscriptionAction(t){t==="fetch_subscription"?this.confirmFetch():t==="pause_subscription"?this.confirmPause():t==="resume_subscription"?this.confirmResume():t==="cancel_subscription"&&this.confirmCancel()},confirmFetch(){var t;!this.subscription.vendor_subscription_id&&((t=this.order)==null?void 0:t.payment_method)!=="offline_payment"||R.confirm("Fetch from remote and update the subscription?","Warning",{type:"warning",icon:O(L),cancelButtonText:"Back",confirmButtonText:"Fetch subscription!",beforeClose:async(i,l,r)=>{var o,a;if(i==="confirm")try{l.confirmButtonLoading=!0,this.loadingState.fetch=!0,await this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/fetch`,{data:{vendor_charge_id:this.subscription.vendor_subscription_id}}),this.$notify({type:"success",title:"Success",message:"Subscription fetched successfully"}),this.$emit("reload")}catch(m){this.$notify({type:"error",title:"Error",message:u(((a=(o=m.response)==null?void 0:o.data)==null?void 0:a.message)||"Failed to fetch subscription")}),console.error(m)}finally{l.confirmButtonLoading=!1,this.loadingState.fetch=!1,r()}else r()}})},confirmPause(){this.subscription.vendor_subscription_id&&R.prompt("Pause the active subscription?","Warning",{type:"warning",icon:O(L),inputPlaceholder:"Enter reason for pausing",inputPattern:/.+/,inputErrorMessage:"Reason is required",cancelButtonText:"Back",confirmButtonText:u("Pause Subscription!"),beforeClose:async(t,i,l)=>{var r,o;if(t==="confirm")try{i.confirmButtonLoading=!0,this.loadingState.pause=!0,await this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/pause`,{data:{vendor_subscription_id:this.subscription.vendor_subscription_id,reason:i.inputValue}}),this.$notify({type:"success",title:"Success",message:"Subscription paused successfully"}),this.$emit("reload")}catch(a){this.$notify({type:"error",title:"Error",message:u(((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to pause subscription")}),console.error(a)}finally{i.confirmButtonLoading=!1,this.loadingState.pause=!1,l()}else l()}})},confirmResume(){this.subscription.vendor_subscription_id&&R.prompt(u("Resume the paused subscription?"),u("Warning"),{type:"warning",icon:O(L),inputPlaceholder:u("Enter reason for resuming"),inputPattern:/.+/,inputErrorMessage:u("Reason is required"),cancelButtonText:u("Back"),confirmButtonText:u("Resume Subscription!"),beforeClose:async(t,i,l)=>{if(t==="confirm")try{i.confirmButtonLoading=!0,this.loadingState.resume=!0,await this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/resume`,{data:{vendor_subscription_id:this.subscription.vendor_subscription_id,reason:i.inputValue}}),this.$notify({type:"success",title:"Success",message:"Subscription resumed successfully"}),this.$emit("reload")}catch(r){this.$notify({type:"error",title:"Error",message:"Failed to resume subscription"}),console.error(r)}finally{i.confirmButtonLoading=!1,this.loadingState.resume=!1,l()}else l()}})},confirmCancel(){this.subscription.vendor_subscription_id&&(this.cancelSubscriptionModal=!0)},confirmReactivate(){this.subscription.vendor_subscription_id&&R.confirm("Reactivate the canceled subscription?","Warning",{type:"warning",icon:O(L),cancelButtonText:"Back",confirmButtonText:"Reactivate Subscription!",beforeClose:async(t,i,l)=>{var r,o;if(t==="confirm")try{i.confirmButtonLoading=!0,this.loadingState.reactivate=!0,await this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/reactivate`,{data:{vendor_subscription_id:this.subscription.vendor_subscription_id}}),this.$notify({type:"success",title:"Success",message:"Subscription reactivated successfully"}),this.$emit("reload")}catch(a){this.$notify({type:"error",title:"Error",message:u(((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to reactivate subscription")}),console.error(a)}finally{i.confirmButtonLoading=!1,this.loadingState.reactivate=!1,l()}else l()}})}}},Qe={class:"more-btn"},Xe={class:"text-red-600"},Ye={class:"fct-single-subscription-pricing-table"},et={class:"fct-single-subscription-details"},tt={class:"fct-single-subscription-details-label"},st=["innerHTML"],it={class:"fct-single-subscription-details-label"},nt={class:"fct-single-subscription-details-value"},ot={key:0},lt={key:1,class:"flex items-center gap-2.5"},at={class:"fct-single-subscription-details-label"},rt={class:"fct-single-subscription-details-value"},ct={class:"fct-single-subscription-details-label"},dt={class:"fct-single-subscription-details-value"},ut={class:"fct-single-subscription-details-label"},pt={class:"fct-single-subscription-details-value"},_t={key:0},bt={class:"fct-single-subscription-details-label"},mt={class:"fct-single-subscription-details-value"},ft={class:"fct-single-subscription-details-label"},ht={class:"fct-single-subscription-details-value"},gt={key:0,class:"flex items-center justify-between gap-2 w-full"},vt={class:"truncate w-[calc(100%-2rem)] overflow-hidden text-ellipsis whitespace-nowrap block"},yt={key:1,class:"text-system-light dark:text-gray-300"},wt={key:1},Ct={class:"fct-single-subscription-details-label"},St=["href"],$t={class:"fct-single-subscription-details-label"},kt={class:"fct-single-subscription-details-value"},Tt={key:0,class:"flex items-center justify-between"},Bt={class:"truncate w-[calc(100%-2rem)] overflow-hidden text-ellipsis whitespace-nowrap block"},xt={key:1,class:"text-system-light dark:text-gray-300"};function Lt(t,i,l,r,o,a){const m=d("DynamicIcon"),S=d("refresh"),v=d("el-icon"),$=d("el-dropdown-item"),A=d("delete"),V=d("el-dropdown-menu"),N=d("el-dropdown"),B=d("CardHeader"),P=d("ConvertedTime"),M=d("el-tooltip"),k=d("CopyToClipboard"),j=d("CardBody"),z=d("CancelSubscription"),H=d("CardContainer");return c(),b(H,null,{default:n(()=>[e(B,{border_bottom:"",title:t.$t("Subscription Details"),title_size:"small"},{default:n(()=>[l.subscription.vendor_subscription_id&&(a.permissions.canFetch||a.permissions.canPause||a.permissions.canResume||a.permissions.canCancel)?(c(),b(N,{key:0,trigger:"click",class:"fct-more-option-wrap","popper-class":"fct-dropdown",onCommand:i[0]||(i[0]=g=>a.handleSubscriptionAction(g))},{dropdown:n(()=>[e(V,null,{default:n(()=>[a.permissions.canFetch?(c(),b($,{key:0,command:"fetch_subscription"},{default:n(()=>[e(v,null,{default:n(()=>[e(S)]),_:1}),T(" "+p(t.$t("Fetch subscription -"))+" "+p(a.paymentMethod),1)]),_:1})):_("",!0),a.permissions.canPause?(c(),b($,{key:1,command:"pause_subscription"},{default:n(()=>[e(v,null,{default:n(()=>[e(S)]),_:1}),T(" "+p(t.$t("Pause subscription -"))+" "+p(a.paymentMethod),1)]),_:1})):_("",!0),a.permissions.canResume?(c(),b($,{key:2,command:"resume_subscription"},{default:n(()=>[e(v,null,{default:n(()=>[e(S)]),_:1}),T(" "+p(t.$t("Resume subscription -"))+" "+p(a.paymentMethod),1)]),_:1})):_("",!0),a.permissions.canCancel?(c(),b($,{key:3,command:"cancel_subscription"},{default:n(()=>[e(v,null,{default:n(()=>[e(A)]),_:1}),s("span",Xe,p(t.$t("Cancel subscription")),1)]),_:1})):_("",!0)]),_:1})]),default:n(()=>[s("span",Qe,[e(m,{name:"More"})])]),_:1})):_("",!0)]),_:1},8,["title"]),e(j,null,{default:n(()=>{var g,D,x,I,q,G,Z;return[s("div",Ye,[s("p",null,p(t.$t("Product Name")),1),s("h3",null,p(l.subscription.item_name),1)]),s("ul",et,[s("li",null,[s("div",tt,p(t.$t("Billing Cycle")),1),s("div",{class:"fct-single-subscription-details-value",innerHTML:l.subscription.payment_info},null,8,st)]),s("li",null,[s("div",it,p(t.$t("Active Payment Gateway")),1),s("div",nt,[l.subscription.current_payment_method?(c(),f("div",lt,[s("span",null,p(a.Str.headline(l.subscription.current_payment_method)),1)])):(c(),f("span",ot,"----"))])]),s("li",null,[s("div",at,p(t.$t("Initial Purchase ID")),1),s("div",rt," #"+p(l.subscription.parent_order_id),1)]),s("li",null,[s("div",ct,p(t.$t("Auto-cancellation")),1),s("div",dt,p(l.subscription.expire_at?l.subscription.expire_at:"---"),1)]),s("li",null,[s("div",ut,p(t.$t("Started")),1),s("div",pt,[e(P,{"date-time":l.subscription.created_at,withTime:!1},null,8,["date-time"])])]),a.showNextBillingDate?(c(),f("li",_t,[s("div",bt,p(t.$t("Next invoice")),1),s("div",mt,[T(p(t.formatNumber(l.subscription.recurring_total))+" on ",1),e(P,{"date-time":l.subscription.next_billing_date,withTime:!1},null,8,["date-time"])])])):_("",!0),s("li",null,[s("div",ft,p(t.$t("Vendor Subscription ID")),1),s("div",ht,[l.subscription.vendor_subscription_id?(c(),f("div",gt,[e(M,{class:"w-full",content:l.subscription.vendor_subscription_id,placement:"top","popper-class":"fct-tooltip"},{default:n(()=>[s("span",vt,p(l.subscription.vendor_subscription_id),1)]),_:1},8,["content"]),e(k,{text:l.subscription.vendor_subscription_id,showMode:"basic_copy_btn",tooltipText:"Copy"},null,8,["text"])])):(c(),f("span",yt,p(t.$t("n/a")),1))])]),(g=l.subscription)!=null&&g.vendor_subscription_id?(c(),f("li",wt,[s("div",Ct," View on "+p((D=l.subscription)==null?void 0:D.current_payment_method)+": ",1),s("a",{target:"_blank",class:"fct-single-subscription-details-value !underline focus:shadow-none",href:(x=l.subscription)==null?void 0:x.url},p((I=l.subscription)==null?void 0:I.vendor_subscription_id),9,St)])):_("",!0),s("li",null,[s("div",$t,p(t.$t("Vendor Customer ID")),1),s("div",kt,[(q=l.subscription)!=null&&q.vendor_customer_id?(c(),f("div",Tt,[e(M,{class:"w-full",content:(G=l.subscription)==null?void 0:G.vendor_customer_id,placement:"top","popper-class":"fct-tooltip"},{default:n(()=>{var J;return[s("span",Bt,p((J=l.subscription)==null?void 0:J.vendor_customer_id),1)]}),_:1},8,["content"]),e(k,{text:(Z=l.subscription)==null?void 0:Z.vendor_customer_id,showMode:"basic_copy_btn",tooltipText:"Copy"},null,8,["text"])])):(c(),f("span",xt,p(t.$t("n/a")),1))])])])]}),_:1}),e(z,{subscription:l.subscription,orderId:l.orderId,onClose:i[1]||(i[1]=g=>o.cancelSubscriptionModal=!1),modelValue:o.cancelSubscriptionModal,"onUpdate:modelValue":i[2]||(i[2]=g=>o.cancelSubscriptionModal=g),onReload:i[3]||(i[3]=g=>t.$emit("reload")),onCancelSubscription:a.confirmCancel},null,8,["subscription","orderId","modelValue","onCancelSubscription"])]),_:1})}const Ot=U(Ke,[["render",Lt]]),Ft={class:"fct-single-order-loader-wrap fct-layout-width"},Pt={class:"single-page-header fct-page-loader-header min-h-18 flex items-start justify-between"},Mt={class:"single-page-body"},Dt={class:"fct-single-order"},It={class:"fct-single-order-main"},Rt={class:"fct-single-order-aside"},Et={class:"fct-admin-sidebar"},At={props:{loading:{type:Boolean,default:!1}}},Vt=Object.assign(At,{__name:"SingleSubscriptionLoader",setup(t){return(i,l)=>{const r=d("el-skeleton-item"),o=d("el-skeleton");return c(),f("div",Ft,[s("div",Pt,[e(o,{animated:"",class:"flex flex-col items-start gap-2"},{template:n(()=>[e(r,{class:"max-w-180"}),e(r,{class:"max-w-[100px]"})]),_:1})]),s("div",Mt,[s("div",Dt,[s("div",It,[e(C,{class:"overflow-hidden"},{default:n(()=>[e(y,{border_bottom:"",title:i.$t("Subscription Details")},null,8,["title"]),e(w,{class:"grid gap-5 grid-cols-[repeat(auto-fit,minmax(200px,1fr))]"},{default:n(()=>[(c(),f(E,null,W(9,a=>e(o,{key:a,animated:!0},{template:n(()=>[s("div",null,[e(r,{variant:"p",class:"w-full"}),e(r,{variant:"p",style:{width:"50%"}})])]),_:2},1024)),64))]),_:1})]),_:1}),e(C,{class:"overflow-hidden"},{default:n(()=>[e(y,{border_bottom:"",title:i.$t("Related Orders")},null,8,["title"]),e(w,null,{default:n(()=>[e(o,{animated:"",rows:3})]),_:1})]),_:1}),e(C,{class:"overflow-hidden"},{default:n(()=>[e(y,{border_bottom:"",title:i.$t("Related Licenses")},null,8,["title"]),e(w,null,{default:n(()=>[e(o,{animated:"",rows:3})]),_:1})]),_:1})]),s("div",Rt,[s("div",Et,[e(C,null,{default:n(()=>[e(y,{title:i.$t("Subscription Plan"),border_bottom:"",title_size:"small"},null,8,["title"]),e(w,null,{default:n(()=>[e(o,{animated:"",rows:2})]),_:1})]),_:1}),e(C,null,{default:n(()=>[e(y,{title:i.$t("Customer Details"),border_bottom:"",title_size:"small"},null,8,["title"]),e(w,null,{default:n(()=>[e(o,{animated:"",rows:3})]),_:1})]),_:1}),e(C,null,{default:n(()=>[e(y,{title:i.$t("Labels"),border_bottom:"",title_size:"small"},null,8,["title"]),e(w,null,{default:n(()=>[e(o,{animated:"",rows:1})]),_:1})]),_:1})])])])])])}}}),Nt={name:"SingleSubscription",props:["subscription_id"],data(){return{notFound:{show:!1,message:"",buttonText:"",route:""},subscription:{},loading:!1,parentOrderLoading:!0,error:null,ArrowRight:O(fe),parentOrder:null,selectedLabels:[],changeCustomer:!1}},watch:{subscription_id:{handler(t,i){this.fetchSubscription()}}},computed:{Str(){return Y},subscriptionStatus(){var t;return(t=this.subscription)==null?void 0:t.status}},components:{ChangeOrderCustomer:ye,DynamicIcon:ee,ConvertedTime:Q,Badge:Ce,NotFound:we,SingleSubscriptionLoader:Vt,SubscriptionDetails:Ot,Labels:ve,LicenseTable:ge,Empty:re,CopyToClipboard:X,CardContainer:C,CardBody:w,CardHeader:y,OrdersTable:be,CustomerPurchaseValue:_e,OrderCustomerInformation:he,OrdersTableMobile:pe},methods:{translate:u,getCardBrand:Se,fetchSubscription(){this.notFound.show=!1,this.loading=!0,this.$get("subscriptions/"+this.subscription_id).then(t=>{this.subscription=t.subscription,this.selectedLabels=t.selected_labels,this.getParentOrder()}).catch(t=>{var i;t.code==="fluent_cart_entity_not_found"?(this.notFound.show=!0,this.notFound.buttonText=F.get(t,"data.buttonText"),this.notFound.message=F.get(t,"data.message"),this.notFound.route=F.get(t,"data.route")):t.status_code=="422"?K.validationErrors(t):K.error((i=t.data)==null?void 0:i.message)}).finally(()=>{this.loading=!1})},getParentOrder(){var t;this.$get("orders/"+((t=this.subscription)==null?void 0:t.parent_order_id)).then(i=>{this.parentOrder=i.order}).finally(()=>{this.parentOrderLoading=!1})},reload(){window.location.reload()},handleCommand(t){t==="change_customer"&&(this.changeCustomer=!0)}},mounted(){this.fetchSubscription()}},jt={key:1,class:"fct-single-subscription-page"},zt={key:1,class:"fct-single-order-wrapper fct-layout-width"},Ht={class:"single-page-header flex items-start justify-between"},Wt={class:"single-page-header-title-wrap"},Ut={class:"single-page-header-status-wrap"},qt={class:"pt-2 text-xs text-system-mid dark:text-gray-300"},Gt={class:"single-page-body"},Zt={class:"fct-single-subscription"},Jt={class:"fct-single-subscription-main"},Kt={class:"fct-single-subscription-aside"},Qt={class:"fct-admin-sidebar"},Xt={class:"fct-admin-sidebar"};function Yt(t,i,l,r,o,a){var x;const m=d("NotFound"),S=d("SingleSubscriptionLoader"),v=d("el-breadcrumb-item"),$=d("el-breadcrumb"),A=d("Badge"),V=d("ConvertedTime"),N=d("SubscriptionDetails"),B=d("CardHeader"),P=d("orders-table"),M=d("OrdersTableMobile"),k=d("CardContainer"),j=d("license-table"),z=d("el-skeleton"),H=d("CardBody"),g=d("OrderCustomerInformation"),D=d("Labels");return c(),f(E,null,[o.notFound.show?(c(),b(m,{key:0,"button-text":o.notFound.buttonText,message:o.notFound.message,route:o.notFound.route},null,8,["button-text","message","route"])):_("",!0),o.notFound.show===!1?(c(),f("div",jt,[o.loading?(c(),b(S,{key:0})):_("",!0),!o.loading&&o.subscription.id?(c(),f("div",zt,[s("div",Ht,[s("div",null,[s("div",Wt,[e($,{"separator-icon":o.ArrowRight},{default:n(()=>[e(v,{to:{name:"all_subscriptions"}},{default:n(()=>[T(p(t.$t("Subscriptions")),1)]),_:1}),e(v,null,{default:n(()=>[T("#"+p(l.subscription_id),1)]),_:1})]),_:1},8,["separator-icon"]),s("div",Ut,[e(A,{status:a.subscriptionStatus},null,8,["status"])])]),s("div",qt,[e(V,{"date-time":o.subscription.created_at,"with-time":""},null,8,["date-time"])])]),i[2]||(i[2]=s("div",{class:"fct-btn-group sm"},null,-1))]),s("div",Gt,[s("div",Zt,[s("div",Jt,[e(N,{subscription:o.subscription,orderId:(x=o.parentOrder)==null?void 0:x.id,onFetchOrder:i[0]||(i[0]=I=>t.$emit("fetchSubscription")),onReload:i[1]||(i[1]=I=>a.reload())},null,8,["subscription","orderId"]),e(k,{class:"overflow-hidden"},{default:n(()=>[e(B,{class:"pb-4",title:t.$t("Related Orders")+" ("+o.subscription.related_orders.length+")",title_size:"small"},null,8,["title"]),e(P,{class:"hide-on-mobile",orders:o.subscription.related_orders,columns:["type"]},null,8,["orders"]),e(M,{class:"show-on-mobile fct-single-subscription-orders-mobile",orders:o.subscription.related_orders,columns:["type"]},null,8,["orders"])]),_:1}),o.subscription.licenses?(c(),b(k,{key:0,class:"overflow-hidden"},{default:n(()=>[e(B,{class:"pb-4",title:t.$t("Related Licenses"),title_size:"small"},null,8,["title"]),e(j,{licenses:o.subscription.licenses,columns:[]},null,8,["licenses"])]),_:1})):_("",!0)]),s("div",Kt,[s("div",Qt,[o.parentOrderLoading?(c(),b(k,{key:0},{default:n(()=>[e(B,{title:t.$t("Subscription Plan"),title_size:"small",border_bottom:""},null,8,["title"]),e(H,null,{default:n(()=>[e(z,{rows:3,animated:!0})]),_:1})]),_:1})):_("",!0)]),s("div",Xt,[o.subscription.customer?(c(),b(g,{key:0,order:o.subscription,shouldEnableEditing:!0},null,8,["order"])):_("",!0),e(D,{"bind-to-id":o.subscription.id,"bind-to-type":"Subscription",selectedLabels:o.selectedLabels,shouldEnableEditing:!0,"onUpdate:updateLabel":()=>{}},null,8,["bind-to-id","selectedLabels"])])])])])])):_("",!0)])):_("",!0)],64)}const es=U(Nt,[["render",Yt]]);window.fluent_cart_admin.hooks.addFilter("fluent_cart_routes","fluent_all_subscriptions",function(t){return t.subscription_route={name:"subscriptions",path:"/subscriptions",component:ke,children:[{name:"all_subscriptions",path:"",component:Je,meta:{active_menu:"subscriptions",title:"Subscriptions"}},{name:"view_subscription",path:":subscription_id/view",component:es,props:!0,meta:{active_menu:"subscriptions",title:u("View Subscription")}}]},t});
