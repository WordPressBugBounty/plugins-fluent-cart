import{j as e,b as c}from"./BlockEditorTranslator.js";import{I as C,P as O,E as A}from"./ProductListItem.js";import{f as L}from"./Icons.js";import"./index5.js";import{a as M}from"./index4.js";import{a as D}from"./add-query-args.js";const{useEffect:k,useState:x}=wp.element,V=window.fluentCartRestVars.rest,F=_=>{const{preSelectedVariations:o,onVariationSelectionUpdated:p,isMultiple:l=!0,translationKey:d="fluent_cart_pricing_table_block_editor_data",allow_subscription:u=!0,not_subscribable:g=!1}=_,f=V.url+"/products",[y,m]=x(!1),[h,b]=x({per_page:10,current_page:1,total:0,last_page:1}),[r,i]=x({}),[n,j]=x(o||{}),S=(t,s)=>{let a={...n};s?(l||(a={}),a[t.id]={...t}):a.hasOwnProperty(t.id)&&delete a[t.id],j(a),typeof p=="function"&&p(a)},P=(t=null)=>{m(!0),i({});let s={admin_filters:{},with:["detail","variants"],active_view:"publish",per_page:10,page:1,order_by:"ID",order_type:"DESC",search:t};u||(s.scopes=["cartable"]),g&&(s.active_view="not_subscribable"),M({path:D(f,{...s}),headers:{"X-WP-Nonce":V.nonce}}).then(a=>{let I={...h,per_page:a.products.per_page,current_page:a.products.current_page,total:a.products.total,last_page:a.products.last_page},v=a.products.data;console.log(v,"products"),b(N=>({...N,...I})),i(N=>({...N,...v}))}).finally(()=>{m(!1)})};k(()=>{P()},[]),k(()=>{j(o||{})},[o]);const E=t=>{P(t)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fct-popup-search-wrap",children:e.jsx(C,{icon:!0,name:"search",placeholder:c("Search for products..."),onKeyDown:t=>{const s=t.target.value;t.key==="Enter"&&E(s)}})}),e.jsx("div",{className:"fct-popup-body-inner",children:y?e.jsx("div",{className:"fct-skeleton-container",children:[...Array(9)].map((t,s)=>e.jsx("div",{className:"skeleton skeleton-item"},s))}):Object.keys(r).length>0?e.jsx("div",{className:"fct-popup-product-list-container",children:e.jsx("ul",{className:"fct-collapsible-list",children:Object.entries(r).map((t,s)=>e.jsx("li",{className:"fct-collapsible-list-item",children:e.jsx(O,{allow_subscription:u,isMultiple:l,products:r,index:s,selectedVariations:{...n},updateSelectedVariations:S})},s))})}):e.jsx(A,{text:c("We couldn't find any products matching your search")})})]})},{useEffect:U,useState:w}=wp.element,Q=_=>{const{preSelectedVariations:o,setAttributes:p,onModalClosed:l,isMultiple:d=!0,buttonLabel:u,allow_subscription:g=!0,button:f=!1,not_subscribable:y=!1}=_,[m,h]=w(!1),[b,r]=w(o||{}),i=()=>{h(!0)},n=()=>{h(!1),typeof l=="function"&&l(b)},j=u||(d?c("Add Items"):c("Add Item"));return U(()=>{r(o||{})},[o]),e.jsxs(e.Fragment,{children:[f&&e.jsx("button",{className:"fct-button fct-button-secondary",onClick:i,children:c("Select Product")}),!f&&e.jsx(C,{icon:!0,placeholder:c("Search Products"),onClick:i}),m&&e.jsxs("div",{className:"fct-popup-container",children:[e.jsx("div",{className:"fct-popup-overlay",onClick:n}),e.jsxs("div",{className:"fct-popup-inner-container",children:[e.jsxs("div",{className:"fct-popup-head",children:[e.jsx("h4",{className:"fct-popup-head-title",children:d?c("Select Products"):c("Select Product")}),e.jsx("button",{type:"button",className:"fct-popup-close",onClick:n,children:e.jsx(L,{})})]}),e.jsx("div",{className:"fct-popup-body",children:e.jsx(F,{not_subscribable:y,allow_subscription:g,preSelectedVariations:o,setAttributes:p,onVariationSelectionUpdated:S=>{r(S)},isMultiple:d})}),e.jsxs("div",{className:"fct-popup-footer",children:[e.jsx("button",{className:"fct-button fct-button-info-soft",onClick:n,children:c("Cancel")}),e.jsx("button",{className:"fct-button fct-button-primary",onClick:()=>{n()},disabled:Object.keys(b).length===0,children:j})]})]})]})]})};export{Q as S};
