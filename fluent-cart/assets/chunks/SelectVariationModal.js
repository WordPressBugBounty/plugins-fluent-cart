import{j as t,b as c}from"./BlockEditorTranslator.js?ver=1.3.13";import{I as O,P as M,E as D}from"./ProductListItem.js?ver=1.3.13";import{f as F}from"./Icons.js?ver=1.3.13";import"./index5.js?ver=1.3.13";import{a as U}from"./index4.js?ver=1.3.13";import{a as B}from"./add-query-args.js?ver=1.3.13";const{useEffect:w,useState:y}=wp.element,C=window.fluentCartRestVars.rest,K=P=>{const{preSelectedVariations:a,onVariationSelectionUpdated:f,isMultiple:m=!0,translationKey:b="fluent_cart_pricing_table_block_editor_data",allow_subscription:h=!0,not_subscribable:N=!1}=P,j=C.url+"/products",[v,r]=y(!1),[_,x]=y({per_page:10,current_page:1,total:0,last_page:1}),[l,p]=y({}),[i,g]=y(a||{}),S=(s,e,o)=>{const d={...s},n=String(e.id),u=String(e.post_id||e.product_id),k=Object.values(s).map(I=>String(I.post_id||I.product_id))[0]||null;return e.is_child?k&&k!==u?o?{[n]:e}:{}:(o?d[n]=e:delete d[n],d):o?{[n]:e}:{}},A=(s,e)=>{g(o=>S(o,s,e)),typeof f=="function"&&f(o=>S(o,s,e))},V=(s=null)=>{r(!0),p({});let e={admin_filters:{},with:["detail","variants"],active_view:"publish",per_page:10,page:1,order_by:"ID",order_type:"DESC",search:s};h||(e.scopes=["cartable"]),N&&(e.active_view="not_subscribable"),U({path:B(j,{...e}),headers:{"X-WP-Nonce":C.nonce}}).then(o=>{let d={..._,per_page:o.products.per_page,current_page:o.products.current_page,total:o.products.total,last_page:o.products.last_page},n=o.products.data;console.log(n,"products"),x(u=>({...u,...d})),p(u=>({...u,...n}))}).finally(()=>{r(!1)})};w(()=>{V()},[]),w(()=>{g(a||{})},[a]);const L=s=>{V(s)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fct-popup-search-wrap",children:t.jsx(O,{icon:!0,name:"search",placeholder:c("Search for products..."),onKeyDown:s=>{const e=s.target.value;s.key==="Enter"&&L(e)}})}),t.jsx("div",{className:"fct-popup-body-inner",children:v?t.jsx("div",{className:"fct-skeleton-container",children:[...Array(9)].map((s,e)=>t.jsx("div",{className:"skeleton skeleton-item"},e))}):Object.keys(l).length>0?t.jsx("div",{className:"fct-popup-product-list-container",children:t.jsx("ul",{className:"fct-collapsible-list",children:Object.entries(l).map((s,e)=>t.jsx("li",{className:"fct-collapsible-list-item",children:t.jsx(M,{allow_subscription:h,isMultiple:m,products:l,index:e,selectedVariations:{...i},updateSelectedVariations:A})},e))})}):t.jsx(D,{text:c("We couldn't find any products matching your search")})})]})},{useEffect:R,useState:E}=wp.element,H=P=>{const{preSelectedVariations:a,setAttributes:f,onModalClosed:m,isMultiple:b=!0,buttonLabel:h,allow_subscription:N=!0,button:j=!1,not_subscribable:v=!1}=P,[r,_]=E(!1),[x,l]=E(a||{}),p=()=>{_(!0)},i=()=>{_(!1),typeof m=="function"&&m({...x})},g=h||(b?c("Add Items"):c("Add Item"));return R(()=>{r&&l(a||{})},[r]),t.jsxs(t.Fragment,{children:[j&&t.jsx("button",{className:"fct-button fct-button-secondary",onClick:p,children:c("Select Product")}),!j&&t.jsx(O,{icon:!0,placeholder:c("Search Products"),onClick:p}),r&&t.jsxs("div",{className:"fct-popup-container",children:[t.jsx("div",{className:"fct-popup-overlay",onClick:i}),t.jsxs("div",{className:"fct-popup-inner-container",children:[t.jsxs("div",{className:"fct-popup-head",children:[t.jsx("h4",{className:"fct-popup-head-title",children:b?c("Select Products"):c("Select Product")}),t.jsx("button",{type:"button",className:"fct-popup-close",onClick:i,children:t.jsx(F,{})})]}),t.jsx("div",{className:"fct-popup-body",children:t.jsx(K,{not_subscribable:v,allow_subscription:N,preSelectedVariations:a,setAttributes:f,onVariationSelectionUpdated:S=>{l(S)},isMultiple:b})}),t.jsxs("div",{className:"fct-popup-footer",children:[t.jsx("button",{className:"fct-button fct-button-info-soft",onClick:i,children:c("Cancel")}),t.jsx("button",{className:"fct-button fct-button-primary",onClick:()=>{i()},disabled:Object.keys(x).length===0,children:g})]})]})]})]})};export{H as S};
