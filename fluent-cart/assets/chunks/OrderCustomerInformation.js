var Re=Object.defineProperty;var We=(s,e,l)=>e in s?Re(s,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[e]=l;var me=(s,e,l)=>We(s,typeof e!="symbol"?e+"":e,l);import{i as x,m as K,p as ae,j as _e,a as L,b as N,o as n,w as i,f as a,c,d as o,u as y,n as z,F as j,t as r,e as g,h as q,g as $,r as qe,K as xe,l as Se,I as He,x as ze,D as Ke}from"./vue.esm-bundler.js?ver=1.3.13";import{_ as fe}from"./_plugin-vue_export-helper.js?ver=1.3.13";import{B as Ze,I as ve}from"./Badge.js?ver=1.3.13";import{_ as Qe}from"./Empty.js?ver=1.3.13";import{b as Ye}from"./common.js?ver=1.3.13";import{b as H,c as he,a as re,C as Ge}from"./CopyToClipboard.js?ver=1.3.13";import{_ as F}from"./DynamicIcon.js?ver=1.3.13";import{t as v,a as ie}from"./Translator.js?ver=1.3.13";import{_ as Je,C as Te,c as Ue,d as Oe}from"./RouteCell.js?ver=1.3.13";import{A as Ne}from"./Arr.js?ver=1.3.13";import{A as Xe}from"./Asset.js?ver=1.3.13";import{n as U}from"./Notify.js?ver=1.3.13";import{R as Z}from"./Rest.js?ver=1.3.13";import{L as Pe,u as et}from"./NotFound.js?ver=1.3.13";import{f as Be}from"./index.js?ver=1.3.13";import{f as tt}from"./productService.js?ver=1.3.13";const st={class:"fct-customer-edit-modal"},lt={class:"fct-compact-form"},at={class:"form-heading"},ot={class:"fct-compact-form fct-customer-address-section"},dt={key:0,class:"mt-5"},nt={key:1,class:"form-error-wrap"},rt={class:"dialog-footer"},it={__name:"NewCustomerModal",props:{customer_id:{type:[String,Number],default:null},customer:{type:Object,default:()=>({})},customerModalInfos:{type:Object,default:()=>({})}},emits:["close-modal","select-new-customer","update:customerModal"],setup(s,{emit:e}){const l=e,A=s,m=x({}),d=x(!1),h=x({}),M=window.fluentCartAdminApp,P=()=>{l("close-modal")},I=()=>{d.value=!0,m.value.wp_user=A.customerModalInfos.manageWpUser,Z.post("customers/",{...m.value}).then(p=>{l("select-new-customer",p.data),l("update:customerModal",!1),U.success(p.message),h.value={}}).catch(p=>{var f;p.status_code=="422"?(U.validationErrors(p),h.value=p.data):U.error((f=p.data)==null?void 0:f.message)}).finally(()=>{d.value=!1})},O=()=>{d.value=!0,m.value.wp_user=A.customerModalInfos.manageWpUser,Z.put("customers/"+A.customer_id,{...m.value}).then(p=>{l("select-new-customer",p.data),l("update:customerModal",!1),U.success(p.message),h.value={}}).catch(p=>{var f;p.status_code=="422"?(U.validationErrors(p),h.value=p.data):U.error((f=p.data)==null?void 0:f.message)}).finally(()=>{d.value=!1})},E=K(()=>A.customerModalInfos.action==="create"?v("Create as wordpress user"):v("Update wordpress user profile")),B=K(()=>d.value?A.customerModalInfos.action==="edit"?v("Updating"):v("Creating"):A.customerModalInfos.action==="edit"?v("Update Customer"):v("Create Customer")),S=K(()=>{const p={};for(const f in h.value){const u=h.value[f];p[f]=Array.isArray(u)?u:Object.values(u)}return p});return ae(()=>A.customer,p=>{m.value={id:p.id,email:p.email,full_name:p.full_name,first_name:p.first_name,last_name:p.last_name,state:p.state,city:p.city,country:p.country,postcode:p.postcode,country_name:p.country_name,contact_id:p.contact_id,user_id:p.user_id,wp_user:p.wp_user}},{deep:!0}),_e(()=>{m.value={id:A.customer.id,email:A.customer.email,full_name:A.customer.full_name,first_name:A.customer.first_name,last_name:A.customer.last_name,state:A.customer.state,city:A.customer.city,country:A.customer.country,postcode:A.customer.postcode,country_name:A.customer.country_name,contact_id:A.customer.contact_id,user_id:A.customer.user_id,wp_user:A.customer.wp_user}}),(p,f)=>{const u=L("el-checkbox"),k=L("el-button"),T=L("el-dialog");return n(),N(T,{modelValue:s.customerModalInfos.showModal,"onUpdate:modelValue":f[8]||(f[8]=w=>s.customerModalInfos.showModal=w),title:s.customerModalInfos.title,onClose:f[9]||(f[9]=()=>{h.value={}})},{default:i(()=>[a("div",st,[a("div",lt,[y(M).is_full_name_required?(n(),N(H,{key:0,label:y(v)("Full Name *"),modelValue:m.value.full_name,"onUpdate:modelValue":f[0]||(f[0]=w=>m.value.full_name=w),class:z(h.value.full_name?"is-error":"")},null,8,["label","modelValue","class"])):(n(),c(j,{key:1},[o(H,{label:y(v)("First Name *"),modelValue:m.value.first_name,"onUpdate:modelValue":f[1]||(f[1]=w=>m.value.first_name=w),class:z(h.value.first_name?"is-error":"")},null,8,["label","modelValue","class"]),o(H,{label:y(v)("Last Name"),modelValue:m.value.last_name,"onUpdate:modelValue":f[2]||(f[2]=w=>m.value.last_name=w),class:z(h.value.last_name?"is-error":"")},null,8,["label","modelValue","class"])],64)),o(H,{type:"email",label:y(v)("Email *"),modelValue:m.value.email,"onUpdate:modelValue":f[3]||(f[3]=w=>m.value.email=w),disabled:s.customer.user_id&&s.customer.user_id!=0,class:z(h.value.email?"is-error":"")},null,8,["label","modelValue","disabled","class"])]),a("h4",at,r(y(v)("Address")),1),a("div",ot,[o(he,{modelValue:m.value,"onUpdate:modelValue":f[4]||(f[4]=w=>m.value=w),validationErrors:h.value},null,8,["modelValue","validationErrors"]),s.customerModalInfos.action==="create"?(n(),c("div",dt,[o(u,{"true-value":"yes","false-value":"no",modelValue:s.customerModalInfos.manageWpUser,"onUpdate:modelValue":f[5]||(f[5]=w=>s.customerModalInfos.manageWpUser=w)},{default:i(()=>[o(Pe,{title:E.value,content:y(v)("We will create a new user for this customer. If a user with the same email already exists, we will associate the customer with that existing user.")},null,8,["title","content"])]),_:1},8,["modelValue"])])):g("",!0),Object.keys(h.value).length?(n(),c("div",nt,[(n(!0),c(j,null,q(S.value,(w,b)=>(n(),c("p",{key:b},[(n(!0),c(j,null,q(w,G=>(n(),c("span",{key:G},r(G),1))),128))]))),128))])):g("",!0)]),a("div",rt,[o(k,{onClick:P},{default:i(()=>[$(r(y(v)("Cancel")),1)]),_:1}),s.customerModalInfos.action==="edit"?(n(),N(k,{key:0,loading:d.value,type:"primary",onClick:f[6]||(f[6]=w=>O())},{default:i(()=>[$(r(B.value),1)]),_:1},8,["loading"])):(n(),N(k,{key:1,type:"primary",loading:d.value,onClick:f[7]||(f[7]=w=>I())},{default:i(()=>[$(r(B.value),1)]),_:1},8,["loading"]))])])]),_:1},8,["modelValue","title"])}}};class ut{constructor(){me(this,"allPermissions",[]);this.allPermissions=Ne.get(window,"fluentCartAdminApp.app_config.permissions",[])}isSuperAdmin(){return this.allPermissions.includes("is_super_admin")}has(e){return this.isSuperAdmin()?!0:this.allPermissions.includes(e)}hasAny(e){return this.isSuperAdmin()?!0:Array.isArray(e)&&e.some(l=>this.allPermissions.includes(l))}hasAll(e){return this.isSuperAdmin()?!0:Array.isArray(e)&&e.every(l=>this.allPermissions.includes(l))}resolve({permission:e,permissionType:l}){const A=l==="all"?"all":"any",m=Array.isArray(e)?e:typeof e=="string"?e.split(",").map(d=>d.trim()):[];return A==="all"?this.hasAll(m):this.hasAny(m)}}const ct=new ut,De={__name:"UserCan",props:{permission:{type:[String,Array],required:!0},permissionType:{type:String,default:"any"}},setup(s){const e=s,l=K(()=>ct.resolve({permission:e.permission,permissionType:e.permissionType}));return(A,m)=>l.value?qe(A.$slots,"default",{key:0}):g("",!0)}},mt={name:"OrderUpDownIndicator",props:{order:{type:Object,required:!0}},data(){var s,e;return{upgradeToId:((s=this.order.config)==null?void 0:s.upgraded_to)||null,upgradeFromId:((e=this.order.config)==null?void 0:e.upgraded_from)||null}}},pt={key:0,class:"ml-2"};function _t(s,e,l,A,m,d){const h=L("el-icon"),M=L("el-button"),P=L("router-link"),I=L("el-tooltip");return m.upgradeFromId||m.upgradeToId?(n(),c("span",pt,[m.upgradeFromId?(n(),N(I,{key:0,trigger:"click"},{content:i(()=>[$(r(s.$t("This order has been upgraded from"))+" ",1),o(P,{to:{name:"view_order",params:{order_id:m.upgradeFromId}}},{default:i(()=>[a("strong",null,"#"+r(m.upgradeFromId),1)]),_:1},8,["to"])]),default:i(()=>[o(M,{text:""},{default:i(()=>[o(h,null,{default:i(()=>e[0]||(e[0]=[a("svg",{viewBox:"0 0 24 24",width:"24",height:"24",color:"currentColor",fill:"none"},[a("defs"),a("path",{fill:"currentColor",d:"M11.943,1.75 L12.057,1.75 C14.248,1.75 15.969,1.75 17.312,1.931 C18.689,2.116 19.781,2.503 20.639,3.361 C21.497,4.219 21.884,5.311 22.069,6.688 C22.25,8.031 22.25,9.752 22.25,11.943 L22.25,12.057 C22.25,14.248 22.25,15.969 22.069,17.312 C21.884,18.689 21.497,19.781 20.639,20.639 C19.781,21.497 18.689,21.884 17.312,22.069 C15.969,22.25 14.248,22.25 12.057,22.25 L11.943,22.25 C9.752,22.25 8.031,22.25 6.688,22.069 C5.311,21.884 4.219,21.497 3.361,20.639 C2.503,19.781 2.116,18.689 1.931,17.312 C1.75,15.969 1.75,14.248 1.75,12.057 L1.75,11.943 C1.75,9.752 1.75,8.031 1.931,6.688 C2.116,5.311 2.503,4.219 3.361,3.361 C4.219,2.503 5.311,2.116 6.688,1.931 C8.031,1.75 9.752,1.75 11.943,1.75 L11.943,1.75 Z M4.422,4.422 C3.889,4.955 3.58,5.678 3.417,6.888 C3.252,8.12 3.25,9.74 3.25,12 C3.25,14.26 3.252,15.88 3.417,17.112 C3.58,18.322 3.889,19.045 4.422,19.578 C4.955,20.111 5.678,20.42 6.888,20.583 C8.12,20.748 9.74,20.75 12,20.75 C14.26,20.75 15.88,20.748 17.112,20.583 C18.322,20.42 19.045,20.111 19.578,19.578 C20.111,19.045 20.42,18.322 20.583,17.112 C20.748,15.88 20.75,14.26 20.75,12 C20.75,9.74 20.748,8.12 20.583,6.888 C20.42,5.678 20.111,4.955 19.578,4.422 C19.045,3.889 18.322,3.58 17.112,3.417 C15.88,3.252 14.26,3.25 12,3.25 C9.74,3.25 8.12,3.252 6.888,3.417 C5.678,3.58 4.955,3.889 4.422,4.422 Z M10.038,11.023 C9.749,11.32 9.274,11.326 8.977,11.038 C8.68,10.749 8.673,10.274 8.962,9.977 C9.051,9.886 9.197,9.704 9.41,9.433 L9.457,9.373 C9.647,9.131 9.87,8.847 10.099,8.576 C10.346,8.285 10.621,7.983 10.897,7.749 C11.035,7.631 11.19,7.515 11.358,7.425 C11.519,7.339 11.742,7.25 12,7.25 C12.258,7.25 12.481,7.339 12.642,7.425 C12.81,7.515 12.965,7.631 13.103,7.749 C13.379,7.983 13.654,8.285 13.901,8.576 C14.13,8.847 14.353,9.131 14.543,9.373 L14.543,9.373 L14.59,9.433 C14.804,9.704 14.949,9.886 15.038,9.977 C15.326,10.274 15.32,10.749 15.023,11.038 C14.726,11.326 14.251,11.32 13.962,11.023 C13.805,10.861 13.603,10.604 13.411,10.359 L13.366,10.302 C13.173,10.057 12.967,9.794 12.756,9.545 L12.75,9.538 L12.75,16 C12.75,16.414 12.414,16.75 12,16.75 C11.586,16.75 11.25,16.414 11.25,16 L11.25,9.538 L11.244,9.545 C11.033,9.794 10.827,10.057 10.634,10.302 L10.634,10.302 L10.589,10.359 C10.397,10.604 10.195,10.861 10.038,11.023 Z"})],-1)])),_:1,__:[0]})]),_:1})]),_:1})):g("",!0),m.upgradeToId?(n(),N(I,{key:1,trigger:"click"},{content:i(()=>[$(r(s.$t("This order has been upgraded to"))+" ",1),o(P,{to:{name:"view_order",params:{order_id:m.upgradeToId}}},{default:i(()=>[a("strong",null,"#"+r(m.upgradeToId),1)]),_:1},8,["to"])]),default:i(()=>[o(M,{text:""},{default:i(()=>[o(h,null,{default:i(()=>e[1]||(e[1]=[a("svg",{viewBox:"0 0 24 24",width:"24",height:"24",color:"currentColor",fill:"none"},[a("defs"),a("path",{fill:"currentColor",d:"M3.367,20.63 C1.756,19.02 1.756,16.672 1.756,11.995 L1.756,11.995 C1.756,7.317 1.756,4.97 3.367,3.359 C4.976,1.75 7.324,1.75 12.002,1.75 C16.68,1.75 19.026,1.75 20.637,3.359 C22.247,4.97 22.247,7.318 22.247,11.996 C22.247,16.674 22.247,19.022 20.637,20.631 C19.026,22.242 16.678,22.242 12,22.242 L12.003,22.241 C7.326,22.241 4.976,22.241 3.367,20.63 Z M4.427,4.418 C3.256,5.59 3.256,7.73 3.256,11.994 L3.256,11.995 C3.256,16.259 3.256,18.399 4.427,19.569 C5.597,20.741 7.738,20.741 12.003,20.741 C16.269,20.741 18.408,20.741 19.58,19.569 C20.75,18.399 20.75,16.259 20.75,11.993 L20.75,11.993 C20.75,7.727 20.75,5.588 19.58,4.417 C18.408,3.247 16.268,3.247 12.005,3.247 L12.003,3.248 C7.739,3.248 5.599,3.248 4.427,4.418 Z M12.024,8.951 C12.121,9.047 12.306,9.198 12.578,9.415 L12.654,9.476 L12.654,9.476 C12.894,9.667 13.172,9.888 13.437,10.117 C13.727,10.367 14.029,10.648 14.262,10.932 C14.432,11.139 14.661,11.456 14.726,11.834 C14.729,11.85 14.732,11.866 14.734,11.883 C14.741,11.94 14.745,11.999 14.745,12.059 C14.744,12.083 14.743,12.106 14.74,12.13 C14.693,12.568 14.41,12.933 14.199,13.168 C13.96,13.435 13.661,13.696 13.375,13.93 C13.152,14.112 12.918,14.292 12.71,14.452 C12.651,14.497 12.594,14.541 12.541,14.582 C12.277,14.786 12.109,14.923 12.027,15.007 C11.739,15.305 11.264,15.312 10.967,15.024 C10.669,14.735 10.662,14.26 10.95,13.963 C11.121,13.787 11.382,13.582 11.623,13.396 C11.684,13.349 11.745,13.302 11.807,13.254 C12.012,13.097 12.222,12.935 12.427,12.768 L12.483,12.722 L6.995,12.715 C6.581,12.715 6.246,12.379 6.246,11.964 C6.247,11.55 6.583,11.215 6.997,11.215 L12.422,11.222 C12.191,11.024 11.949,10.832 11.718,10.648 L11.718,10.648 L11.643,10.588 C11.396,10.391 11.134,10.181 10.965,10.012 C10.672,9.72 10.671,9.245 10.964,8.952 C11.257,8.659 11.731,8.658 12.024,8.951 Z M17.754,8.001 L17.745,15.993 C17.744,16.407 17.408,16.743 16.994,16.742 C16.58,16.742 16.244,16.405 16.245,15.991 L16.254,7.999 C16.255,7.585 16.591,7.25 17.005,7.25 C17.419,7.25 17.755,7.587 17.754,8.001 Z"})],-1)])),_:1,__:[1]})]),_:1})]),_:1})):g("",!0)])):g("",!0)}const aa=fe(mt,[["render",_t]]),ue=class ue{static emptyImage(e=!1){return ue.assetUrl()+(e?"images/empty-image-dark.svg":"images/empty-image.svg")}};me(ue,"assetUrl",()=>Xe.url());let pe=ue;const ft={components:{DynamicIcon:F},props:{product:{type:Object},hideProductId:{type:Boolean,default:!1},hideViewIcon:{type:Boolean,default:!1},hideImage:{type:Boolean,default:!1}},data(){return{}},methods:{translate:v,translateNumber:ie,getImage(s,e=!1){return Ne.get(s,"featured_media.url")??pe.emptyImage(e)}}},vt={class:"fct-product-info-card w-full"},ht={key:0,class:"fct-product-info-media"},gt=["src","alt"],yt=["src","alt"],bt={class:"fct-product-info-details"},Ct={class:"fct-product-info-name"},At={class:"product-name"},wt={class:"product-name-inner"},kt=["href"],$t={key:0,class:"product-id"},Mt={key:1,class:"product-sub-name"};function Lt(s,e,l,A,m,d){var M,P,I,O,E,B,S,p,f;const h=L("DynamicIcon");return n(),c("div",vt,[l.hideImage?g("",!0):(n(),c("div",ht,[a("span",null,[a("img",{class:"block dark:hidden",src:d.getImage((M=l.product)==null?void 0:M.detail),alt:(P=l.product)==null?void 0:P.post_title},null,8,gt),a("img",{class:"hidden dark:block",src:d.getImage((I=l.product)==null?void 0:I.detail,!0),alt:(O=l.product)==null?void 0:O.post_title},null,8,yt)])])),a("div",bt,[a("div",Ct,[a("span",At,[a("span",wt,r(((E=l.product)==null?void 0:E.post_title)||d.translate("No Name")),1),l.hideViewIcon?g("",!0):(n(),c("a",{key:0,class:"view-link right-1",target:"_blank",href:(B=l.product)==null?void 0:B.view_url,onClick:e[0]||(e[0]=xe(()=>{},["stop"]))},[o(h,{class:"w-5 h-5",name:"Eye"})],8,kt))]),l.hideProductId?g("",!0):(n(),c("span",$t," #"+r(d.translateNumber((S=l.product)==null?void 0:S.ID)),1)),(p=l.product)!=null&&p.variation_title?(n(),c("span",Mt," – "+r((f=l.product)==null?void 0:f.variation_title),1)):g("",!0)])])])}const It=fe(ft,[["render",Lt]]),Vt={name:"LicenseTable",components:{ProductInfo:It,UserCan:De,RouteCell:Je,DynamicIcon:F,IconButton:ve,CopyToClipboard:re,Empty:Qe,Badge:Ze},props:{licenses:{type:Array,required:!0},columns:{type:Array,default(){return["product","order_id","customer","date"]}}},computed:{Clipboard(){return Ge},formattedLicense(){return this.licenses.map(s=>{var e;return{...s,product:{...s.product,variation_title:((e=s.product_variant)==null?void 0:e.variation_title)||"n/a"}}})}},methods:{translate:v,formatDate:Ye,translateNumber:ie,getProductName(s){var e,l;return(e=s==null?void 0:s.product)!=null&&e.post_title?(l=s==null?void 0:s.product)==null?void 0:l.post_title:"n/a"},getProductVariationName(s){var e,l;return(e=s==null?void 0:s.product_variant)!=null&&e.variation_title?(l=s==null?void 0:s.product_variant)==null?void 0:l.variation_title:"n/a"}}},Et={class:"fct_licenses_table hide-on-mobile"},xt={class:"fct-license-key-wrap flex flex-col"},St={class:"fct-license-key max-w-full pr-1"},Tt={class:"fct-license-key-inner pr-2"},Ut={key:0},Ot={key:1},Nt={class:"fct_licenses_table_mobile"},Pt={class:"fct-table-mobile-wrap"},Bt=["onClick"],Dt={class:"fct-table-mobile-header-left"},jt={class:"fct-table-status-col"},Ft={class:"fct-table-activations-col"},Rt={class:"fct-table-mobile-body"},Wt=["onClick"],qt={class:"fct-license-key-wrap has-bg"},Ht={class:"fct-license-key"},zt={class:"fct-license-key-inner pr-2"};function Kt(s,e,l,A,m,d){const h=L("Badge"),M=L("router-link"),P=L("DynamicIcon"),I=L("el-tooltip"),O=L("el-table-column"),E=L("ProductInfo"),B=L("RouteCell"),S=L("Empty"),p=L("el-table"),f=L("UserCan");return n(),N(f,{permission:"licenses/view"},{default:i(()=>[a("div",Et,[o(p,{data:d.formattedLicense,class:"w-full compact-table"},{empty:i(()=>[o(S,{icon:"Empty/ListView","has-dark":!0,text:d.translate("No Licenses found based on your filter")},null,8,["text"])]),default:i(()=>[o(O,{label:d.translate("License Key"),width:200},{default:i(u=>{var k;return[a("div",xt,[a("span",null,[(n(),N(h,{status:u.row.status,key:u.row.id},null,8,["status"]))]),a("span",St,[a("span",Tt,[o(M,{class:"link",to:{name:"view_license",params:{license_id:(k=u.row)==null?void 0:k.id}}},{default:i(()=>[$(r(u.row.license_key),1)]),_:2},1032,["to"])]),o(I,{content:u.row.license_key,placement:"top","popper-class":"fct-tooltip"},{default:i(()=>[o(P,{class:"cursor-pointer p-1 w-6 h-6 flex-none",name:"Copy",onClick:()=>{d.Clipboard.copy(u.row.license_key,{successMessage:d.translate("License Key copied to clipboard"),errorMessage:d.translate("Failed to copy License Key")})}},null,8,["onClick"])]),_:2},1032,["content"])])])]}),_:1},8,["label"]),l.columns.indexOf("product")!==-1?(n(),N(O,{key:0,width:200,label:d.translate("Product")},{default:i(u=>{var k;return[o(B,{class:"link block hover:no-underline",to:{name:"view_license",params:{license_id:(k=u.row)==null?void 0:k.id}}},{default:i(()=>[o(E,{product:u.row.product,hideProductId:!0,hideViewIcon:!0,hideImage:!0},null,8,["product"])]),_:2},1032,["to"])]}),_:1},8,["label"])):g("",!0),l.columns.indexOf("order_id")!==-1?(n(),N(O,{key:1,width:80,label:d.translate("Order ID")},{default:i(u=>[o(B,{class:"link order_id block hover:no-underline relative w-full",to:{name:"view_order",params:{order_id:u.row.order_id}}},{default:i(()=>[o(M,{class:"link absolute left-1/2 top-1/2 translate-x-[calc(-50%-16px)] translate-y-[-50%]",to:{name:"view_order",params:{order_id:u.row.order_id}}},{default:i(()=>[$(" #"+r(u.row.order_id),1)]),_:2},1032,["to"])]),_:2},1032,["to"])]),_:1},8,["label"])):g("",!0),l.columns.indexOf("customer")!==-1?(n(),N(O,{key:2,width:100,label:d.translate("Customer")},{default:i(u=>[o(M,{class:"link",to:{name:"view_customer",params:{customer_id:u.row.customer_id}}},{default:i(()=>{var k,T;return[$(r(((T=(k=u.row)==null?void 0:k.customer)==null?void 0:T.full_name)||d.translate("No Name")),1)]}),_:2},1032,["to"])]),_:1},8,["label"])):g("",!0),o(O,{width:90,label:d.translate("Activations")},{default:i(u=>{var k;return[o(B,{class:"link block hover:no-underline relative w-full",to:{name:"view_license",params:{license_id:(k=u.row)==null?void 0:k.id}}},{default:i(()=>[$(r(d.translateNumber(u.row.activation_count))+" / "+r(u.row.limit==0?"Unlimited":u.row.limit),1)]),_:2},1032,["to"])]}),_:1},8,["label"]),l.columns.indexOf("date")!==-1?(n(),N(O,{key:3,width:140,label:d.translate("Date")},{default:i(u=>{var k;return[o(B,{class:"block hover:no-underline w-full",to:{name:"view_license",params:{license_id:(k=u.row)==null?void 0:k.id}}},{default:i(()=>[a("div",null,[a("span",null,r(d.formatDate(u.row.created_at)),1),e[0]||(e[0]=a("span",{class:"text-gray-300 px-2"},"–",-1)),u.row.expiration_date?(n(),c("span",Ut,r(d.formatDate(u.row.expiration_date)),1)):(n(),c("span",Ot,r(d.translate("Lifetime")),1))])]),_:2},1032,["to"])]}),_:1},8,["label"])):g("",!0)]),_:1},8,["data"])]),a("div",Nt,[a("div",Pt,[(n(!0),c(j,null,q(d.formattedLicense,(u,k)=>(n(),c("div",{key:k,class:"fct-table-mobile-row"},[a("div",{class:"fct-table-mobile-header",onClick:T=>s.$router.push({name:"view_license",params:{license_id:u==null?void 0:u.id}})},[a("div",Dt,[a("div",jt,[(n(),N(h,{status:u.status,key:u.id},null,8,["status"]))]),a("div",Ft,r(u.activation_count)+" / "+r(u.limit==0?"Unlimited":u.limit),1)])],8,Bt),a("div",Rt,[a("div",{class:"fct-table-product-col",onClick:T=>s.$router.push({name:"view_license",params:{license_id:u==null?void 0:u.id}})},[o(E,{product:u.product,hideProductId:!0,hideViewIcon:!0,hideImage:!0},null,8,["product"])],8,Wt),a("div",qt,[a("div",Ht,[a("div",zt,[o(M,{class:"link",to:{name:"view_license",params:{license_id:u==null?void 0:u.id}}},{default:i(()=>[$(r(u.license_key),1)]),_:2},1032,["to"])]),o(P,{class:"cursor-pointer p-1 w-6 h-6",name:"Copy",onClick:()=>{d.Clipboard.copy(u.license_key,{successMessage:d.translate("License Key copied to clipboard"),errorMessage:d.translate("Failed to copy License Key")})}},null,8,["onClick"])])])])]))),128))])])]),_:1})}const oa=fe(Vt,[["render",Kt]]),Zt={class:"fct_edit_customer_popup"},Qt={class:"form-error-wrap"},Yt=["innerHTML"],Gt={class:"dialog-footer"},je=Object.assign({name:"AddOrEditAddressModal"},{__name:"AddOrEditAddressModal",props:["customer_id","modalAction","address","showAddressModal","order_id","customerAddressModalInfos","showSetAsAlsoCheckbox","closing_modal"],emits:["close-modal","update:refresh-address"],setup(s,{emit:e}){const l=s,A=e;x([]);const m=x(!1),d=x({}),h=x(!1),M=x(!1),P=x(!1);x(null);const I=x({...l.address??{}}),O=Se().ctx;et().onSave(()=>{l.showAddressModal&&["billing","shipping"].includes(l.modalAction.type)&&(l.modalAction.action==="edit"&&O.address.id!==""?p():l.modalAction.action==="create"&&S())});const B=f=>{let u="";for(const k in f){const T=f[k],w=Object.values(T);u+=w+" </br>"}return u},S=()=>{h.value=!0;const f=I.value;let u={type:l.modalAction.type,customer_id:l.customer_id,order_id:l.order_id??null},k={...f,...u};k.sync=P.value,Z.post("customers/"+l.customer_id+"/address",{...k}).then(T=>{A("update:refresh-address",!1,T.data),U.success(T.message),d.value={}}).catch(T=>{var w;T.status_code=="422"?(U.validationErrors(T),d.value=T.data):U.error((w=T.data)==null?void 0:w.message)}).finally(()=>{m.value=!1,h.value=!1})},p=()=>{M.value=!0,l.address;let u={...{type:l.modalAction.type,customer_id:l.customer_id,is_primary:l.address.is_primary,id:l.address.id,order_id:l.order_id&&l.address.is_primary==1?l.order_id:null},...I.value};Z.put("customers/"+l.customer_id+"/address",{...u}).then(k=>{P.value,A("update:refresh-address",!1,k.data),U.success(k.message),d.value={}}).catch(k=>{var T;k.status_code=="422"?(U.validationErrors(k),d.value=k):U.error((T=k.data)==null?void 0:T.message)}).finally(()=>{m.value=!1,M.value=!1})};return ae(()=>l.closing_modal,(f,u)=>{f&&(d.value={})}),(f,u)=>{const k=L("el-form"),T=L("el-checkbox"),w=L("el-button");return n(),c("div",Zt,[o(k,{"label-position":"top",class:"fct-compact-form","require-asterisk-position":"right"},{default:i(()=>[o(H,{label:y(v)("Address Label"),class:z(d.value.hasOwnProperty("label")?"is-error":""),modelValue:I.value.label,"onUpdate:modelValue":u[0]||(u[0]=b=>I.value.label=b)},null,8,["label","class","modelValue"]),o(H,{label:y(v)("Name"),required:"",class:z(d.value.hasOwnProperty("name")?"is-error":""),modelValue:I.value.name,"onUpdate:modelValue":u[1]||(u[1]=b=>I.value.name=b)},null,8,["label","class","modelValue"]),o(H,{label:y(v)("Email"),required:"",class:z(d.value.hasOwnProperty("email")?"is-error":""),modelValue:I.value.email,"onUpdate:modelValue":u[2]||(u[2]=b=>I.value.email=b)},null,8,["label","class","modelValue"]),o(H,{label:y(v)("Company Name"),required:"",class:z(d.value.hasOwnProperty("company_name")?"is-error":""),modelValue:I.value.company_name,"onUpdate:modelValue":u[3]||(u[3]=b=>I.value.company_name=b)},null,8,["label","class","modelValue"]),o(H,{label:y(v)("Phone"),required:"",class:z(d.value.hasOwnProperty("phone")?"is-error":""),modelValue:I.value.phone,"onUpdate:modelValue":u[4]||(u[4]=b=>I.value.phone=b)},null,8,["label","class","modelValue"]),o(he,{use_additional_address_fields:"",modelValue:I.value,"onUpdate:modelValue":u[5]||(u[5]=b=>I.value=b),validationErrors:d.value},null,8,["modelValue","validationErrors"])]),_:1}),a("div",Qt,[a("p",{class:"form-error-text",innerHTML:B(d.value)},null,8,Yt)]),a("div",Gt,[(s.showSetAsAlsoCheckbox,g("",!0)),s.address.id?(n(),N(w,{key:1,type:"primary",onClick:u[7]||(u[7]=b=>p()),loading:M.value,disabled:M.value},{default:i(()=>[$(r(y(v)("Update Address")),1)]),_:1},8,["loading","disabled"])):(n(),N(w,{key:2,type:"primary",onClick:u[8]||(u[8]=b=>S()),loading:h.value,disabled:h.value},{default:i(()=>[$(r(y(v)("Add Address")),1)]),_:1},8,["loading","disabled"]))])])}}}),Jt={class:"fct-manage-address-modal"},Xt={key:1,class:"fct-manage-address-wrap"},es=["onClick"],ts={class:"fct-address-action absolute top-0 right-0 pt-2"},ss={class:"more-btn"},ls={key:0,class:"empty-text"},as={key:2,class:"edit_address"},os={key:3,class:"dialog-footer"},ds={name:"ManageAddressModal",props:["showAddressModal","customer_id","modalAction","order_id"],expose:["editAddress"],data(){return{manageAddress:[],address:{},loading:!0,isEditAddress:!1,selectedAddressIndex:null}},computed:{showModal:{get(){return this.showAddressModal},set(s){this.$emit("update:showAddressModal",s)}}},methods:{handleAddressCommand(s){s.action==="edit"?this.editAddress(s.data):s.action==="use"?this.$emit("onAddressSelected",s.data):s.action==="set-as-also"?this.setAsAlso(s.data):s.action==="default"?this.setAddressPrimary(s.data):s.action==="remove"&&this.$confirm("Are you sure you want to delete this address?","Warning",{confirmButtonText:this.$t("Yes, Delete!"),cancelButtonText:this.$t("Cancel"),cancelButtonClass:"el-button--small",confirmButtonClass:"el-button--small",type:"warning"}).then(()=>{this.removeAddress(s.data)}).catch(()=>{})},emitAddNewAddress(s,e=[]){this.$emit("addNewAddress",s,"create",e)},emitAddressSelected(){this.showModal=!1,this.$emit("onAddressSelected",this.manageAddress[this.selectedAddressIndex])},editAddress(s){this.address=s,this.isEditAddress=!0},removeAddress(s){let e=s.id;this.$del("customers/"+this.customer_id+"/address",{address:s}).then(l=>{this.getAddresses(),this.$emit("refresh-address"),this.handleSuccess(l.message),e===this.selectedAddressIndex&&(this.selectedAddressIndex=null)}).catch(l=>{var A;l.status_code=="422"?U.validationErrors(l):U.error((A=l.data)==null?void 0:A.message)}).finally(()=>{this.loading=!1})},setAddressPrimary(s){this.$post("customers/"+this.customer_id+"/address/make-primary",{addressId:s.id,type:s.type}).then(e=>{this.$emit("refresh-address"),this.getAddresses(),this.handleSuccess(e.message)}).catch(e=>{var l;e.status_code=="422"?U.validationErrors(e):U.error((l=e.data)==null?void 0:l.message)}).finally(()=>{this.loading=!1})},getTitle(){return this.modalAction.type==="billing"?this.$t("Manage billing address"):this.$t("Manage shipping address")},fetchAddresses(){this.getAddresses(this.modalAction.type)},getAddresses(s="billing"){this.loading=!0,this.selectedOrders=[],this.$get("customers/"+this.customer_id+"/address",{type:this.modalAction.type}).then(e=>{this.manageAddress=e.addresses}).catch(e=>{this.handleError(e)}).finally(()=>{this.loading=!1})},updateAddress(){this.fetchAddresses(),this.$emit("refresh-address")},setAsAlso(s){const e=this.modalAction.type==="billing"?"shipping":"billing",l={...s,type:e,customer_id:this.customer_id,is_primary:0};delete l.id,delete l.created_at,delete l.updated_at,this.emitAddNewAddress(e,l)}}},ns=Object.assign(ds,{setup(s){return(e,l)=>{const A=L("el-skeleton"),m=L("el-tag"),d=L("el-dropdown-item"),h=L("el-dropdown-menu"),M=L("el-dropdown"),P=L("el-icon"),I=L("el-button"),O=L("el-dialog");return n(),c("div",Jt,[o(O,{modelValue:e.showModal,"onUpdate:modelValue":l[5]||(l[5]=E=>e.showModal=E),onClose:l[6]||(l[6]=()=>{e.selectedAddressIndex=null,e.isEditAddress=!1}),onOpen:e.fetchAddresses,title:e.getTitle(),"append-to-body":!0,"modal-class":"fct-manage-order-address-modal"},{default:i(()=>[e.loading?(n(),N(A,{key:0,animated:"",rows:4})):g("",!0),!e.loading&&!e.isEditAddress?(n(),c("div",Xt,[(n(!0),c(j,null,q(e.manageAddress,(E,B)=>(n(),c("div",{class:"fct-manage-address-block-wrap",key:E.id},[a("div",{class:z(`cursor-pointer fct-manage-address-block ${E.is_primary==="1"?"default-address":""}  ${B===e.selectedAddressIndex?"selected":""} `),onClick:()=>{e.selectedAddressIndex=B}},[E.is_primary==="1"?(n(),N(m,{key:0,type:"info",round:""},{default:i(()=>[$(r(e.$t("Default")),1)]),_:1})):g("",!0),a("p",null,[a("strong",null,r(E.name),1),$(" "+r(e.getOrderAddress(E,"",!0)),1)])],10,es),a("div",ts,[o(M,{trigger:"click",class:"fct-more-option-wrap","popper-class":"fct-dropdown",onCommand:e.handleAddressCommand},{dropdown:i(()=>[o(h,null,{default:i(()=>[o(d,{command:{action:"edit",data:E}},{default:i(()=>[$(r(e.$t("Edit")),1)]),_:2},1032,["command"]),o(d,{command:{action:"use",data:E}},{default:i(()=>[$(r(e.$t("Use this address")),1)]),_:2},1032,["command"]),o(d,{command:{action:"set-as-also",data:E}},{default:i(()=>[$(r(s.modalAction.type==="billing"?e.$t("Copy to Shipping"):e.$t("Copy to Billing")),1)]),_:2},1032,["command"]),E.is_primary!=="1"?(n(),c(j,{key:0},[o(d,{command:{action:"default",data:E}},{default:i(()=>[$(r(e.$t("Set as default")),1)]),_:2},1032,["command"]),o(d,{command:{action:"remove",data:E},class:"item-destructive"},{default:i(()=>[$(r(e.$t("Delete")),1)]),_:2},1032,["command"])],64)):g("",!0)]),_:2},1024)]),default:i(()=>[a("span",ss,[o(F,{name:"More"})])]),_:2},1032,["onCommand"])])]))),128)),e.manageAddress.length==0?(n(),c("div",ls,r(s.modalAction.type==="billing"?e.$t("No billing address found."):e.$t("No shipping address found.")),1)):g("",!0)])):g("",!0),e.isEditAddress?(n(),c("div",as,[o(I,{text:"",onClick:l[0]||(l[0]=()=>e.isEditAddress=!1),style:{"margin-bottom":"16px"}},{default:i(()=>[o(P,null,{default:i(()=>[o(y(Be))]),_:1}),$(" "+r(e.$t("Manage address")),1)]),_:1}),o(je,{"onUpdate:refreshAddress":l[1]||(l[1]=E=>{e.isEditAddress=E,e.updateAddress()}),customer_id:s.customer_id,modalAction:s.modalAction,address:e.address,showAddressModal:e.isEditAddress,order_id:s.order_id,onCloseModal:l[2]||(l[2]=E=>e.showModal=!1)},null,8,["customer_id","modalAction","address","showAddressModal","order_id"])])):g("",!0),e.isEditAddress?g("",!0):(n(),c("div",os,[e.selectedAddressIndex!=null?(n(),N(I,{key:0,onClick:l[3]||(l[3]=E=>e.emitAddressSelected())},{default:i(()=>[o(F,{name:"LocationPin"}),$(" "+r(e.$t("Use this address")),1)]),_:1})):g("",!0),o(I,{onClick:l[4]||(l[4]=E=>e.emitAddNewAddress(s.modalAction.type)),type:"primary"},{default:i(()=>[o(F,{name:"Plus"}),$(" "+r(e.$t("Add new address")),1)]),_:1})]))]),_:1},8,["modelValue","onOpen","title"])])}}}),rs={class:"fct-term-container"},is={class:"fct-term-input-wrap"},us={key:0,class:"fct-term-search-result-button-wrap mb-1.5"},cs={class:"search-text"},ms={key:1,class:"fct-term-search-result-list is-scrollable"},ps=["value","checked","onChange"],_s={key:2,class:"empty-text"},fs={key:0,class:"fct-term-selected-list"},vs={class:"fct-term-selected"},hs={class:"text"},gs={class:"fct-term-list-header"},ys={class:"fct-term-input-inline-wrap"},bs={key:0,class:"fct-term-list-header-button-wrap"},Cs={class:"search-text"},As={class:"fct-term-list-wrap is-scrollable"},ws={key:0,class:"fct-term-list newly-added-list"},ks={class:"title"},$s={class:"fct-term-label"},Ms=["value","checked","onChange"],Ls={key:1,class:"fct-term-list to-add-list"},Is={class:"title"},Vs={class:"fct-term-label"},Es=["value","checked","onChange"],xs={key:2,class:"fct-term-list available-list"},Ss={class:"title"},Ts={class:"fct-term-label"},Us=["value","checked","onChange"],Os={key:3,class:"empty-text"},Ns={class:"dialog-footer"},Fe={__name:"Modal",props:{bindToType:{type:String},bindToId:{type:[String,Number]},selected_labels:{type:Array,default:[]},labelModalIsOpen:{type:Boolean,default:!1},shouldEnableEditing:{type:Boolean,default:!0}},emits:["update:update-label","close-label-modal"],setup(s,{emit:e}){const l=Se().ctx,A=s,m=e,d=x([]),h=x([]),M=x([]),P=x(),I=x(""),O=x([]),E=x([]),B=x(!1),S=x(!1),p=x(A.labelModalIsOpen),f=x("");ae(()=>A.labelModalIsOpen,t=>{p.value=t,t&&(M.value=[...d.value])});const u=t=>{t.stopPropagation(),t.preventDefault(),T()},k=()=>{l.$get("labels").then(t=>{O.value=t.labels,d.value=A.selected_labels}).catch(t=>{var C;t.status_code=="422"?U.validationErrors(t):U.error((C=t.data)==null?void 0:C.message)}).finally(()=>{})},T=(t="")=>{const C=I.value||f.value;l.$post("labels",{value:C,bind_to_type:A.bindToType,bind_to_id:A.bindToId}).then(D=>{I.value="",f.value="",O.value.push(D.data),t!=="insideModal"?d.value.push(D.data.id):h.value.push(D.data.id),m("update:update-label",d.value)}).catch(D=>{U.error(D)})};ae(I,t=>{t?(t=t.trim(),E.value=O.value.filter(C=>C.value.toLowerCase().includes(t.toLowerCase())),B.value=!0):(E.value=[],B.value=!1)});const w=t=>{const C=d.value.indexOf(t);C===-1?d.value.push(t):d.value.splice(C,1),m("update:update-label",d.value)},b=t=>{const C=M.value.indexOf(t);C===-1?M.value.push(t):M.value.splice(C,1)},G=t=>{const C=h.value.indexOf(t);C===-1?h.value.push(t):h.value.splice(C,1)},ce=()=>{d.value=[...M.value,...h.value],h.value=[],m("update:update-label",d.value),te()},oe=t=>{const C=d.value.indexOf(t);C!==-1&&(d.value.splice(C,1),m("update:update-label",d.value))},de=t=>{B.value&&!P.value.$el.contains(t.target)&&!S.value.contains(t.target)&&(B.value=!1,I.value="")},ne=K(()=>O.value.filter(t=>d.value.includes(t.id))),ee=K(()=>O.value.filter(t=>h.value.includes(t.id))),J=K(()=>O.value.filter(t=>M.value.includes(t.id)).filter(t=>t.value.toLowerCase().includes(f.value.trim().toLowerCase()))),X=K(()=>O.value.filter(t=>!M.value.includes(t.id)).filter(t=>!h.value.includes(t.id)).filter(t=>t.value.toLowerCase().includes(f.value.trim().toLowerCase())).sort((t,C)=>t.value.localeCompare(C.value))),te=()=>{m("close-label-modal")},_=K(()=>{const t=f.value.trim().toLowerCase(),C=I.value.trim().toLowerCase();return(t||C)===""||E.value.some(D=>D.value.toLowerCase()===t||D.value.toLowerCase()===C)||J.value.some(D=>D.value.toLowerCase()===t||D.value.toLowerCase()===C)||X.value.some(D=>D.value.toLowerCase()===t||D.value.toLowerCase()===C)});return _e(()=>{k(),document.addEventListener("click",de)}),He(()=>{document.removeEventListener("click",de)}),(t,C)=>{const D=L("el-input"),Q=L("el-button"),Y=L("el-dialog");return n(),c("div",rs,[a("div",is,[s.shouldEnableEditing?(n(),N(D,{key:0,ref_key:"inputRef",ref:P,modelValue:I.value,"onUpdate:modelValue":C[0]||(C[0]=V=>I.value=V),onKeydown:ze(u,["enter"])},null,8,["modelValue"])):g("",!0),B.value?(n(),c("div",{key:1,class:"fct-term-search-result",ref_key:"suggestionsRef",ref:S,style:Ke(I.value==""?"display: none":"")},[I.value!==""&&!_.value?(n(),c("div",us,[o(Q,{type:"info",plain:"",onClick:T,size:"small"},{default:i(()=>[o(F,{name:"PlusCircle"}),$(" "+r(t.$t("Add"))+" ",1),a("span",cs,'"'+r(I.value)+'"',1)]),_:1})])):g("",!0),E.value.length>0?(n(),c("ul",ms,[(n(!0),c(j,null,q(E.value,(V,W)=>(n(),c("li",{key:W},[a("label",null,[a("input",{type:"checkbox",value:V.id,checked:d.value.includes(V.id),onChange:se=>w(V.id)},null,40,ps),$(" "+r(V.value),1)])]))),128))])):g("",!0),E.value.length===0?(n(),c("p",_s,r(t.$t("No labels found.")),1)):g("",!0)],4)):g("",!0)]),ne.value.length>0?(n(),c("ul",fs,[(n(!0),c(j,null,q(ne.value,V=>(n(),c("li",{key:V.id},[a("div",vs,[a("div",hs,r(V.value),1),s.shouldEnableEditing?(n(),N(F,{key:0,name:"Cross",onClick:W=>oe(V.id)},null,8,["onClick"])):g("",!0)])]))),128))])):g("",!0),o(Y,{"before-close":te,"append-to-body":!0,width:"45%",modelValue:p.value,"onUpdate:modelValue":C[3]||(C[3]=V=>p.value=V),title:t.$t("Add labels"),class:"fct-add-labels-modal"},{default:i(()=>[a("div",gs,[a("div",ys,[o(D,{modelValue:f.value,"onUpdate:modelValue":C[1]||(C[1]=V=>f.value=V),placeholder:t.$t("Search to find or create labels")},{prefix:i(()=>[o(F,{name:"Search"})]),_:1},8,["modelValue","placeholder"])]),f.value!==""&&!_.value?(n(),c("div",bs,[o(Q,{type:"info",plain:"",onClick:C[2]||(C[2]=V=>T("insideModal")),size:"small"},{default:i(()=>[o(F,{name:"PlusCircle"}),$(" "+r(t.$t("Add"))+" ",1),a("span",Cs,'"'+r(f.value)+'"',1)]),_:1})])):g("",!0)]),a("div",As,[ee.value.length>0?(n(),c("ul",ws,[a("li",ks,r(t.$t("Newly added")),1),(n(!0),c(j,null,q(ee.value,V=>(n(),c("li",{key:V.id},[a("label",$s,[a("input",{type:"checkbox",value:V.id,checked:h.value.includes(V.id),onChange:W=>G(V.id)},null,40,Ms),$(" "+r(V.value),1)])]))),128))])):g("",!0),J.value.length>0?(n(),c("ul",Ls,[a("li",Is,r(t.$t("To add")),1),(n(!0),c(j,null,q(J.value,V=>(n(),c("li",{key:V.id},[a("label",Vs,[a("input",{type:"checkbox",value:V.id,checked:M.value.includes(V.id),onChange:W=>b(V.id)},null,40,Es),$(" "+r(V.value),1)])]))),128))])):g("",!0),X.value.length>0?(n(),c("ul",xs,[a("li",Ss,r(t.$t("Available")),1),(n(!0),c(j,null,q(X.value,V=>(n(),c("li",{key:V.id},[a("label",Ts,[a("input",{type:"checkbox",value:V.id,checked:M.value.includes(V.id),onChange:W=>b(V.id)},null,40,Us),$(" "+r(V.value),1)])]))),128))])):g("",!0),J.value.length===0&&X.value.length===0&&ee.value.length===0?(n(),c("p",Os,r(t.$t("No labels found.")),1)):g("",!0)]),a("div",Ns,[o(Q,{onClick:te},{default:i(()=>[$(r(t.$t("Cancel")),1)]),_:1}),o(Q,{type:"primary",onClick:ce},{default:i(()=>[$(r(t.$t("Done")),1)]),_:1})])]),_:1},8,["modelValue","title"])])}}},Ps={class:"fct-admin-sidebar-item"},Bs={name:"Labels",props:{bindToType:{type:String},bindToId:{type:[String,Number]},selectedLabels:{type:Array,default:()=>[]},shouldEnableEditing:{type:Boolean,default:!0}},components:{IconButton:ve,LabelModal:Fe,DynamicIcon:F},data(){return{labelModalIsOpen:!1}},methods:{openLabelModal(){this.labelModalIsOpen=!0},updateLabel(s){this.bindToId&&this.bindToType&&this.$post("labels/update-label-selections",{bind_to_type:this.bindToType,bind_to_id:this.bindToId,selectedLabels:s}).then(e=>{U.success(e.message)}).catch(e=>{U.error(e.message)}),this.$emit("update:update-label",s)},closeLabel(){this.labelModalIsOpen=!1}},mounted(){}},da=Object.assign(Bs,{setup(s){return(e,l)=>(n(),N(De,{permission:"labels/manage"},{default:i(()=>[a("div",null,[o(Oe,null,{default:i(()=>[o(Te,{title:e.$t("Labels"),border_bottom:"",title_size:"small"},{action:i(()=>[s.shouldEnableEditing?(n(),N(ve,{key:0,size:"x-small",bg:"transparent",tag:"button",border:"transparent",onClick:e.openLabelModal},{default:i(()=>[o(F,{name:"Edit"})]),_:1},8,["onClick"])):g("",!0)]),_:1},8,["title"]),o(Ue,null,{default:i(()=>[a("div",Ps,[o(Fe,{bindToType:s.bindToType,bindToId:s.bindToId,labelModalIsOpen:e.labelModalIsOpen,selected_labels:s.selectedLabels,shouldEnableEditing:s.shouldEnableEditing,"onUpdate:updateLabel":e.updateLabel,onCloseLabelModal:l[0]||(l[0]=A=>e.labelModalIsOpen=!1)},null,8,["bindToType","bindToId","labelModalIsOpen","selected_labels","shouldEnableEditing","onUpdate:updateLabel"])])]),_:1})]),_:1})])]),_:1}))}}),Ds={class:"fct-customer-edit-modal"},js={key:1,class:"fct-form-group"},Fs={class:"label"},Rs={style:{display:"flex","align-items":"center",gap:"10px"}},Ws={class:"select-use-option"},qs={class:"fct-compact-form"},Hs={class:"form-heading"},zs={class:"fct-compact-form fct-customer-address-section"},Ks={style:{"margin-top":"20px"}},Zs={class:"form-error-wrap"},Qs={class:"form-error-text"},Ys={class:"dialog-footer"},Gs={key:3,class:"dialog-footer"},Js={__name:"ChangeOrderCustomer",props:{orderId:{type:[String,Number],default:null,required:!0}},setup(s){const e=s,l=x(null),A=x([]),m=x(!1),d=x(!1),h=x({}),M=x({id:"",email:"",full_name:"",state:"",city:"",country:"",postcode:"",country_name:"",contact_id:"",user_id:"",wp_user:""}),P=S=>{if(!S){A.value=[];return}Z.get("customers/",{search:S}).then(p=>{A.value=p.customers.data}).finally(()=>{})},I=()=>{if(!l.value){U.error(v("Please select a customer"));return}Z.post("orders/"+e.orderId+"/change-customer",{customer_id:l.value}).then(S=>{U.success(S.message),setTimeout(()=>{window.location.reload()},300)}).catch(S=>{if(S.message)return U.error(S.message);console.log("errors",S)}).finally(()=>{console.log("finally")})},O=()=>{Z.post("orders/"+e.orderId+"/create-and-change-customer",M.value).then(S=>{U.success(S.message),setTimeout(()=>{window.location.reload()},300),h.value={},d.value=!1}).catch(S=>{if(S.message)return U.error(S.message);h.value=S}).finally(()=>{})},E=()=>{d.value=!0},B=()=>{d.value=!1};return(S,p)=>{const f=L("el-button"),u=L("el-option"),k=L("el-select"),T=L("el-checkbox");return n(),c("div",Ds,[d.value?(n(),c("div",{key:0,onClick:B,style:{"margin-bottom":"10px"}},[o(f,{text:"",style:{"margin-top":"0"}},{default:i(()=>[o(F,{name:"ArrowLeft"}),$(" "+r(y(v)("Back")),1)]),_:1})])):g("",!0),d.value?g("",!0):(n(),c("div",js,[a("label",Fs,[$(r(y(v)("Select Customer"))+" ",1),o(f,{text:"",class:"fct-create-customer-btn",onClick:xe(E,["prevent"])},{default:i(()=>[o(F,{name:"Plus"}),$(" "+r(y(v)("Add New Customer")),1)]),_:1})]),a("div",Rs,[o(k,{modelValue:l.value,"onUpdate:modelValue":p[0]||(p[0]=w=>l.value=w),remote:!0,"remote-method":P,loading:m.value,filterable:"",clearable:"",placeholder:y(v)("Type to search user"),style:{width:"100%"}},{default:i(()=>[(n(!0),c(j,null,q(A.value,w=>(n(),N(u,{key:w.id,label:w.full_name,value:w.id},{default:i(()=>[a("div",Ws,[a("span",null,r(w.full_name),1),a("span",null,r(w.email),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading","placeholder"])])])),d.value?(n(),c(j,{key:2},[a("div",qs,[o(H,{label:y(v)("Full Name"),modelValue:M.value.full_name,"onUpdate:modelValue":p[1]||(p[1]=w=>M.value.full_name=w)},null,8,["label","modelValue"]),o(H,{label:y(v)("Email"),modelValue:M.value.email,"onUpdate:modelValue":p[2]||(p[2]=w=>M.value.email=w)},null,8,["label","modelValue"])]),a("h4",Hs,r(y(v)("Address")),1),a("div",zs,[o(he,{modelValue:M.value,"onUpdate:modelValue":p[3]||(p[3]=w=>M.value=w)},null,8,["modelValue"]),a("div",Ks,[o(T,{"true-value":"yes","false-value":"no",modelValue:M.value.wp_user,"onUpdate:modelValue":p[4]||(p[4]=w=>M.value.wp_user=w)},{default:i(()=>[o(Pe,{title:y(v)("Create as wordpress user"),content:y(v)("We will create a new user for this customer. If a user with the same email already exists, we will associate the customer with that existing user.")},null,8,["title","content"])]),_:1},8,["modelValue"])]),a("div",Zs,[(n(!0),c(j,null,q(h.value,w=>(n(),c("p",Qs,r(w.required),1))),256))])]),a("div",Ys,[o(f,{onClick:p[5]||(p[5]=w=>S.$emit("close"))},{default:i(()=>[$(r(y(v)("Cancel")),1)]),_:1}),o(f,{type:"primary",onClick:O},{default:i(()=>[$(r(y(v)("Create & Attach Customer")),1)]),_:1})])],64)):g("",!0),d.value?g("",!0):(n(),c("div",Gs,[o(f,{type:"primary",onClick:I},{default:i(()=>[$(r(y(v)("Create & Attach Customer")),1)]),_:1})]))])}}},Xs={class:"fct-admin-sidebar"},el={class:"more-btn"},tl={key:0,class:"fct-admin-sidebar-item"},sl={class:"name"},ll={class:"email"},al={class:"fct-admin-sidebar-item"},ol={class:"fct-profile-card"},dl=["src","alt"],nl={key:0,class:"fct-profile-details"},rl={class:"title"},il={class:"text"},ul={key:0},cl={class:"text"},ml={key:0,class:"user-info mt-2"},pl=["href"],_l={class:"fct-admin-sidebar-item mt-5"},fl={class:"fct-contact-info-list"},vl={class:"flex items-center justify-between gap-2"},hl=["href"],gl={class:"fct-admin-sidebar-item mt-5"},yl={class:"sidebar-title"},bl={key:0,class:"fct-address-copy-wrap"},Cl={class:"text"},Al={key:0,class:"pr-1"},wl=["innerHTML"],kl={key:1,class:"mt-3"},$l={class:"pr-1"},Ml=["href"],Ll={key:1,class:"no-address-text"},Il={class:"fct-admin-sidebar-item mt-5"},Vl={class:"sidebar-title"},El={key:0,class:"fct-address-copy-wrap"},xl={class:"text"},Sl={key:0},Tl=["innerHTML"],Ul={key:1,class:"mt-3"},Ol={class:"pr-1"},Nl=["href"],Pl={key:2,class:"mt-3"},Bl={class:"pr-1"},Dl={key:1,class:"no-address-text"},jl={class:"fluent-cart-admin-pages"},na={__name:"OrderCustomerInformation",props:{order:{type:Object,default:()=>({})},shouldEnableEditing:{type:Boolean,default:!0}},emits:["onAddressSelected","onAddressRemove"],setup(s,{emit:e}){var ee,J,X,te;const l=s,A=x([]),m=x((J=(ee=l.order)==null?void 0:ee.customer)!=null&&J.id?l.order.customer:null),d=x((X=l.order)!=null&&X.billing_address?l.order.billing_address:null),h=x((te=l.order)!=null&&te.shipping_address?l.order.shipping_address:null),M=e,P=x(!1),I=_=>{_==="remove_customer"&&O(),_==="change_customer"?P.value=!0:_==="edit_customer"?T("edit"):_==="manage_billing_address"?G("billing"):_==="manage_shipping_address"&&G("shipping")},O=()=>{l.order.customer_id="",l.order.customer={},m.value=null,d.value=null,h.value=null,M("onAddressRemove"),setTimeout(()=>{oe()},50)},E=(_,t)=>{Z.get("customers/",{search:_,with:["shipping_address","billing_address"]}).then(C=>{let D=C.customers.data;A.value=D;let Q=D.map(se=>({id:se.id,value:se.full_name,email:se.email})),Y=jQuery(".fct-customer-autocomplete-dropdown"),V=jQuery(".el-autocomplete-suggestion__list"),W="empty-text";D.length<1?Y.length>0&&(Y.addClass("is-empty-customer"),V.children(`.${W}`).length||V.prepend(`<li class="${W}">No customer found.</li>`)):Y.length>0&&(Y.removeClass("is-empty-customer"),V.children(`.${W}`).remove()),t(Q)}).catch(C=>{U.error(C)})},B=_=>{const t=A.value.find(C=>C.id===_.id)??null;S(t)},S=_=>{m.value=_,l.order.customer=_,l.order.customer_id=_.id,m.value!==null&&(p(),f())},p=()=>{const _=m.value.billing_address;_&&(Array.isArray(_)&&_.length>0?(d.value=_[0],d.value=_.find(t=>t.is_primary.toString()==="1")??d.value):d.value=null,M("onAddressSelected",d.value))},f=()=>{const _=m.value.shipping_address;_&&(Array.isArray(_)&&_.length>0?(h.value=_[0],h.value=_.find(t=>t.is_primary.toString()==="1")??h.value):h.value=null,M("onAddressSelected",h.value))},u=_=>{_&&Z.post(`orders/${l.order.id}/update-address-id`,{address_id:_.id,address_type:_.type}).then(t=>{U.success(t.message),_.type==="shipping"?h.value=_:d.value=_,b.value.showModal=!1,M("onAddressSelected",_)}).catch(t=>{U.error(t)})},k=x({showModal:!1,action:"create",title:v("Create New Customer"),customer:{},manageWpUser:"yes"}),T=(_="create")=>{const t=k.value;t.showModal=!0,t.action=_==="create"?"create":"edit",t.title=_==="create"?v("Create New Customer"):v("Edit Customer Information"),t.customer_id=_==="create"?null:m.value.id,t.customer=_==="create"?{}:m.value,t.manageWpUser=_==="create"?"yes":m.value.user_id==="0"?"no":"yes",k.value=t},w=x(!0),b=x({showManageAddressModal:!1,showModal:!1,modalAction:{type:"billing",action:"create"},title:"",customer_id:"",address_id:"",address:{},address_mock:{name:"",phone:"",email:"",address_1:"",address_2:"",city:"",state:"",postcode:"",country:"",is_primary:"0"}}),G=(_="billing",t="edit")=>{b.value.showManageAddressModal=!0,b.value.modalAction.type=_,b.value.modalAction.action=t},ce=(_="billing",t="create",C={})=>{Object.keys(C).length>0?(b.value.address={...C},w.value=!1):b.value.address={...b.value.address_mock},b.value.showModal=!0,b.value.modalAction.type=_,b.value.modalAction.action=t,b.value.showManageAddressModal=!1},oe=()=>{let _=jQuery(".el-autocomplete-suggestion__wrap");if(_.length>0){let t=jQuery('<div class="fct-create-customer-button-wrap"><button class="el-button el-button--info el-button--small is-plain"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M1.5 7H12.5M7 1.5V12.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg> Create a new customer</button></div>').on("click",()=>{T()});_.prepend(t)}},de=()=>b.value.modalAction.action==="create"?b.value.modalAction.type==="billing"?v("Add new billing address"):v("Add new shipping Address"):b.value.modalAction.type==="billing"?v("Edit billing address"):v("Edit shipping address"),ne=(_,t)=>{b.value.modalAction.type==="billing"?d.value=t:h.value=t,b.value.showModal=_,b.value.showManageAddressModal=!0,u(t)};return ae(l.order,(_,t)=>{_.customer_id!==t.customer_id&&O()}),_e(()=>{oe()}),(_,t)=>{var ye;const C=L("el-dropdown-item"),D=L("el-dropdown-menu"),Q=L("el-dropdown"),Y=L("el-autocomplete"),V=L("router-link"),W=L("el-icon"),se=L("el-button"),ge=L("el-dialog");return n(),c(j,null,[a("div",Xs,[o(Oe,null,{default:i(()=>[o(Te,{title:y(v)("Customer Information"),title_size:"small",border_bottom:""},{action:i(()=>[m.value&&s.shouldEnableEditing?(n(),N(Q,{key:0,trigger:"click",class:"fct-more-option-wrap","popper-class":"fct-dropdown",onCommand:I},{dropdown:i(()=>[o(D,null,{default:i(()=>[o(C,{command:"edit_customer"},{default:i(()=>[$(r(y(v)("Edit customer information")),1)]),_:1}),o(C,{command:"manage_shipping_address"},{default:i(()=>[$(r(y(v)("Manage shipping address")),1)]),_:1}),o(C,{command:"manage_billing_address"},{default:i(()=>[$(r(y(v)("Manage billing address")),1)]),_:1}),s.order.id?(n(),N(C,{key:0,command:"change_customer"},{default:i(()=>[$(r(y(v)("Change customer")),1)]),_:1})):g("",!0),s.order.id?g("",!0):(n(),N(C,{key:1,command:"remove_customer"},{default:i(()=>[$(r(y(v)("Remove customer")),1)]),_:1}))]),_:1})]),default:i(()=>[a("span",el,[o(F,{name:"More"})])]),_:1})):g("",!0)]),_:1},8,["title"]),o(Ue,null,{default:i(()=>{var R,be,Ce,Ae,we,ke,$e,Me,Le,Ie,Ve,Ee;return[m.value===null?(n(),c("div",tl,[o(Y,{"popper-class":"fct-customer-autocomplete-dropdown",clearable:"",modelValue:s.order.customer.full_name,"onUpdate:modelValue":t[0]||(t[0]=le=>s.order.customer.full_name=le),"fetch-suggestions":E,placeholder:y(v)("Search or create a customer"),disabled:!1,onSelect:B},{prefix:i(()=>[o(F,{name:"Search"})]),default:i(le=>[a("span",sl,r(le.item.value),1),a("span",ll,r(le.item.email),1)]),_:1},8,["modelValue","placeholder"])])):(n(),c(j,{key:1},[a("div",al,[a("div",ol,[a("div",{class:"fct-profile-image cursor-pointer",onClick:t[1]||(t[1]=le=>_.$router.push({name:"view_customer",params:{customer_id:m.value.id}}))},[a("img",{src:m.value.photo,alt:(R=m.value)==null?void 0:R.full_name},null,8,dl)]),m.value.id?(n(),c("div",nl,[a("div",rl,[o(V,{to:{name:"view_customer",params:{customer_id:m.value.id}}},{default:i(()=>[$(r(m.value.full_name),1)]),_:1},8,["to"])]),a("span",il,[m.value.purchase_count>0?(n(),c("span",ul,r(y(ie)(m.value.purchase_count)),1)):g("",!0),$(" "+r(_.$n("Order","Orders",m.value.purchase_count??0,"No Order")),1)]),a("span",cl,r(y(tt)((be=m.value)==null?void 0:be.ltv,!0))+" "+r(y(v)("Lifetime Value")),1)])):g("",!0)]),s.order.customer.user_link?(n(),c("div",ml,[$(r(y(v)("WP User:"))+" ",1),a("a",{href:s.order.customer.user_link,target:"_blank",class:"inline-flex items-center gap-1 dark:text-gray-100 text-primary-500 focus:shadow-none hover:!underline"},[$(" #"+r(y(ie)(s.order.customer.user_id))+" ",1),o(F,{name:"Redirect",class:"w-2.5 h-2.5 text-primary-500 dark:text-gray-200"})],8,pl)])):g("",!0)]),a("div",_l,[a("ul",fl,[a("li",null,[a("div",vl,[a("a",{class:"text",href:"mailto:"+((Ce=s.order.customer)==null?void 0:Ce.email)},r(m.value.email),9,hl),o(re,{text:m.value.email,showMode:"basic_copy_btn",tooltipText:y(v)("Copy email")},null,8,["text","tooltipText"])])])])]),a("div",gl,[a("h4",yl,r(y(v)("Shipping Address")),1),h.value!=null?(n(),c("div",bl,[a("span",Cl,[h.value.name?(n(),c("strong",Al,r(h.value.name),1)):g("",!0),a("span",{class:"break-all",innerHTML:_.getOrderAddress({...h.value},"shipping",!0)},null,8,wl),(ke=(we=(Ae=h.value)==null?void 0:Ae.meta)==null?void 0:we.other_data)!=null&&ke.phone?(n(),c("span",kl,[a("strong",$l,r(y(v)("Phone"))+":",1),a("a",{href:"tel:"+h.value.meta.other_data.phone,class:"text-system-mid dark:text-gray-50 hover:underline"},r(h.value.meta.other_data.phone),9,Ml)])):g("",!0)]),o(re,{text:_.getOrderAddress({...h.value},"shipping"),showMode:"basic_copy_btn",tooltipText:y(v)("Copy address")},null,8,["text","tooltipText"])])):(n(),c("p",Ll,r(y(v)("No shipping address provided")),1))]),a("div",Il,[a("h4",Vl,r(y(v)("Billing Address")),1),d.value!=null?(n(),c("div",El,[a("div",xl,[d.value.name?(n(),c("strong",Sl,r(d.value.name),1)):g("",!0),a("span",{class:"break-all",innerHTML:_.getOrderAddress({...d.value},"billing",!0)},null,8,Tl),(Le=(Me=($e=d.value)==null?void 0:$e.meta)==null?void 0:Me.other_data)!=null&&Le.phone?(n(),c("span",Ul,[a("strong",Ol,r(y(v)("Phone"))+":",1),a("a",{href:"tel:"+d.value.meta.other_data.phone,class:"text-system-mid dark:text-gray-50 hover:underline"},r(d.value.meta.other_data.phone),9,Nl)])):g("",!0),(Ee=(Ve=(Ie=d.value)==null?void 0:Ie.meta)==null?void 0:Ve.other_data)!=null&&Ee.company_name?(n(),c("span",Pl,[a("strong",Bl,r(y(v)("Company"))+":",1),a("span",null,r(d.value.meta.other_data.company_name),1)])):g("",!0)]),o(re,{text:_.getOrderAddress({...d.value},"billing"),showMode:"basic_copy_btn",tooltipText:y(v)("Copy address")},null,8,["text","tooltipText"])])):(n(),c("p",Dl,r(y(v)("No shipping address provided")),1))])],64))]}),_:1})]),_:1})]),o(it,{onSelectNewCustomer:t[2]||(t[2]=R=>{S(R),k.value.showModal=!1}),customerModalInfos:k.value,customer_id:k.value.customer_id,customer:k.value.customer,onCloseModal:t[3]||(t[3]=R=>k.value.showModal=!1)},null,8,["customerModalInfos","customer_id","customer"]),o(ns,{modalAction:b.value.modalAction,onOnAddressSelected:u,"onUpdate:showAddressModal":t[4]||(t[4]=R=>b.value.showManageAddressModal=R),showAddressModal:b.value.showManageAddressModal,customer_id:(ye=m.value)==null?void 0:ye.id,order_id:s.order.id,onAddNewAddress:ce},null,8,["modalAction","showAddressModal","customer_id","order_id"]),o(ge,{"show-close":!0,modelValue:b.value.showModal,"onUpdate:modelValue":t[7]||(t[7]=R=>b.value.showModal=R),"append-to-body":!0,title:de()},{default:i(()=>{var R;return[a("div",jl,[o(se,{text:"",onClick:t[5]||(t[5]=()=>{b.value.showManageAddressModal=!0,b.value.showModal=!1}),class:"mb-4"},{default:i(()=>[o(W,null,{default:i(()=>[o(y(Be))]),_:1}),$(" "+r(_.$t("Manage address")),1)]),_:1}),o(je,{"onUpdate:refreshAddress":ne,customerAddressModalInfos:b.value,customer_id:m.value.id,modalAction:b.value.modalAction,address:b.value.address,showAddressModal:b.value.showModal,showSetAsAlsoCheckbox:w.value,order_id:(R=s.order)==null?void 0:R.id,onCloseModal:t[6]||(t[6]=()=>{b.value.showModal=!1,b.value.showManageAddressModal=!0})},null,8,["customerAddressModalInfos","customer_id","modalAction","address","showAddressModal","showSetAsAlsoCheckbox","order_id"])])]}),_:1},8,["modelValue","title"]),s.order.id?(n(),N(ge,{key:0,modelValue:P.value,"onUpdate:modelValue":t[9]||(t[9]=R=>P.value=R),title:_.$t("Change Customer")},{default:i(()=>[o(Js,{"order-id":s.order.id,onClose:t[8]||(t[8]=R=>P.value=!1)},null,8,["order-id"])]),_:1},8,["modelValue","title"])):g("",!0)],64)}}};export{oa as L,aa as O,It as P,De as _,it as a,je as b,ns as c,da as d,na as e,Js as f,ct as p};
