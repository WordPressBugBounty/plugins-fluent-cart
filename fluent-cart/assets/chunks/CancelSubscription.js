import{i as V,j as ae,c as r,t as s,u as a,o as t,d as n,w as o,f as e,e as g,g as T,F as L,a as b,b as $,n as K,W as ie,X as ce,h as B,C as te,m as G}from"./vue.esm-bundler.js?ver=1.3.12";import{_ as W}from"./Empty.js?ver=1.3.12";import{B as j,I as de}from"./Badge.js?ver=1.3.12";import{t as i,a as Z,A as U}from"./Translator.js?ver=1.3.12";import{S as R}from"./Str.js?ver=1.3.12";import{U as se}from"./Url.js?ver=1.3.12";import{_ as P}from"./DynamicIcon.js?ver=1.3.12";import{_ as H}from"./RouteCell.js?ver=1.3.12";import{C as E}from"./productService.js?ver=1.3.12";import{O as oe}from"./OrderCustomerInformation.js?ver=1.3.12";import{R as ue}from"./Rest.js?ver=1.3.12";import{n as Y}from"./Notify.js?ver=1.3.12";import{L as _e}from"./NotFound.js?ver=1.3.12";import{j as me,a as ne}from"./index.js?ver=1.3.12";import{A as z}from"./Arr.js?ver=1.3.12";import{f as pe}from"./common.js?ver=1.3.12";import{B as fe}from"./BundleProducts.js?ver=1.3.12";import{_ as le}from"./_plugin-vue_export-helper.js?ver=1.3.12";import{d as ee}from"./Utils.js?ver=1.3.12";const he=["title"],Q={__name:"ConvertedTime",props:{dateTime:{type:[Object,String],required:!1},withTime:{type:Boolean,required:!1,default:!0},onlyTime:{type:Boolean,required:!1,default:!1}},setup(d){const v=d,p=V("MMM DD, YYYY");return ae(()=>{let k="MMM DD, YYYY";new Date(v.dateTime).getFullYear()===new Date().getFullYear()&&(k="MMM DD"),v.onlyTime?p.value="h:mm A":v.withTime?p.value=k+" h:mm A":p.value=k}),(k,O)=>(t(),r("span",{title:a(ee)(d.dateTime,"MMM DD, YYYY h:mm A")},s(a(ee)(d.dateTime,p.value)),9,he))}},ve={class:"fct-popover-box"},be={class:"fct-popover-content fct-customer-info-popover"},ye={class:"fct-customer-info-list"},ge={class:"title"},ke={class:"dot-separator"},we={class:"text"},$e={class:"text"},Ce={class:"fct-customer-card fct-popover-box-action"},xe={class:"fct-customer-name mr-4 truncate"},Te={class:"fct-popover-box-action-icon"},J={__name:"CustomerInfoPopover",props:{customer:{type:Object,required:!0},toRoute:{type:Object,required:!0}},setup(d){return(v,p)=>{const k=b("router-link"),O=b("el-button"),c=b("el-popover");return t(),r("div",ve,[n(c,{placement:"bottom-start",width:280,trigger:"click"},{reference:o(()=>{var y;return[e("div",Ce,[e("div",xe,s(((y=d.customer)==null?void 0:y.full_name)||a(i)("No Name")),1),e("div",Te,[n(P,{name:"ChevronDown"})])])]}),default:o(()=>{var y,C,w,M,h;return[e("div",be,[e("ul",ye,[e("li",null,[e("span",ge,s(((y=d.customer)==null?void 0:y.full_name)||a(i)("No Name")),1)]),e("li",null,[e("div",ke,[e("span",null,[d.customer.purchase_count>0?(t(),r(L,{key:0},[T(s(a(Z)(d.customer.purchase_count)),1)],64)):g("",!0),T(" "+s(v.$n("Order","Orders",d.customer.purchase_count??0,"No Order")),1)]),e("span",null,s(d.customer.country_name),1)])]),p[0]||(p[0]=e("li",null,[e("div",{class:"separator"})],-1)),e("li",null,[e("div",we,[n(k,{to:{name:"view_customer",params:{customer_id:(C=d.customer)==null?void 0:C.id}}},{default:o(()=>{var N;return[T(s((N=d.customer)==null?void 0:N.email),1)]}),_:1},8,["to"])])]),e("li",null,[e("div",$e,s((M=(w=d.customer)==null?void 0:w.primary_billing_address)==null?void 0:M.phone),1)])]),n(O,{size:"small",tag:"router-link",to:{name:"view_customer",params:{customer_id:(h=d.customer)==null?void 0:h.id}}},{default:o(()=>[T(s(v.$t("View Customer")),1)]),_:1},8,["to"])])]}),_:1}),n(H,{class:"hover:no-underline",to:d.toRoute},{default:o(()=>p[1]||(p[1]=[e("span",null," ",-1)])),_:1,__:[1]},8,["to"])])}}},Oe={class:"fct-bulk-delete-action-wrap p-4 pl-5 pt-0"},Me={class:"fct-bulk-delete-action-dialog-content space-y-4"},Se={key:0},Ie={class:"m-0 mb-2"},De={key:0,class:"text-sm text-gray-600 mb-3"},Le={key:1},Ne={class:"m-0 mb-3"},Pe={class:"max-h-60 overflow-x-hidden"},He={class:"font-mono text-sm"},Ve={class:"flex items-center justify-end gap-2"},Re={class:"text-xs"},qe={key:2,class:"!mt-2 p-3 bg-gray-50 dark:bg-primary-500 rounded"},Ae={class:"flex justify-between text-sm"},Be={class:"text-green-600"},je={class:"text-red-600"},Fe={key:3},Ee={class:"text-sm text-red-600"},Ue={class:"flex justify-end"},Ye={__name:"BulkDeleteAction",props:{selectedOrders:{type:Array,required:!0},onComplete:{type:Function,default:()=>{}}},setup(d){const v=d,p=V(!1),k=V(0);V(!1);const O=V(!1),c=V([]),y=V(""),C=()=>{c.value=[],k.value=0,y.value=""},w=(u=0)=>{if(!v.selectedOrders.length){C();return}if(u>v.selectedOrders.length-1){setTimeout(()=>{const S=c.value.filter(A=>A.status==="success").length,F=c.value.filter(A=>A.status==="error").length;S>0&&Y.success(`${S} orders deleted successfully`),F>0&&Y.error(`${F} orders failed to delete`),p.value=!1,y.value=""},500);return}const m=v.selectedOrders[u],_=m.id,I=m.invoice_no;y.value=I;const f=c.value.findIndex(S=>S.id===_);if(m.mode!=="test"&&m.status==="completed"){f!==-1&&(c.value[f].status="warning",c.value[f].error_message=`Cannot delete order ${I} due to status: completed`),k.value=Math.round((u+1)/v.selectedOrders.length*100),w(u+1);return}f!==-1&&(c.value[f].status="processing"),ue.delete("/orders/"+_,{ids:[_]}).then(S=>{f!==-1&&(c.value[f].status="success",c.value[f].invoice_no=S.data.invoice_no),k.value=Math.round((u+1)/v.selectedOrders.length*100),w(u+1)}).catch(S=>{console.log(`Error deleting order ${I} (ID: ${_}):`,S),f!==-1&&(c.value[f].status="error",c.value[f].error_message=S&&S.message||"Unknown error"),k.value=Math.round((u+1)/v.selectedOrders.length*100),w(u+1)})},M=()=>{v.selectedOrders.length&&(p.value=!0,O.value=!0,C(),c.value=v.selectedOrders.map(u=>({id:u.id,invoice_no:u.invoice_no,parent_id:u.parent_id,status:u.mode!=="test"&&u.status==="completed"?"warning":"pending",error_message:u.mode!=="test"&&u.status==="completed"?`${i("Cannot delete order %s due to status: completed",u.invoice_no)}`:""})),w(0))},h=u=>{switch(u){case"success":return"Check";case"error":return"Cross";case"processing":return"Loading";case"warning":return"Warning";default:return"Clock"}},N=u=>{switch(u){case"success":return"text-green-500";case"error":return"text-red-500";case"processing":return"text-blue-500";case"warning":return"text-warning-500";default:return"text-gray-400"}},D=u=>{switch(u){case"success":return i("Success");case"error":return i("Failed");case"processing":return i("Processing...");case"warning":return i("Undeletable");default:return i("Pending")}},q=()=>{O.value=!1,v.onComplete()};return(u,m)=>{const _=b("el-button"),I=b("el-popconfirm"),f=b("el-progress"),S=b("el-table-column"),F=b("el-icon"),A=b("el-table"),X=b("el-dialog");return t(),r("div",Oe,[n(I,{title:a(i)("Are you sure you want to delete these orders?"),onConfirm:M,width:"250"},{reference:o(()=>[n(_,{type:"danger",size:"small",loading:p.value,disabled:p.value||!d.selectedOrders.length,class:"flex items-center gap-2"},{default:o(()=>[p.value?(t(),r(L,{key:1},[T(s(a(i)("Deleting...")),1)],64)):(t(),r(L,{key:0},[n(P,{name:"Delete",class:"w-4 h-4"}),T(" "+s(a(i)("Delete Selected (%s)",d.selectedOrders.length)),1)],64))]),_:1},8,["loading","disabled"])]),_:1},8,["title"]),n(X,{modelValue:O.value,"onUpdate:modelValue":m[1]||(m[1]=l=>O.value=l),title:a(i)("Deleting Orders"),width:"800px","close-on-click-modal":!1,"show-close":!1,"close-on-press-escape":!1,"modal-class":"fct-bulk-delete-action-dialog"},{footer:o(()=>[e("div",Ue,[n(_,{onClick:m[0]||(m[0]=l=>q()),disabled:p.value,type:"primary"},{default:o(()=>[T(s(p.value?a(i)("Processing..."):a(i)("Done")),1)]),_:1},8,["disabled"])])]),default:o(()=>[e("div",Me,[p.value?(t(),r("div",Se,[e("p",Ie,s(a(i)("Please do not close or refresh this window. Please wait while we delete the selected orders...")),1),y.value?(t(),r("p",De,s(a(i)("Currently processing: %s",y.value)),1)):g("",!0)])):(t(),r("div",Le,[e("p",Ne,s(a(i)("Deletion completed")),1)])),n(f,{percentage:k.value,"stroke-width":6,striped:"","striped-flow":"",class:"mb-4 !mt-0",status:p.value?void 0:"success"},null,8,["percentage","status"]),e("div",Pe,[n(A,{data:c.value,class:"w-full",size:"small"},{default:o(()=>[n(S,{label:a(i)("Invoice No."),"min-width":"120"},{default:o(l=>[e("span",He,s(l.row.invoice_no||l.row.id),1)]),_:1},8,["label"]),n(S,{label:a(i)("Status"),width:"150",align:"right"},{default:o(l=>[e("div",Ve,[l.row.status!=="processing"?(t(),$(P,{key:0,name:h(l.row.status),class:K(["w-4 h-4 flex-none ",N(l.row.status)])},null,8,["name","class"])):(t(),$(F,{key:1,class:"is-loading text-blue-500"},{default:o(()=>[n(a(me))]),_:1})),e("span",Re,[l.row.status=="error"||l.row.status=="warning"?(t(),$(_e,{key:0,title:D(l.row.status),content:l.row.error_message},null,8,["title","content"])):(t(),r(L,{key:1},[T(s(D(l.row.status)),1)],64))])])]),_:1},8,["label"])]),_:1},8,["data"])]),!p.value&&c.value.length?(t(),r("div",qe,[e("div",Ae,[e("span",null,s(a(i)("Total"))+": "+s(c.value.length),1),e("span",Be,s(a(i)("Success"))+": "+s(c.value.filter(l=>l.status==="success").length),1),e("span",je,s(a(i)("Failed"))+": "+s(c.value.filter(l=>l.status==="error").length),1)])])):g("",!0),c.value.filter(l=>l.status==="warning").length?(t(),r("div",Fe,[e("p",Ee,s(a(i)("We have found some completed orders that are not deletable (%s)",c.value.filter(l=>l.status==="warning").length)),1)])):g("",!0)])]),_:1},8,["modelValue","title"])])}}},re={name:"CustomColumnRenderer",components:{Badge:j,DynamicIcon:P},props:{data:{type:Object,required:!0},templateContent:{type:String,required:!1,default:""}},data(){return{}},render(){if(this.templateContent){const d=`<div>${this.templateContent}</div>`,v=ie(d).bind(this);return ce(v,{data:this.data,app:this})}return null}},ze={class:"fct-orders-table-wrap"},We=["title"],Qe={key:1},Je={class:"fct-popover-box"},Xe={class:"fct-popover-content"},Ge={class:"fct-product-orders-items is-scroll"},Ke={key:0,class:"variation-title"},Ze={class:"variation-title"},et={key:0},tt={class:"fct-popover-box-action"},st={key:0,class:"block w-full truncate mr-4"},ot={key:1,class:"block w-full truncate mr-4"},nt={class:"fct-popover-box-action-icon"},lt=["innerHTML"],rt=["innerHTML"],at=["innerHTML"],it={class:"fct-status-group"},ct=["src","alt"],dt={key:0},ut={key:1},_t=["innerHTML"],mt=["innerHTML"],pt={class:"fct-btn-group sm justify-end"},ft={class:"table-cell"},Co={__name:"OrdersTable",props:{orders:{type:Array,required:!0},emptyText:{type:String,required:!1,default:i("No orders found.")},columns:{type:Array,required:!1,default(){return["selection","customer","actions","status","order_items"]}},table:Object},setup(d,{expose:v}){const p=d,k=V([]),O=U.get("site_url"),c=U.get("receipt_page_url"),y=m=>p.columns.includes(m),C=m=>U.get("payment_logos."+m),w=c||!1,M=m=>m?se.appendQueryParams(O,{"fluent-cart":"receipt",order_hash:m,download:1}):"",h=m=>m.filter(_=>_.payment_type!=="signup_fee"),N=m=>{k.value=m.map(_=>({id:_.id,parent_id:_.parent_id,invoice_no:_.invoice_no,status:_.status,mode:_.mode}))},D=()=>{p.table.fetch()},q=m=>{switch(m){case"payment":return i("Payment");case"subscription":return i("Subscription");case"renewal":return i("Renewal");default:R.headline(m)}},u=(p.orders??[]).map(m=>{var _;return{...m,order_items:(_=m==null?void 0:m.order_items)!=null&&_.length?pe(m.order_items):[]}});return v({selectedOrders:k}),(m,_)=>{const I=b("el-table-column"),f=b("router-link"),S=b("el-popover"),F=b("el-tag"),A=b("el-tooltip"),X=b("el-table");return t(),r("div",ze,[k.value.length?(t(),$(Ye,{key:0,"selected-orders":k.value,"on-complete":D},null,8,["selected-orders"])):g("",!0),n(X,{class:"w-full compact-table",data:a(u),"tooltip-options":{popperClass:"fct-tooltip-long"},onSelectionChange:N},{empty:o(()=>[n(W,{icon:"Empty/Order","has-dark":"",text:d.emptyText},null,8,["text"])]),default:o(()=>[d.table&&d.table.data.showDeleteBulkAction?(t(),$(I,{key:0,type:"selection",width:"45"})):g("",!0),n(I,{width:140,label:a(i)("Date")},{default:o(l=>[n(H,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:l.row.id}}},{default:o(()=>[e("div",null,[e("div",{title:a(i)("Order ID: %s",l.row.id),class:"text-xs text-system-mid dark:text-gray-300 mb-0.5"},s(l.row.invoice_no),9,We),n(Q,{"date-time":l.row.created_at,"with-time":!1},null,8,["date-time"])])]),_:2},1032,["to"])]),_:1},8,["label"]),y("customer")?(t(),$(I,{key:1,width:130,label:a(i)("Customer")},{default:o(l=>[l.row.customer?(t(),$(J,{key:0,customer:l.row.customer,"to-route":{name:"view_order",params:{order_id:l.row.id}}},null,8,["customer","to-route"])):(t(),r("span",Qe,s(a(i)("Customer Not Found")),1))]),_:1},8,["label"])):g("",!0),y("order_items")?(t(),$(I,{key:2,"min-width":200,label:a(i)("Items")},{default:o(l=>[e("div",Je,[n(S,{placement:"bottom-start",width:360,trigger:"click"},{reference:o(()=>{var x;return[e("div",tt,[h(l.row.order_items).length===1?(t(),r("span",st,s((x=h(l.row.order_items)[0])==null?void 0:x.post_title),1)):(t(),r("span",ot,s(a(Z)(h(l.row.order_items).length))+" "+s(m.$t("items")),1)),e("div",nt,[n(P,{name:"ChevronDown"})])])]}),default:o(()=>[e("div",Xe,[e("div",Ge,[(t(!0),r(L,null,B(h(l.row.order_items),x=>(t(),r("p",{key:x.id},[x!=null&&x.is_custom||(x==null?void 0:x.is_custom)==="true"?(t(),r("span",Ke,s(x.post_title),1)):(t(),$(f,{key:1,class:"title",to:{name:"product_edit",params:{product_id:x==null?void 0:x.post_id}}},{default:o(()=>[T(s(x.post_title),1)]),_:2},1032,["to"])),e("span",Ze,[e("b",null,s(x.quantity),1),T(" x "+s(x.title),1)]),x.bundle_items.length>0?(t(),$(fe,{key:2,product:x},null,8,["product"])):g("",!0)]))),128)),h(l.row.order_items).length===0?(t(),r("p",et,s(a(i)("No products found!")),1)):g("",!0)])])]),_:2},1024),n(H,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:l.row.id}}},{default:o(()=>_[0]||(_[0]=[e("span",null," ",-1)])),_:2,__:[0]},1032,["to"])])]),_:1},8,["label"])):g("",!0),n(I,{width:150,label:a(i)("Total")},{default:o(l=>[n(H,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:l.row.id}}},{default:o(()=>[parseInt(l.row.total_refund)?(t(),r(L,{key:1},[e("span",{class:"text-gray-700 line-through",innerHTML:a(E).formatNumber(l.row.total_amount,!0,!1,l.row.currency)},null,8,rt),l.row.payment_status!="refunded"?(t(),r("span",{key:0,style:{"margin-left":"5px"},innerHTML:a(E).formatNumber(parseInt(l.row.total_amount)-parseInt(l.row.total_refund),!0,!1,l.row.currency)},null,8,at)):g("",!0)],64)):(t(),r("span",{key:0,innerHTML:a(E).formatNumber(l.row.total_amount,!0,!1,l.row.currency)},null,8,lt))]),_:2},1032,["to"])]),_:1},8,["label"]),n(I,{width:150,label:a(i)("Payment Status")},{default:o(l=>[n(H,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:l.row.id}}},{default:o(()=>[e("div",it,[n(j,{status:l.row.payment_status,"hide-icon":!0},null,8,["status"]),C(l.row.payment_method)?(t(),r("span",{key:0,class:K(["img",l.row.payment_method])},[e("img",{src:C(l.row.payment_method),alt:a(R).headline(l.row.payment_method)},null,8,ct)],2)):(t(),$(F,{key:1,type:"info",round:"",size:"small",class:"capitalize"},{default:o(()=>[T(s(a(R).headline(l.row.payment_method)),1)]),_:2},1024))])]),_:2},1032,["to"])]),_:1},8,["label"]),y("status")?(t(),$(I,{key:3,width:120,label:a(i)("Status")},{default:o(l=>[n(H,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:l.row.id}}},{default:o(()=>[(t(),$(j,{status:l.row.status,"hide-icon":!0,key:l.row.id},null,8,["status"]))]),_:2},1032,["to"])]),_:1},8,["label"])):g("",!0),y("type")?(t(),$(I,{key:4,width:140,label:a(i)("Order Type")},{default:o(l=>[e("span",null,s(q(l.row.type)),1),n(oe,{order:l.row},null,8,["order"])]),_:1},8,["label"])):g("",!0),d.table?(t(!0),r(L,{key:5},B(d.table.getCustomColumns(),l=>(t(),$(I,{label:l.label},{default:o(x=>[l.render_template?(t(),r("div",dt,[(t(),$(te(re),{templateContent:l.template,data:{column:l,order:x.row,index:x.$index}},null,8,["templateContent","data"]))])):(t(),r("div",ut,[l.as_link!==!1?(t(),$(H,{key:0,class:"hover:no-underline",to:{name:"view_order",params:{order_id:x.row.id}}},{default:o(()=>[e("div",{innerHTML:a(z).get(x.row,l.accessor)},null,8,_t)]),_:2},1032,["to"])):(t(),r("div",{key:1,innerHTML:a(z).get(x.row,l.accessor)},null,8,mt))]))]),_:2},1032,["label"]))),256)):g("",!0),y("actions")&&a(w)?(t(),$(I,{key:6,width:"60",label:""},{default:o(l=>[e("div",pt,[e("div",ft,[n(A,{content:a(i)("View Invoice"),placement:"top","popper-class":"fct-tooltip"},{default:o(()=>[n(de,{target:"_blank",href:M(l.row.uuid),size:"small",tag:"a",bg:"ghost"},{default:o(()=>[n(P,{name:"Print"})]),_:2},1032,["href"])]),_:2},1032,["content"])])])]),_:1})):g("",!0)]),_:1},8,["data"])])}}},ht={class:"fct-orders-table-mobile-wrap"},vt={class:"fct-orders-table-mobile-header"},bt=["onClick"],yt=["title"],gt={class:"flex items-center gap-3"},kt=["onClick"],wt=["innerHTML"],$t=["innerHTML"],Ct=["innerHTML"],xt={key:0,class:"fct-order-table-actions-col"},Tt={class:"el-dropdown-link"},Ot=["href"],Mt={key:0,class:"fct-orders-table-mobile-body"},St={class:"fct-order-and-customer-info"},It={key:0,class:"fct-order-table-customer-col"},Dt={key:1},Lt={key:1,class:"fct-order-table-order-items-col"},Nt={class:"fct-popover-box"},Pt={class:"fct-popover-content"},Ht={class:"fct-product-orders-items is-scroll"},Vt=["href"],Rt={class:"variation-title"},qt={key:0},At={class:"fct-popover-box-action"},Bt={key:0,class:"fct-order-count-text"},jt={key:1,class:"fct-order-count-text"},Ft={class:"fct-popover-box-action-icon"},Et=["onClick"],Ut={class:"fct-status-and-order-type-wrap"},Yt={class:"fct-order-table-payment-status-col"},zt={class:"title"},Wt={class:"fct-status-group"},Qt=["src","alt"],Jt={key:0,class:"fct-order-table-status-col"},Xt={class:"title"},Gt={key:1,class:"fct-order-table-order-type-col"},Kt={class:"title"},Zt={class:"type"},es={class:"fct-orders-table-mobile-footer"},ts={class:"fct-status-and-order-type-wrap"},ss={class:"fct-order-table-order-items-col"},os={key:0,class:"title"},ns=["innerHTML"],ls=["innerHTML"],rs={key:0,class:"py-6 text-center"},xo={__name:"OrdersTableMobile",props:{orders:{type:Array,required:!0},emptyText:{type:String,required:!1,default:i("No orders found.")},columns:{type:Array,required:!1,default(){return["selection","customer","actions","status","order_items"]}},table:Object},setup(d){const v=d,p=U.get("site_url"),k=w=>v.columns.includes(w),O=w=>U.get("payment_logos."+w),c=w=>w?se.appendQueryParams(p,{"fluent-cart":"receipt",order_hash:w,download:1}):"",y=w=>w.filter(M=>M.payment_type!=="signup_fee"),C=w=>{switch(w){case"payment":return i("Payment");case"subscription":return i("Subscription");case"renewal":return i("Renewal");default:R.headline(w)}};return(w,M)=>{const h=b("el-dropdown-item"),N=b("el-dropdown-menu"),D=b("el-dropdown"),q=b("router-link"),u=b("el-popover"),m=b("el-tag");return t(),r("div",ht,[(t(!0),r(L,null,B(d.orders,(_,I)=>(t(),r("div",{key:_.id,class:"fct-orders-table-mobile-row"},[e("div",vt,[e("div",{class:"fct-order-table-date-col",onClick:f=>w.$router.push({name:"view_order",params:{order_id:_.id}})},[n(Q,{class:"date","date-time":_.created_at,"with-time":!1},null,8,["date-time"]),M[0]||(M[0]=e("span",{class:"bullet"},"•",-1)),e("div",{title:a(i)("Order ID: %s",_.id),class:"invoice-no"},s(_.invoice_no),9,yt)],8,bt),e("div",gt,[e("div",{class:"fct-order-table-total-col",onClick:f=>w.$router.push({name:"view_order",params:{order_id:_.id}})},[parseInt(_.total_refund)?(t(),r(L,{key:1},[e("span",{class:"text-gray-700 line-through",innerHTML:a(E).formatNumber(_.total_amount,!0,!1,_.currency)},null,8,$t),_.payment_status!="refunded"?(t(),r("span",{key:0,class:"ml-1",innerHTML:a(E).formatNumber(parseInt(_.total_amount)-parseInt(_.total_refund),!0,!1,_.currency)},null,8,Ct)):g("",!0)],64)):(t(),r("span",{key:0,innerHTML:a(E).formatNumber(_.total_amount,!0,!1,_.currency)},null,8,wt))],8,kt),k("actions")?(t(),r("div",xt,[n(D,{trigger:"click","popper-class":"fct-dropdown"},{dropdown:o(()=>[n(N,null,{default:o(()=>[n(h,{class:"item-link"},{default:o(()=>[e("a",{target:"_blank",href:c(_.uuid)},[n(P,{name:"Print"}),T(" "+s(a(i)("View Invoice")),1)],8,Ot)]),_:2},1024)]),_:2},1024)]),default:o(()=>[e("span",Tt,[n(P,{name:"More",class:"w-1"})])]),_:2},1024)])):g("",!0)])]),k("customer")||k("order_items")?(t(),r("div",Mt,[e("div",St,[k("customer")?(t(),r("div",It,[_.customer?(t(),$(J,{key:0,customer:_.customer,"to-route":{name:"view_order",params:{order_id:_.id}}},null,8,["customer","to-route"])):(t(),r("span",Dt,s(a(i)("Customer Not Found")),1))])):g("",!0),k("order_items")?(t(),r("div",Lt,[e("div",Nt,[n(u,{placement:"bottom-start",width:360,trigger:"click"},{reference:o(()=>{var f;return[e("div",At,[y(_.order_items).length===1?(t(),r("span",Bt,s((f=y(_.order_items)[0])==null?void 0:f.post_title),1)):(t(),r("span",jt,s(y(_.order_items).length)+" "+s(w.$t("items")),1)),e("div",Ft,[n(P,{name:"ChevronDown"})])])]}),default:o(()=>[e("div",Pt,[e("div",Ht,[(t(!0),r(L,null,B(y(_.order_items),f=>{var S;return t(),r("p",{key:f.id},[f!=null&&f.is_custom&&((S=f==null?void 0:f.other_info)!=null&&S.view_url)?(t(),r("a",{key:0,href:f.other_info.view_url,target:"_blank",rel:"noopener noreferrer"},s(f.post_title),9,Vt)):(t(),$(q,{key:1,class:"title",to:{name:"product_edit",params:{product_id:f==null?void 0:f.post_id}}},{default:o(()=>[T(s(f.post_title),1)]),_:2},1032,["to"])),e("span",Rt,[e("b",null,s(f.quantity),1),T(" x "+s(f.title),1)])])}),128)),y(_.order_items).length===0?(t(),r("p",qt,s(a(i)("No products found!")),1)):g("",!0)])])]),_:2},1024)])])):g("",!0)])])):g("",!0),e("div",{class:"fct-orders-table-mobile-footer",onClick:f=>w.$router.push({name:"view_order",params:{order_id:_.id}})},[e("div",Ut,[e("div",Yt,[e("div",zt,s(a(i)("Payment Status")),1),e("div",Wt,[n(j,{status:_.payment_status,"hide-icon":!0},null,8,["status"]),O(_.payment_method)?(t(),r("span",{key:0,class:K(["img",_.payment_method])},[e("img",{src:O(_.payment_method),alt:a(R).headline(_.payment_method)},null,8,Qt)],2)):(t(),$(m,{key:1,type:"info",round:"",size:"small",class:"capitalize"},{default:o(()=>[T(s(a(R).headline(_.payment_method)),1)]),_:2},1024))])]),k("status")?(t(),r("div",Jt,[e("div",Xt,s(a(i)("Status")),1),(t(),$(j,{status:_.status,"hide-icon":!0,key:_.id},null,8,["status"]))])):g("",!0),k("type")?(t(),r("div",Gt,[e("div",Kt,s(a(i)("Order Type")),1),e("span",Zt,s(C(_.type)),1),n(oe,{order:_},null,8,["order"])])):g("",!0)])],8,Et),e("div",es,[e("div",ts,[d.table?(t(!0),r(L,{key:0},B(d.table.getCustomColumns(),f=>(t(),r("div",ss,[f.label?(t(),r("div",os,s(f.label),1)):g("",!0),f.render_template?(t(),$(te(re),{key:1,templateContent:f.template,data:f,column:f,row:_},null,8,["templateContent","data","column","row"])):(t(),r(L,{key:2},[f.as_link!==!1?(t(),$(H,{key:0,class:"hover:no-underline",to:{name:"view_order",params:{order_id:_.id}}},{default:o(()=>[e("div",{innerHTML:a(z).get(_,f.accessor)},null,8,ns)]),_:2},1032,["to"])):(t(),r("div",{key:1,innerHTML:a(z).get(_,f.accessor)},null,8,ls))],64))]))),256)):g("",!0)])])]))),128)),d.orders.length===0?(t(),r("div",rs,[n(W,{icon:"Empty/Order","has-dark":"",text:d.emptyText},null,8,["text"])])):g("",!0)])}}},as={key:0,class:"text"},is={class:"font-medium"},cs=["innerHTML"],ds={class:"purchase-values"},us=["innerHTML"],_s={key:1},ms=["innerHTML"],ps={key:1,class:"text"},To={__name:"CustomerPurchaseValue",props:{value:{type:[Object,String],required:!0}},setup(d){const v=d,p=G(()=>{if(typeof v.value=="string")try{return JSON.parse(v.value)}catch{return{}}return v.value&&typeof v.value=="object"?v.value:{}}),k=G(()=>{const c=Object.entries(p.value||{});if(!c.length)return{currency:"",value:0};const[y,C]=c[0];return{currency:y,value:C}}),O=G(()=>Object.entries(p.value||{}).slice(1).map(([y,C])=>({currency:y,value:C})));return(c,y)=>{const C=b("el-popover");return Object.keys(p.value).length?(t(),r("span",as,[O.value.length?(t(),$(C,{key:0,placement:"bottom",trigger:"hover","popper-class":"fct-popover"},{reference:o(()=>[e("span",is,[e("span",{innerHTML:c.formatNumber(k.value.value,!0,!1,k.value.currency)},null,8,cs),T(" +"+s(O.value.length),1)])]),default:o(()=>[e("div",ds,[(t(!0),r(L,null,B(O.value,(w,M)=>(t(),r("div",{key:w.currency,class:"purchase-value-item"},[e("span",{innerHTML:c.formatNumber(w.value,!0,!1,w.currency)},null,8,us)]))),128))])]),_:1})):(t(),r("span",_s,[e("span",{innerHTML:c.formatNumber(k.value.value,!0,!1,k.value.currency)},null,8,ms)])),T(" "+s(a(i)("Lifetime Value")),1)])):(t(),r("span",ps,s(a(i)("Lifetime Value"))+": "+s(a(i)("No Data")),1))}}},fs={name:"SubscriptionsTable",emits:["fetch"],props:{subscriptions:{type:Array,required:!0},columns:{type:Array,required:!1,default(){return["customer","next_billing_date","collection_method","bills_count","payment_method","valid_till"]}}},components:{ConvertedTime:Q,RouteCell:H,Badge:j,DynamicIcon:P,ArrowDown:ne,Empty:W,CustomerInfoPopover:J},computed:{Str(){return R}},methods:{translate:i,translateNumber:Z,subscriptionStatus(d){return d==null?void 0:d.status}}},hs={class:"fct-subscriptions-table-wrap"},vs={key:1},bs={class:"truncate"},ys=["innerHTML"];function gs(d,v,p,k,O,c){const y=b("RouteCell"),C=b("el-table-column"),w=b("CustomerInfoPopover"),M=b("Badge"),h=b("ConvertedTime"),N=b("router-link"),D=b("Empty"),q=b("el-table");return t(),r("div",hs,[n(q,{data:p.subscriptions,class:"w-full compact-table","tooltip-options":{popperClass:"fct-tooltip-long"}},{empty:o(()=>[n(D,{icon:"Empty/ListView","has-dark":!0,text:c.translate("No subscriptions found.")},null,8,["text"])]),default:o(()=>[n(C,{fixed:"",label:c.translate("ID"),width:"100"},{default:o(u=>{var m;return[n(y,{class:"link block",to:{name:"view_subscription",params:{subscription_id:(m=u.row)==null?void 0:m.id}}},{default:o(()=>[T(" #"+s(c.translateNumber(u.row.id)),1)]),_:2},1032,["to"])]}),_:1},8,["label"]),p.columns.indexOf("customer")!==-1?(t(),$(C,{key:0,label:c.translate("Customer"),width:150},{default:o(u=>{var m;return[u.row.customer?(t(),$(w,{key:0,customer:u.row.customer,"to-route":{name:"view_subscription",params:{subscription_id:(m=u.row)==null?void 0:m.id}}},null,8,["customer","to-route"])):(t(),r("span",vs,s(c.translate("Customer Not Found")),1))]}),_:1},8,["label"])):g("",!0),n(C,{label:c.translate("Product"),width:"360","show-overflow-tooltip":""},{default:o(u=>{var m;return[n(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(m=u.row)==null?void 0:m.id}}},{default:o(()=>[e("div",bs,s(u.row.item_name),1)]),_:2},1032,["to"])]}),_:1},8,["label"]),n(C,{label:c.translate("Status"),width:"120"},{default:o(u=>{var m;return[n(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(m=u.row)==null?void 0:m.id}}},{default:o(()=>[(t(),$(M,{status:c.subscriptionStatus(u.row),key:u.row.id,size:"small","hide-icon":!0},null,8,["status"]))]),_:2},1032,["to"])]}),_:1},8,["label"]),n(C,{label:c.translate("Billing"),width:"230"},{default:o(u=>{var m;return[n(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(m=u.row)==null?void 0:m.id}}},{default:o(()=>[e("span",{innerHTML:u.row.payment_info},null,8,ys)]),_:2},1032,["to"])]}),_:1},8,["label"]),n(C,{label:c.translate("Created At"),width:"130"},{default:o(u=>{var m;return[n(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(m=u.row)==null?void 0:m.id}}},{default:o(()=>[n(h,{"date-time":u.row.created_at,"with-time":!1},null,8,["date-time"])]),_:2},1032,["to"])]}),_:1},8,["label"]),p.columns.indexOf("next_billing_date")!==-1?(t(),$(C,{key:1,label:c.translate("Next Billing Date"),width:"160"},{default:o(u=>{var m;return[n(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(m=u.row)==null?void 0:m.id}}},{default:o(()=>[n(h,{"date-time":u.row.next_billing_date,"with-time":!1},null,8,["date-time"])]),_:2},1032,["to"])]}),_:1},8,["label"])):g("",!0),p.columns.indexOf("collection_method")!==-1?(t(),$(C,{key:2,label:c.translate("Collection Method"),width:"160"},{default:o(u=>{var m;return[n(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(m=u.row)==null?void 0:m.id}}},{default:o(()=>[T(s(u.row.collection_method),1)]),_:2},1032,["to"])]}),_:1},8,["label"])):g("",!0),p.columns.indexOf("bills_count")!==-1?(t(),$(C,{key:3,label:c.translate("Bills Count"),width:"100"},{default:o(u=>[T(s(c.translateNumber(u.row.bill_count)),1)]),_:1},8,["label"])):g("",!0),p.columns.indexOf("payment_method")!==-1?(t(),$(C,{key:4,label:c.translate("Payment Method"),width:"150"},{default:o(u=>[T(s(u.row.current_payment_method?c.Str.headline(u.row.current_payment_method.trim().replace(/_/g,"-")):"-"),1)]),_:1},8,["label"])):g("",!0),p.columns.indexOf("order_id")!==-1?(t(),$(C,{key:5,label:c.translate("Order ID"),width:"100"},{default:o(u=>[n(N,{class:"link",to:{name:"view_order",params:{order_id:u.row.parent_order_id}}},{default:o(()=>[T(" #"+s(c.translateNumber(u.row.parent_order_id)),1)]),_:2},1032,["to"])]),_:1},8,["label"])):g("",!0)]),_:1},8,["data"])])}const Oo=le(fs,[["render",gs]]),ks={name:"SubscriptionsTableMobile",emits:["fetch"],props:{subscriptions:{type:Array,required:!0},columns:{type:Array,required:!1,default(){return["customer","next_billing_date","collection_method","bills_count","payment_method","valid_till"]}}},components:{ConvertedTime:Q,RouteCell:H,Badge:j,DynamicIcon:P,ArrowDown:ne,Empty:W,CustomerInfoPopover:J},computed:{Str(){return R}},methods:{translate:i,subscriptionStatus(d){return d==null?void 0:d.status}}},ws={class:"fct-table-mobile-wrap fct-subscriptions-table-mobile-wrap"},$s=["onClick"],Cs={class:"fct-table-mobile-header-left"},xs={class:"fct-table-status-col"},Ts={class:"fct-table-id-col"},Os={class:"id"},Ms={class:"fct-table-mobile-body"},Ss={key:0,class:"fct-table-customer-col"},Is=["onClick"],Ds={class:"fct-table-product-col"},Ls={class:"product-name"},Ns={class:"fct-table-billing-col"},Ps={class:"title"},Hs=["innerHTML"],Vs={class:"fct-table-mobile-footer"},Rs={class:"fct-table-mobile-footer-row cols-3"},qs=["onClick"],As={class:"title"},Bs=["onClick"],js={class:"title"},Fs=["onClick"],Es={class:"title"},Us={class:"value"},Ys=["onClick"],zs={class:"title"},Ws={class:"value"},Qs=["onClick"],Js={class:"title"},Xs={class:"value"},Gs=["onClick"],Ks={class:"title"},Zs={class:"value"},eo={key:0,class:"py-6 text-center"};function to(d,v,p,k,O,c){const y=b("Badge"),C=b("CustomerInfoPopover"),w=b("ConvertedTime"),M=b("Empty");return t(),r("div",ws,[(t(!0),r(L,null,B(p.subscriptions,(h,N)=>(t(),r("div",{key:h.id,class:"fct-table-mobile-row"},[e("div",{class:"fct-table-mobile-header",onClick:D=>d.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",Cs,[e("div",xs,[(t(),$(y,{status:c.subscriptionStatus(h),key:h.id},null,8,["status"]))]),e("div",Ts,[e("div",Os,"#"+s(h.id),1)])])],8,$s),e("div",Ms,[p.columns.indexOf("customer")!==-1?(t(),r("div",Ss,[n(C,{customer:h.customer,"to-route":{name:"view_subscription",params:{subscription_id:h==null?void 0:h.id}}},null,8,["customer","to-route"])])):g("",!0),e("div",{onClick:D=>d.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",Ds,[e("div",Ls,s(h.item_name),1)]),e("div",Ns,[e("div",Ps,s(c.translate("Billing:")),1),e("span",{innerHTML:h.payment_info},null,8,Hs)])],8,Is)]),e("div",Vs,[e("div",Rs,[e("div",{class:"fct-table-created-at-col",onClick:D=>d.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",As,s(c.translate("Created At")),1),n(w,{class:"value","date-time":h.created_at,"with-time":!1},null,8,["date-time"])],8,qs),p.columns.indexOf("next_billing_date")!==-1?(t(),r("div",{key:0,class:"fct-table-next-bill-date-col",onClick:D=>d.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",js,s(c.translate("Next Billing")),1),n(w,{class:"value","date-time":h.next_billing_date,"with-time":!1},null,8,["date-time"])],8,Bs)):g("",!0),p.columns.indexOf("bills_count")!==-1?(t(),r("div",{key:1,class:"fct-table-bill-count-col",onClick:D=>d.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",Es,s(c.translate("Bills Count")),1),e("div",Us,s(h.bill_count),1)],8,Fs)):g("",!0),p.columns.indexOf("payment_method")!==-1?(t(),r("div",{key:2,class:"fct-table-payment-method-col",onClick:D=>d.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",zs,s(c.translate("Payment Method")),1),e("div",Ws,s(h.current_payment_method?c.Str.headline(h.current_payment_method.trim().replace(/_/g,"-")):"-"),1)],8,Ys)):g("",!0),p.columns.indexOf("order_id")!==-1?(t(),r("div",{key:3,class:"fct-table-order-id-col",onClick:D=>d.$router.push({name:"view_order",params:{order_id:h.parent_order_id}})},[e("div",Js,s(c.translate("Order ID")),1),e("div",Xs,"#"+s(h.parent_order_id),1)],8,Qs)):g("",!0),p.columns.indexOf("collection_method")!==-1?(t(),r("div",{key:4,class:"fct-table-collection-method-col",onClick:D=>d.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",Ks,s(c.translate("Collection")),1),e("div",Zs,s(h.collection_method),1)],8,Gs)):g("",!0)])])]))),128)),p.subscriptions.length===0?(t(),r("div",eo,[n(M,{icon:"Empty/ListView","has-dark":"",text:c.translate("No subscriptions found.")},null,8,["text"])])):g("",!0)])}const Mo=le(ks,[["render",to]]),so={class:"dialog-footer"},oo={name:"CancelSubscription",props:["subscription","orderId","modelValue"],data(){return{cancelReason:"customer_request",cancelling:!1,otherReason:""}},computed:{updatedModelValue:{get(){return this.modelValue},set(d){this.modelValue=d}},otherReasonError(){return this.cancelReason==="other"&&this.otherReason.trim()===""?i("Please enter a reason"):""}},methods:{cancelSubscription(){if(this.cancelling=!0,this.cancelReason==="other"){if(this.otherReason.trim()===""){this.$notify.error(i("Please enter a reason")),this.cancelling=!1;return}this.cancelReason=this.otherReason}this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/cancel`,{cancel_reason:this.cancelReason}).then(d=>{this.cancelling=!0,this.$notify({type:"success",title:i("Success"),message:i("Subscription canceled successfully")}),this.$emit("reload")}).catch(d=>{var v;this.cancelling=!0,d.status_code=="422"?Y.validationErrors(d):Y.error((v=d.data)==null?void 0:v.message)}).finally(()=>{this.cancelling=!0,this.cancelSubscriptionModal=!1})}}},So=Object.assign(oo,{setup(d){return(v,p)=>{const k=b("el-option"),O=b("el-select"),c=b("el-form-item"),y=b("el-input"),C=b("el-form"),w=b("el-button"),M=b("el-dialog");return t(),$(M,{"model-value":v.updatedModelValue,loading:v.cancelling,title:a(i)("Cancel Subscription"),width:"500"},{footer:o(()=>[e("div",so,[n(w,{onClick:p[2]||(p[2]=h=>v.$emit("close"))},{default:o(()=>[T(s(a(i)("Cancel")),1)]),_:1}),n(w,{loading:v.cancelling,type:"warning",onClick:v.cancelSubscription},{default:o(()=>[T(s(a(i)("Cancel Subscription")),1)]),_:1},8,["loading","onClick"])])]),default:o(()=>[n(C,{"label-position":"top"},{default:o(()=>[e("div",null,s(a(i)("Are you sure to cancel the subscription?")),1),p[3]||(p[3]=e("br",null,null,-1)),n(c,{label:a(i)("Cancellation reason"),required:""},{default:o(()=>[n(O,{modelValue:v.cancelReason,"onUpdate:modelValue":p[0]||(p[0]=h=>v.cancelReason=h)},{default:o(()=>[n(k,{label:a(i)("Refunded"),value:"refunded"},null,8,["label"]),n(k,{label:a(i)("Customer request"),value:"customer_request"},null,8,["label"]),n(k,{label:a(i)("Completed (EOT)"),value:"completed"},null,8,["label"]),n(k,{label:a(i)("Fraudulent"),value:"fraudulent"},null,8,["label"]),n(k,{label:a(i)("Other"),value:"other"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),v.cancelReason==="other"?(t(),$(c,{key:0,label:a(i)("Other Reason"),required:"",error:v.otherReasonError},{default:o(()=>[n(y,{modelValue:v.otherReason,"onUpdate:modelValue":p[1]||(p[1]=h=>v.otherReason=h)},null,8,["modelValue"])]),_:1},8,["label","error"])):g("",!0)]),_:1,__:[3]})]),_:1},8,["model-value","loading","title"])}}});export{Mo as S,Q as _,Co as a,xo as b,To as c,Oo as d,So as e,re as f};
