var U=Object.defineProperty;var E=c=>{throw TypeError(c)};var N=(c,t,e)=>t in c?U(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var C=(c,t,e)=>N(c,typeof t!="symbol"?t+"":t,e),B=(c,t,e)=>t.has(c)||E("Cannot "+e);var n=(c,t,e)=>(B(c,t,"read from private field"),e?e.call(c):t.get(c)),m=(c,t,e)=>t.has(c)?E("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(c):t.set(c,e),y=(c,t,e,o)=>(B(c,t,"write to private field"),o?o.call(c,e):t.set(c,e),e);const w=class w{static handleFragments(t){let e=!1;t.forEach(o=>{const a=document.querySelector(o.selector);a&&(o.selector&&o.type==="replace"&&(e=!0),o.type==="replace"?a.innerHTML=o.content:a.insertAdjacentHTML("beforeend",o.content))}),e&&setTimeout(()=>{window.dispatchEvent(new CustomEvent("fluentCartFragmentsReplaced",{detail:{selectors:t.filter(o=>o.type==="replace").map(o=>o.selector)}}))},10),window.dispatchEvent(new CustomEvent("fluentCartNotifySummaryViewUpdated"))}static handleSummaryViewUpdated(){fetch(w.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=get_checkout_summary_view`).toString(),{headers:{"X-WP-Nonce":window.fluentCartRestVars.rest.nonce},credentials:"include"}).then(t=>t.json()).then(t=>{this.handleFragments(t.fragments),window.dispatchEvent(new CustomEvent("fluentCartCheckoutDataChanged",{detail:{response:t}}))}).catch(t=>{console.error("Error rendering checkout summary:",t)})}static getParams(){var i,s;const t=new URLSearchParams(window.location.search),e={};window.fluentcart_checkout_vars.is_instant_checkout==="yes"&&(e.fct_cart_hash=window.fluentcart_checkout_vars.cart_hash),window.fluentcart_checkout_vars.is_modal_checkout==="yes"&&(e.modal_checkout="yes"),t.has("quantity")&&(e.quantity=t.get("quantity"));const o=(i=window.fluentCartCouponService)==null?void 0:i.getCoupons();Array.isArray(o)&&o.length>0&&(e.coupons=o.join(","));const a=(s=window.fluent_cart_shipping_service)==null?void 0:s.currentShippingMethodId;return a&&(e.shipping_method_id=a),e}static buildUrl(t,e={}){const o={get(a,i){return i==="toString"||i==="valueOf"||i===Symbol.toPrimitive?()=>w._build(a.rawUrl,e):i==="rawUrl"?a.rawUrl:Reflect.get(a,i)}};return new Proxy({rawUrl:t},o)}static _build(t,e){var a,i;const o=new URLSearchParams(window.location.search);w.quantity==null&&(w.quantity=o.get("quantity")||1);for(const[s,_]of Object.entries(e))o.set(s,_);try{const s=new URL(t);for(const[p,v]of o)w.excludeKeys.includes(p)||s.searchParams.set(p,v);window.fluentcart_checkout_vars.is_instant_checkout==="yes"&&s.searchParams.set("fct_cart_hash",window.fluentcart_checkout_vars.cart_hash),window.fluentcart_checkout_vars.is_modal_checkout==="yes"&&s.searchParams.set("modal_checkout","yes"),s.searchParams.set("quantity",w.quantity);const _=(a=window.fluentCartCouponService)==null?void 0:a.getCoupons();Array.isArray(_)&&_.length>0&&s.searchParams.set("coupons",_.join(","));const h=(i=window.fluent_cart_shipping_service)==null?void 0:i.currentShippingMethodId;return h&&s.searchParams.set("shipping_method_id",h),s.href}catch(s){return console.error("Error building URL:",s),t}}static handleCheckoutRedirect(t,e="*"){var a;if(!t){console.error("CheckoutHelper: redirectUrl is required for handleCheckoutRedirect");return}((a=window.fluentcart_checkout_vars)==null?void 0:a.is_modal_checkout)==="yes"?window.parent.postMessage({type:"fluentCartCheckoutComplete",redirectUrl:t},e):window.location.href=t}};C(w,"quantity",null),C(w,"excludeKeys",["fluent-cart","fct_cart_hash"]);let S=w;var l,M,q,P,L,g,b,r,k;class I{constructor({form:t,orderHandler:e,checkoutHandler:o=null,customPayment:a=!1}){m(this,l);C(this,"payMethod");m(this,M,`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=get_order_info`);m(this,q);C(this,"checkoutHandler");C(this,"customPayment");m(this,P);m(this,L,null);m(this,g,!1);m(this,b,!1);m(this,r,null);m(this,k,window.fluentcart.$t);var s,_,h,p,v;y(this,q,e),y(this,l,t),this.payMethod=(s=n(this,l).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:s.value,this.checkoutHandler=o,y(this,r,o.checkoutUiService),this.customPayment=a,y(this,g,((_=window.fluentcart_checkout_info)==null?void 0:_.is_zero_payment)==="yes"),y(this,b,((h=window.fluentcart_checkout_info)==null?void 0:h.has_subscription)==="yes"),this.buttons=n(this,l).querySelector("[data-fluent-cart-checkout-page-checkout-button]"),this.paymenMethodsWithCustomCheckoutButtons=(p=window.fluentcart_checkout_vars)==null?void 0:p.payment_methods_with_custom_checkout_buttons,y(this,P,(v=window.fluentcart_checkout_vars)==null?void 0:v.submit_button);const i=n(this,l).querySelector('input[name="_fct_pay_method"]:checked');if(i)this.payMethod=i.value;else{const u=n(this,l).querySelector('input[name="_fct_pay_method"]');u?this.payMethod=u.value:(this.payMethod="offline_payment",window.is_offline_payment_ready=!0,n(this,r).showCheckoutButton(),n(this,r).enableCheckoutButton())}this.paymenMethodsWithCustomCheckoutButtons.includes(this.payMethod)&&(n(this,r).hideCheckoutButton(),n(this,r).enableCheckoutButton()),this.bindPaymentMethodListeners(),window.addEventListener("fluentCartCheckoutDataChanged",u=>{var d;this.checkTotal((d=u.detail)==null?void 0:d.response)}),window.addEventListener("fluentCartFragmentsReplaced",u=>{var d,f;(f=(d=u.detail)==null?void 0:d.selectors)!=null&&f.includes("[data-fluent-cart-checkout-payment-methods]")&&this.reinitializePaymentMethods()}),window.addEventListener("fluent_cart_payment_method_loading",u=>{const d=u.detail.payment_method;d&&(document.querySelectorAll(".fct_payment_method_wrapper").forEach(f=>{f.classList.remove("fct-payment-loading"),f.classList.remove("fct-payment-loading-failed")}),document.querySelectorAll(".fct_payment_method_"+d).forEach(f=>{f.classList.add("fct-payment-loading")}),document.querySelector(".fluent-cart-checkout_embed_payment_container_"+d).parentNode.classList.add("fct-payment-loading"),document.querySelector(".fct_place_order_btn_wrap")&&document.querySelector(".fct_place_order_btn_wrap").classList.add("fct-payment-loading"))}),window.addEventListener("fluent_cart_payment_method_loading_failed",u=>{const d=u.detail.payment_method;d&&document.querySelectorAll(".fct_payment_method_"+d).forEach(f=>{f.classList.remove("fct-payment-loading"),f.classList.add("fct-payment-loading-failed")})}),window.addEventListener("fluent_cart_payment_method_loading_success",u=>{const d=u.detail.payment_method;d&&(document.querySelectorAll(".fct_payment_method_"+d).forEach(f=>{f.classList.remove("fct-payment-loading"),f.classList.remove("fct-payment-loading-failed")}),document.querySelector(".fluent-cart-checkout_embed_payment_container_"+d).parentNode.classList.remove("fct-payment-loading"),document.querySelector(".fct_place_order_btn_wrap")&&document.querySelector(".fct_place_order_btn_wrap").classList.remove("fct-payment-loading"))})}reinitializePaymentMethods(){var i;const t=this.payMethod;!!n(this,l).querySelector("#fluent_payment_methods")?this.payMethod=((i=n(this,l).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:i.value)||t:(this.payMethod="offline_payment",window.is_offline_payment_ready=!0,n(this,r).showCheckoutButton(),n(this,r).enableCheckoutButton()),this.bindPaymentMethodListeners();const a=n(this,l).querySelector('input[name="_fct_pay_method"]:checked');if(a){n(this,l).querySelectorAll('input[name="_fct_pay_method"]').forEach(h=>{h.parentNode.classList.remove("active")}),a.parentNode.classList.add("active");const s=a.parentNode,_=document.querySelector(".fluent-cart-checkout_embed_payment_container_"+this.payMethod);if(_){_.parentNode.classList.add("active"),document.querySelectorAll(".fct_payment_method_instructions").forEach(v=>v.style.display="none");const p=s.querySelector(".fct_payment_method_instructions");p&&(p.style.display="block"),this.load(this.payMethod)}}this.paymenMethodsWithCustomCheckoutButtons.includes(this.payMethod)?(n(this,r).hideCheckoutButton(),n(this,r).enableCheckoutButton()):(n(this,r).showCheckoutButton(),n(this,r).enableCheckoutButton())}bindPaymentMethodListeners(){const t=n(this,l).querySelectorAll('input[name="_fct_pay_method"]');t.forEach(e=>{e.addEventListener("change",()=>{var i;this.payMethod=(i=n(this,l).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:i.value,t.forEach(s=>s.parentNode.classList.remove("active")),e.parentNode.classList.add("active"),this.paymenMethodsWithCustomCheckoutButtons.includes(this.payMethod)?(n(this,r).hideCheckoutButton(),n(this,r).enableCheckoutButton()):(n(this,r).showCheckoutButton(),n(this,r).enableCheckoutButton()),document.querySelectorAll(".fct_payment_method_instructions").forEach(s=>{s.style.display="none"});const a=document.querySelector(".fluent-cart-checkout_embed_payment_container_"+this.payMethod);if(document.querySelectorAll(".fluent-cart-checkout_embed_payment_container").forEach(s=>s.parentNode.classList.remove("active")),a){a.parentNode.classList.add("active");const s=e.parentNode.querySelector(".fct_payment_method_instructions");s&&(s.style.display="block"),this.load(this.payMethod)}})})}checkTotal(t){(t==null?void 0:t.total)!==n(this,L)&&((t==null?void 0:t.total)>0?y(this,g,!1):(t==null?void 0:t.total)<=0&&!n(this,b)&&y(this,g,!0),y(this,L,t==null?void 0:t.total))}decodeHtml(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}disableCheckoutButton(t){n(this,l).classList.add("fluent-cart-checkout-order-processing"),n(this,r).disableCheckoutButton(),n(this,r).setCheckoutButtonText(t)}enableCheckoutButton(t){n(this,l).classList.add("fluent-cart-checkout-order-processing"),n(this,r).enableCheckoutButton(),n(this,r).setCheckoutButtonText(t)}showCheckoutButton(){this.buttons.style.display="block",this.buttons.disabled=!1}triggerPaymentCompleteEvent(t){var a;const e=new URLSearchParams({action:"fluent_cart_run_order_actions",order_hash:(a=t==null?void 0:t.order)==null?void 0:a.uuid}),o=new XMLHttpRequest;o.open("POST",window.fluentcart_checkout_vars.ajaxurl,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onload=function(){o.status>=200&&o.status<300||console.error("Network response was not ok")},o.send(e.toString())}load(t){var s,_;if(t==null){const h=n(this,l).querySelector('input[name="_fct_pay_method"]');if(h){t=h.value,h.checked=!0,n(this,l).querySelectorAll('input[name="_fct_pay_method"]').forEach(d=>{d.parentNode.classList.remove("active")}),h.parentNode.classList.add("active");const p=document.querySelector(".fluent-cart-checkout_embed_payment_container_"+h.value);p&&p.parentNode.classList.add("active");const u=h.parentNode.querySelector(".fct_payment_method_instructions");u&&(document.querySelectorAll(".fct_payment_method_instructions").forEach(d=>{d.style.display="none"}),u.style.display="block")}else return}this.payMethod=t,window["is_"+t+"_ready"]=!0;let e=new URLSearchParams(window.location.search);const o=n(this,M);let a={method:t};(s=window.fluentcart_checkout_info)!=null&&s.paymentMode&&(a.mode=window.fluentcart_checkout_info.paymentMode),(_=window.fluentcart_checkout_info)!=null&&_.orderHash&&(a.order_hash=window.fluentcart_checkout_info.orderHash),e.has("mode")&&e.get("variation_id")&&(a.mode=e.get("mode"),a.variation_id=e.get("variation_id"));const i=S.buildUrl(o.toString(),a).toString();window.dispatchEvent(new CustomEvent("fluent_cart_load_payments_"+t,{detail:{form:n(this,l),paymentInfoUrl:i,nonce:window.fluentcart_checkout_info.checkout_nonce,orderHandler:n(this,q),paymentLoader:this,isZeroPayment:n(this,g),hasSubscriptions:n(this,b)}}))}changeLoaderStatus(t){const e=document.querySelector(".fct-order-processing .loading-status");if(!e)return;const o={processing:n(this,k).call(this,"Payment Processing..."),confirming:n(this,k).call(this,"Confirming Payment..."),completed:n(this,k).call(this,"Payment completed! Updating order..."),redirecting:n(this,k).call(this,"Redirecting to receipt..."),failed:n(this,k).call(this,"Payment failed!"),canceled:n(this,k).call(this,"Payment canceled!"),rejected:n(this,k).call(this,"Payment Process rejected!")};e.textContent=o[t]||t}hideLoader(){const t=document.querySelector(".fct-order-processing");t&&t.classList.add("fct-loader-hidden")}getPaymentMethod(){return this.payMethod}}l=new WeakMap,M=new WeakMap,q=new WeakMap,P=new WeakMap,L=new WeakMap,g=new WeakMap,b=new WeakMap,r=new WeakMap,k=new WeakMap;export{S as C,I as P};
