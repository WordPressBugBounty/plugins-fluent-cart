import{j as t,b as o}from"./chunks/BlockEditorTranslator.js";import{a as b}from"./chunks/index4.js";import{S as _}from"./chunks/SelectVariationModal.js";import{n as v,B as j}from"./chunks/Icons.js";import{a as k}from"./chunks/add-query-args.js";import"./chunks/ProductListItem.js";import"./chunks/index5.js";const{InspectorControls:S}=wp.blockEditor,{PanelBody:w,CheckboxControl:C,Button:B,Card:E,CardBody:P,Flex:D,FlexItem:I,FlexBlock:F}=wp.components,{useState:M}=wp.element,z=({attributes:a,setAttributes:r,selectedVariant:e})=>{const[i,l]=M(!1),u=()=>e?t.jsx(E,{size:"small",style:{marginTop:"12px"},children:t.jsx(P,{children:t.jsxs(D,{align:"flex-start",gap:3,children:[t.jsxs(F,{children:[t.jsx("div",{style:{marginBottom:"4px",fontWeight:"600",fontSize:"13px"},children:e==null?void 0:e.variation_title}),t.jsxs("div",{style:{fontSize:"13px",color:"#757575",marginBottom:"2px"},children:[o("Price"),":",t.jsx("span",{style:{fontWeight:"600",color:"#000",marginLeft:"4px"},dangerouslySetInnerHTML:{__html:e==null?void 0:e.formatted_total}})]})]}),t.jsx(I,{children:t.jsx(B,{icon:v,label:o("Edit product selection"),isSmall:!0,onClick:()=>l(!0)})})]})})}):null;return t.jsx(S,{children:t.jsxs(w,{title:o("Product Settings"),initialOpen:!0,children:[t.jsx(C,{label:o("Enable Instant Modal Checkout"),checked:a.enable_modal_checkout||!1,onChange:n=>r({enable_modal_checkout:n}),help:o("Open checkout in a modal instead of navigating to the product page.")}),t.jsxs(t.Fragment,{children:[t.jsx("p",{children:o("Select a specific product variation for this button.","fluent-cart")}),(!e||i)&&t.jsx(_,{button:!0,isMultiple:!1,setAttributes:r,onModalClosed:n=>{let s={...n},p=Object.keys(s);r({variationsData:{...s}}),r({variant_ids:p}),l(!1)}}),e&&!i&&u()]})]})})},{useBlockProps:N,RichText:O}=wp.blockEditor,{registerBlockType:T}=wp.blocks,{useEffect:W,useState:A}=wp.element,{store:G}=wp.blockEditor,d=window.fluent_cart_buy_now_button_data,m=window.fluentCartRestVars.rest,R=m.url+"/products/variants/";T(d.slug+"/"+d.name,{apiVersion:3,title:d.title,description:d.description,icon:{src:j},example:{attributes:{}},category:"fluent-cart",attributes:{variant_ids:[],variationsData:{type:[Array,Object],default:[]},query_type:{type:"string",default:"default"},enable_modal_checkout:{type:"boolean",default:!1},text:{type:"string",default:"Buy Now"},placeholder:{type:"string"}},supports:{html:!1,align:["left","center","right"],alignWide:!1,typography:{fontSize:!0,lineHeight:!0},spacing:{margin:!0,padding:!0},color:{text:!0},__experimentalBorder:{color:!0,radius:!0,style:!0,width:!0},reusable:!1,shadow:!0},edit:a=>{const{attributes:r,setAttributes:e}=a,{text:i,placeholder:l}=r,u=N(),[n,s]=A({});let f=(Array.isArray(r.variationsData)?r.variationsData:[])[0]||null,x={variant_ids:r.variant_ids,with_product:!0,per_page:10,page:1,order_by:"ID",order_type:"DESC"};const g=()=>{var c;if(!((c=r.variant_ids)!=null&&c.length)){s([]),e({variationsData:[]});return}b({path:k(R,{params:x}),headers:{"X-WP-Nonce":m.nonce}}).then(y=>{const h=y.variants||[];s(h),e({variationsData:h})}).finally(()=>{})};return W(()=>{g()},[r.variant_ids]),t.jsxs("div",{children:[t.jsx(z,{attributes:r,setAttributes:e,preSelectedVariations:n,selectedVariant:f}),t.jsx(O,{...a,...u,tagName:"a",className:"wp-block-button__link wp-element-button",value:i,onChange:c=>e({text:c}),placeholder:l||o("Add textâ€¦","fluent-cart"),allowedFormats:["core/bold","core/italic"]})]})},save:function(a){return null}});
